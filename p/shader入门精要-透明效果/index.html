<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="实现透明效果"><title>Shader入门精要-透明效果</title><link rel=canonical href=https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Shader入门精要-透明效果"><meta property="og:description" content="实现透明效果"><meta property="og:url" content="https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/"><meta property="og:site_name" content="YanTree"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Shader入门精要"><meta property="article:published_time" content="2021-06-01T14:24:53+08:00"><meta property="article:modified_time" content="2021-06-01T14:24:53+08:00"><meta property="og:image" content="https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/topimg.png"><meta name=twitter:title content="Shader入门精要-透明效果"><meta name=twitter:description content="实现透明效果"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/topimg.png"><link rel="shortcut icon" href=img/favicon.ico></head><body><script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.body.dataset.scheme='dark':document.body.dataset.scheme='light'})()</script><div class="container main-container flex on-phone--column extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hud8215445c04336af6f3d5658bab85db7_7222_300x0_resize_box_2.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>🍥</span></figure><h1 class=site-name><a href=https://yantree.github.io/>YanTree</a></h1><h2 class=site-description>子非蝶，亦非周</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>主页</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>关于</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>归档</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜索</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://yantree.github.io/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/topimg_hucec924f8a8d5e17115b60defab86f43b_300097_800x0_resize_box_2.png srcset="/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/topimg_hucec924f8a8d5e17115b60defab86f43b_300097_800x0_resize_box_2.png 800w, /p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/topimg_hucec924f8a8d5e17115b60defab86f43b_300097_1600x0_resize_box_2.png 1600w" width=800 height=449 loading=lazy alt="Featured image of post Shader入门精要-透明效果"></a></div><div class=article-details><header class=article-category><a href=/categories/%E6%B8%B2%E6%9F%93/>渲染</a></header><h2 class=article-title><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/>Shader入门精要-透明效果</a></h2><h3 class=article-subtitle>实现透明效果</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Jun 01, 2021</time></footer></div></header><section class=article-content><h1 id=技术美术透明效果>技术美术——透明效果</h1><p>Unity 中通常使用两种方法来实现透明：<strong>透明度测试 (AlphaTest)</strong> 和 <strong>透明度混合 (AlphaBlend)</strong> 。</p><ul><li><strong>透明度测试</strong>：一个片元透明度不满足条件(小于某个阈值)，那么它对应的片元就会被舍弃。被舍弃的片元将不再进行任何处理，不如写入颜色信息到 color buffer；否则，按照普通的不透明物体的处理方式来处理它，即进行 <strong>深度测试</strong>、<strong>深度写入</strong> 等。透明度测试不需要关闭深度写入，它与其他不透明物体最大的不同就是它会根据透明度来舍弃一些片元，所以它产生的效果很极端，要么完全透明，要么完全不透明，不能实现半透明效果。</li><li><strong>透明度混合</strong>：使用当前片元的透明度作为混合因子，与已经存储在 color buffer 中的颜色值进行混合，得到新的颜色。透明度混合需要 <strong>关闭深度写入</strong>，也就是当前物体的深度信息不会被记录，但是 <strong>深度测试是开启的</strong>，也就是说当使用透明度混合渲染一个片元时，还是会比较当前物体的深度值与 depth buffer 中的深度值，如果当前物体的深度值距离摄像机更远，那么就不再进行混合操作。这一点决定了，一个不透明物体出现在一个透明物体的前面，先渲染了不透明物体，它可以正常的遮挡住透明物体。归根结底，<strong>对于透明度混合，depth buffer 是只可读的</strong>。</li></ul><h2 id=渲染顺序>渲染顺序</h2><p>对于透明度混合技术，我们需要关闭深度写入，但是关闭深度写入，那我们就需要小心处理透明物体的渲染顺序。</p><p><strong>为什么需要关闭深度写入？</strong></p><p>如果不关闭深度写入，半透明物体表面背后的面本来可以透过表面看到背后的面，由于深度测试判断半透明物体表面距离摄像机更近，就会导致表面背后的面被剔除，也就无法透过表面看到背后的面。</p><p><strong>关闭深度写入会发生什么？</strong></p><p>假设我们要渲染两个物体，一个是半透明物体 A，一个是不透明物体 B，A 在 b 前面 ( A 离摄像机更近)</p><ul><li>一，先渲染 B，再渲染 A。因为不透明物体开启了深度测试和深度写入，所以 B 的数据会写进深度缓存里，当我们渲染 A 的时候，先提取深度缓存中的数据，然后和 A 进行透明度混合，显示结果正确。</li><li>二，先渲染 A，再渲染 B。由于半透明物体关闭了深度吸入，A 的深度信息不会写入深度缓存里；当渲染 B 的时候，B 的深度信息直接覆盖写入深度缓存里。实际上 B 应该再 A 的后面，但是从视角来看，B 出现在了 A 前面，显示结果错误。</li></ul><p>又假设两个物体都是半透明物体呢？假设我们有两个物体 A 和 B，A 在 B 的前面（离摄像机更近），并且两者都是半透明物体。</p><ul><li>一，先渲染 B，再渲染 A，B 的颜色会被写入颜色缓冲（和深度缓冲很像，可以理解为当前颜色），这样 A 会正确的获得颜色缓冲中的 B 的颜色数据，然后正确的混合。</li><li>二，先渲染 A，再渲染 B，A 的数据会被先写入颜色缓冲，然后渲染 B 的时候，会提取 A 的数据，和 B 进行混合。这样最终结果看起来像是 B 在 A 的前面。这就是错误的结果。</li></ul><h2 id=引擎如何处理透明度混合技术>引擎如何处理透明度混合技术</h2><ol><li>先渲染所有的不透明物体，并开启他们的深度写入和深度测试。</li><li>把半透明物体按他们距离摄像机的远近进行排序，然后按照从后往前的顺序渲染这些半透明物体，并开启他们的深度测试，但关闭深度写入。</li></ol><h3 id=引擎无法处理的问题>引擎无法处理的问题</h3><p><figure style=flex-grow:114;flex-basis:274px><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/loop-halftransparent-object.png data-size=1024x895><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/loop-halftransparent-object.png srcset="/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/loop-halftransparent-object_hu0db74e15e313c6ae7f279217c18728b8_42973_480x0_resize_box_2.png 480w, /p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/loop-halftransparent-object_hu0db74e15e313c6ae7f279217c18728b8_42973_1024x0_resize_box_2.png 1024w" width=1024 height=895 loading=lazy></a></figure></p><p>在上图中，由于3个物体相互重叠，我们不可能的得到一个正确的排序顺序。这时候，我们可以选择把物体拆分成两个部分，然后再进行正确的排序。</p><p>但即便我们通过分割的方法解决了循环覆盖的问题，还是会有其他的情况来捣乱。</p><p><figure style=flex-grow:156;flex-basis:374px><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/camrea-depth.png data-size=1024x656><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/camrea-depth.png srcset="/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/camrea-depth_hu7ad251c1d3ea249d926109d5bbf0ad7a_67649_480x0_resize_box_2.png 480w, /p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/camrea-depth_hu7ad251c1d3ea249d926109d5bbf0ad7a_67649_1024x0_resize_box_2.png 1024w" width=1024 height=656 loading=lazy></a></figure></p><p>一个物体的网格结构往往占据了空间中的某一块区域，也就是说，这个网格上每一个点的深度值可能都不一样，我们选择哪个深度值来作物整个物体的深度值和其他物体进行排序呢？不幸的是基于上图的情况，无论我们选择哪个点，排序的结果都是A物体在B物体前面。这种问题解决方案通常也是分割网格。</p><h2 id=unityshader-渲染顺序>UnityShader 渲染顺序</h2><p>Unity 通过一组 <strong>Queue</strong> 标签来决定模型属于哪个 <strong>渲染队列</strong>，队列由整数索引表示，值越小越先渲染。</p><table><thead><tr><th>名称</th><th>队列索引号</th><th>描述</th></tr></thead><tbody><tr><td>Background</td><td>1000</td><td>最开始渲染的队列，通常使用该队列来渲染那些需要绘制再背景上的物体</td></tr><tr><td>Geometry</td><td>2000</td><td>默认的渲染队列，大多数物体使用这个队列。不透明物体使用该队列</td></tr><tr><td>AlphaTest</td><td>2450</td><td>需要透明度测试的物体使用这个队列。</td></tr><tr><td>Transparent</td><td>3000</td><td>在所有 Geometry 和 AlphaTest 物体渲染后，再按从后往前的顺序进行渲染，任何使用了透明度混合（例如关闭深度写入的 Shader）的物体都应该使用该队列</td></tr><tr><td>Overlay</td><td>4000</td><td>用于实现一些叠加效果，任何需要再最后渲染的物体都应该使用该队列</td></tr></tbody></table><p>如果我们要控制物体的渲染顺序，需要在着色器中指出。</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>SubShader</span><span class=p>{</span>
    <span class=n>Tags</span><span class=p>{</span><span class=err>&#34;</span><span class=n>Queue</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Transparent</span><span class=err>&#34;</span><span class=p>}</span> <span class=c1>// Tansparent 渲染队列</span>
    <span class=n>Pass</span><span class=p>{</span>
        <span class=c1>// 变比深度写入</span>
        <span class=n>ZWrite</span> <span class=n>Off</span>
        <span class=c1>//...other code</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h2 id=透明度测试>透明度测试</h2><p>透明度测试简单粗暴，片元透明度不满足条件则被舍弃，且被舍弃的片元不会参与后面的计算，深度写入，颜色写入。再片元着色器中使用 <code>clip</code> 函数来进行透明度测试，定义如下。</p><ul><li>函数：void clip(float4 x); void clip(float3 x); void clip(float2 x); void clip(float x);</li><li>参数：裁剪时使用的标量或矢量条件；</li><li>描述：如果给定参数任何一个分量是负数，就会舍弃当前像素的输出颜色。</li></ul><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>AlphaTestOff</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_MainTex</span> <span class=p>(</span><span class=err>&#34;</span><span class=n>Texture</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_AlphaClip</span><span class=p>(</span><span class=err>&#34;</span><span class=n>AlphaClip</span><span class=err>&#34;</span><span class=p>,</span><span class=n>Range</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.5</span>
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>TransparentCutout</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>Queue</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>AlphaTest</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>IgnoreProjector</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=k>true</span><span class=err>&#34;</span> <span class=p>}</span>
        <span class=c1>// 关闭剔除效果</span>
        <span class=n>Cull</span> <span class=n>Off</span>
        
        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>CGPROGRAM</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=k>sampler2D</span> <span class=n>_MainTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_MainTex_ST</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_AlphaClip</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>texcoord</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>posWorld</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>uv</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldNormal</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldPos</span> <span class=o>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>

                <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span>

                <span class=n>o</span><span class=p>.</span><span class=n>posWorld</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span> <span class=o>=</span> <span class=n>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldPos</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span>

                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>worldNormal</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>worldLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceLightDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>
                <span class=n>half3</span> <span class=n>worldViewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>
                <span class=n>half3</span> <span class=n>halfDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>worldLightDir</span> <span class=o>+</span> <span class=n>worldViewDir</span><span class=p>);</span>

                <span class=k>half</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>worldLightDir</span><span class=p>));</span>
                <span class=k>half</span> <span class=n>NdotV</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>halfDir</span><span class=p>));</span>

                <span class=n>half4</span> <span class=n>albedo</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span> <span class=o>*</span> <span class=n>albedo</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>
                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>albedo</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=p>(</span><span class=n>NdotL</span> <span class=o>*</span> <span class=mf>0.5</span> <span class=o>+</span><span class=mf>0.5</span><span class=p>);</span>

                <span class=n>clip</span><span class=p>(</span><span class=n>albedo</span><span class=p>.</span><span class=n>a</span> <span class=o>-</span> <span class=n>_AlphaClip</span><span class=p>);</span>         <span class=c1>// 简单粗暴裁剪掉片元，被裁减片元不再参与之后的计算</span>
                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>diffuse</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h2 id=透明度混合>透明度混合</h2><p>可以实现真正的半透明效果。使用当前片元的透明度作为混合因子，与已经存储在颜色缓存中的颜色值进行混合，得到新的颜色。但是，需要关闭深度写入，要非常小心物体的渲染顺序。为了进行混合，还需要使用 Unity 提供的混合命令 - <strong>Blend</strong>，<strong>Blend</strong> 是 Unity 提供的设置混合模式的命令。</p><table><thead><tr><th>语义</th><th>描述</th></tr></thead><tbody><tr><td>Blend Off</td><td>关闭混合</td></tr><tr><td>Blend SrcFactor DstFactor</td><td>开启混合，设置混合因子。源颜色 (片元颜色) 乘以 SrcFactor，而目标颜色 (color buffer的颜色)乘以 DstFactor，然后把两者相加后再存入颜色缓冲中</td></tr><tr><td>Blend SrcFactor DstFactor, SrcFactorA DstFactorA</td><td>和上面几乎一样，只是使用不同的因子来混合透明通道</td></tr><tr><td>BlendOp BlendOperation</td><td>并非把源颜色与目标颜色简单相加后混合，而是使用 BlendOperation 对他们进行其他操作</td></tr></tbody></table><p>这里使用第二种语义，即 <strong>Blend SrcFactor DsFactor</strong> 来进行混合。我们需要把源颜色的混合因子 <strong>SrcFactor</strong> 设置为 SrcAlpha，而目标颜色的混合因子 <strong>DstFactor</strong> 设为 <strong>OneMinusSrcAlpha</strong> 。这样意味着经过混合后新的颜色是：</p><blockquote><p>DstColornew = SrcAlpha * SrcColor + ( 1 - SrcAlpha ) * DstColorold</p></blockquote><h3 id=开启深度写入的半透明效果>开启深度写入的半透明效果</h3><p>关闭深度写入会带来各种问题，下图给出了由于排序错误而产生的错误的透明效果，这是由于我们关闭了深度写入造成的。</p><p><figure style=flex-grow:112;flex-basis:270px><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/alpha-blend-one-slide.png data-size=616x546><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/alpha-blend-one-slide.png srcset="/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/alpha-blend-one-slide_huab81494e3fbb45b2fc522ca14c003199_192547_480x0_resize_box_2.png 480w, /p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/alpha-blend-one-slide_huab81494e3fbb45b2fc522ca14c003199_192547_1024x0_resize_box_2.png 1024w" width=616 height=546 loading=lazy></a></figure></p><p>为了解决这一问题，我们给出了一种解决办法，使用两个 <strong>Pass</strong> 来渲染模型：</p><ul><li>第一个 Pass 开启深度写入，但不输出任何颜色信息，它的目的仅仅是为了把该模型的深度值写入深度缓冲区中；</li><li>第二个 Pass 进行正常的透明度混合，由于上一个 Pass 已经得到了逐像素的正确的深度信息，该 Pass 就可以按照像素级别的深度排序结果进行透明渲染。</li></ul><p>这样做的缺陷在于，多使用一个 <strong>Pass</strong> 会对性能造成一定的影响。</p><p><figure style=flex-grow:110;flex-basis:266px><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/alpha-blend-one-slide-true.png data-size=616x555><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/alpha-blend-one-slide-true.png srcset="/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/alpha-blend-one-slide-true_hu3e27bfec6ce75d13a8bd649b68bc9dd9_139077_480x0_resize_box_2.png 480w, /p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/alpha-blend-one-slide-true_hu3e27bfec6ce75d13a8bd649b68bc9dd9_139077_1024x0_resize_box_2.png 1024w" width=616 height=555 loading=lazy></a></figure></p><p>我们使用同上面透明度混合同样的代码，仅仅增加一个 Pass 用于深度写入。在该 Pass 的第一行，我们开起了深度写入；第二行我们使用了一个新的渲染命令—— <strong>ColorMask</strong>，在 ShaderLab 中，ColorMask 用于设置颜色通道的掩码。语义如下：</p><blockquote><p>ColorMask RGB | A | 0 | 其他任何R、G、B、A的组合</p></blockquote><p>当ColorMask设置为0时，意味着该Pass不写入仍和颜色通道，即不会输出任何颜色。这正是我们所需要的——该Pass只需要写入深度缓存即可。这是 <strong>单面渲染</strong> 详细代码：</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>AlphaBlendOneSlide</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_MainTex</span> <span class=p>(</span><span class=err>&#34;</span><span class=n>MainTex</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_Color</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_AlphaBlend</span><span class=p>(</span><span class=err>&#34;</span><span class=n>AlphaBlend</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.5</span>
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Transparent</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>Queue</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Transparent</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>IngoreProjector</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>True</span><span class=err>&#34;</span> <span class=p>}</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=c1>// 开启深度写入</span>
            <span class=n>ZWrite</span> <span class=n>On</span>
            <span class=c1>// 不写入任何颜色信息到 color buffer</span>
            <span class=n>ColorMask</span> <span class=mo>0</span>
        <span class=p>}</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>Tags</span> <span class=p>{</span><span class=err>&#34;</span><span class=n>LightModel</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>ForwardBase</span><span class=err>&#34;</span><span class=p>}</span>

            <span class=c1>// 关闭深度写入，也就是不将深度值存入深度buffer中</span>
            <span class=n>ZWrite</span> <span class=n>Off</span>
            <span class=c1>// 混合方式</span>
            <span class=n>Blend</span> <span class=n>SrcAlpha</span> <span class=n>OneMinusSrcAlpha</span>

            <span class=n>CGPROGRAM</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=k>sampler2D</span> <span class=n>_MainTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_MainTex_ST</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_AlphaBlend</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_Color</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>texcoord</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>posWorld</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>uv</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldNormal</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldPos</span> <span class=o>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>posWorld</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span> <span class=c1>// 顶点从模型空间转到裁剪空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span> <span class=c1>// _MainTex 的缩放和平移</span>

                <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span> <span class=o>=</span> <span class=n>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span>     <span class=c1>// 法线从模型空间转到世界空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldPos</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span>    <span class=c1>// 顶点位置从模型空间转到世界空间</span>

                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>worldNormal</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span>                         <span class=c1>// 归一化世界法线</span>
                <span class=n>half3</span> <span class=n>worldLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceLightDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span> <span class=c1>// 归一化主光源方向</span>
                <span class=n>half3</span> <span class=n>worldViewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>   <span class=c1>// 归一化视角方向</span>
                <span class=n>half3</span> <span class=n>halfDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>worldLightDir</span> <span class=o>+</span> <span class=n>worldViewDir</span><span class=p>);</span>              <span class=c1>// 半角方向</span>

                <span class=k>half</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>worldLightDir</span><span class=p>));</span>               <span class=c1>// lambert</span>
                <span class=k>half</span> <span class=n>NdotV</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>halfDir</span><span class=p>));</span>

                <span class=n>half4</span> <span class=n>texColor</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span>                               <span class=c1>// 从纹理读取漫反射系数</span>
                
                <span class=n>half3</span> <span class=n>albedo</span> <span class=o>=</span> <span class=n>texColor</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>
                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span> <span class=o>*</span> <span class=n>albedo</span><span class=p>;</span>          <span class=c1>// 环境光</span>
                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>albedo</span> <span class=o>*</span> <span class=p>(</span><span class=n>NdotL</span> <span class=o>*</span> <span class=mf>0.5</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>);</span><span class=c1>// half lambert</span>

                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>diffuse</span><span class=p>,</span> <span class=n>texColor</span><span class=p>.</span><span class=n>a</span> <span class=o>*</span> <span class=n>_AlphaBlend</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>

</code></pre></div><p><strong>双面渲染</strong></p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>AlphaBlendTwoSlide</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_MainTex</span> <span class=p>(</span><span class=err>&#34;</span><span class=n>MainTex</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_Color</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_Alpha</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Alpha</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.5</span>
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Transparent</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>Queue</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Transparent</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>IgnoreProjector</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>True</span><span class=err>&#34;</span> <span class=p>}</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>Tags</span> <span class=p>{</span><span class=err>&#34;</span><span class=n>LightModel</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>ForwardBase</span><span class=err>&#34;</span><span class=p>}</span>

            <span class=n>Cull</span> <span class=n>Front</span>   <span class=c1>// 剔除正面</span>
            <span class=n>ZWrite</span> <span class=n>off</span>   <span class=c1>// 关闭深度写入</span>
            <span class=n>Blend</span> <span class=n>SrcAlpha</span> <span class=n>OneMinusSrcAlpha</span> <span class=c1>// 混合方式</span>

            <span class=n>CGPROGRAM</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=k>sampler2D</span> <span class=n>_MainTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_MainTex_ST</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_Color</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_Alpha</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>texcoord</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>posWorld</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>uv</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldNormal</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldPos</span> <span class=o>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>posWorld</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>

                <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span> <span class=c1>// _MainTex 的缩放和平移</span>

                <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span> <span class=o>=</span> <span class=n>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span>     <span class=c1>// 法线从模型空间转世界空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldPos</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span>    <span class=c1>// 顶点位置从模型空间转世界空间</span>

                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>worldNormal</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span>              <span class=c1>// 归一化法线方向</span>
                <span class=n>half3</span> <span class=n>worldLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceLightDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span> <span class=c1>// 归一化主光源方向</span>
                <span class=n>half3</span> <span class=n>worldViewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>   <span class=c1>// 归一化视角方向</span>
                <span class=n>half3</span> <span class=n>halfDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>worldLightDir</span> <span class=o>+</span> <span class=n>worldViewDir</span><span class=p>);</span>              <span class=c1>// 半角方向</span>

                <span class=n>half3</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>worldLightDir</span><span class=p>));</span>
                
                <span class=n>half4</span> <span class=n>texColor</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>albedo</span> <span class=o>=</span> <span class=n>texColor</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>

                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span> <span class=o>*</span> <span class=n>albedo</span><span class=p>;</span>
                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>albedo</span> <span class=o>*</span> <span class=p>(</span><span class=n>NdotL</span><span class=o>*</span><span class=mf>0.5</span> <span class=o>+</span><span class=mf>0.5</span><span class=p>);</span>

                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>diffuse</span><span class=p>,</span> <span class=n>texColor</span><span class=p>.</span><span class=n>a</span> <span class=o>*</span> <span class=n>_Alpha</span><span class=p>);</span>

            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>

                <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>Tags</span> <span class=p>{</span><span class=err>&#34;</span><span class=n>LightModel</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>ForwardBase</span><span class=err>&#34;</span><span class=p>}</span>

            <span class=n>Cull</span> <span class=n>Back</span>    <span class=c1>// 剔除背面</span>
            <span class=n>ZWrite</span> <span class=n>off</span>   <span class=c1>// 关闭深度写入</span>
            <span class=n>Blend</span> <span class=n>SrcAlpha</span> <span class=n>OneMinusSrcAlpha</span>

            <span class=n>CGPROGRAM</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=k>sampler2D</span> <span class=n>_MainTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_MainTex_ST</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_Color</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_Alpha</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>texcoord</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>posWorld</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>uv</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldNormal</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldPos</span> <span class=o>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>posWorld</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>

                <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span> <span class=c1>// _MainTex 的缩放和平移</span>

                <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span> <span class=o>=</span> <span class=n>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span>     <span class=c1>// 法线从模型空间转世界空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldPos</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span>    <span class=c1>// 顶点位置从模型空间转世界空间</span>

                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>worldNormal</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span>              <span class=c1>// 归一化法线方向</span>
                <span class=n>half3</span> <span class=n>worldLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceLightDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span> <span class=c1>// 归一化主光源方向</span>
                <span class=n>half3</span> <span class=n>worldViewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>   <span class=c1>// 归一化视角方向</span>
                <span class=n>half3</span> <span class=n>halfDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>worldLightDir</span> <span class=o>+</span> <span class=n>worldViewDir</span><span class=p>);</span>              <span class=c1>// 半角方向</span>

                <span class=n>half3</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>worldLightDir</span><span class=p>));</span>
                
                <span class=n>half4</span> <span class=n>texColor</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>albedo</span> <span class=o>=</span> <span class=n>texColor</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>

                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span> <span class=o>*</span> <span class=n>albedo</span><span class=p>;</span>
                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>albedo</span> <span class=o>*</span> <span class=p>(</span><span class=n>NdotL</span><span class=o>*</span><span class=mf>0.5</span> <span class=o>+</span><span class=mf>0.5</span><span class=p>);</span>

                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>diffuse</span><span class=p>,</span> <span class=n>texColor</span><span class=p>.</span><span class=n>a</span> <span class=o>*</span> <span class=n>_Alpha</span><span class=p>);</span>

            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>

</code></pre></div><h2 id=总结>总结</h2><p>关于半透明物体的渲染解决方法，<strong>多添加一个 Pass</strong>；</p><p>单面渲染，第一个 Pass 开启深度写入 <code>ZWrite On</code> 且不要写入任何信息(颜色、透明度) <code>ColorMask 0</code>；第二个 Pass 关闭深度写入 <code>ZWrite Off</code> ，设置好混合方式 <code>Blend SrcAlpha OneMinusSrcAlpha</code> 。</p><p>双面渲染，两个 Pass 同时关闭深度写入 <code>ZWrite On</code>，设置好混合方式 <code>Blend SraAlpha OneMinusSrcAlpha</code>，第一个 Pass 剔除正面 <code>Cull Front</code>，第二个 Pass 剔除背面 <code>Cull Back</code>。</p><p>调整透明度，从常规纹理那儿读取纹理的 Alpha 值</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>half4</span> <span class=n>texColor</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span>  <span class=c1>// 纹理采样      </span>
<span class=n>half3</span> <span class=n>albedo</span> <span class=o>=</span> <span class=n>texColor</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>
<span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span> <span class=o>*</span> <span class=n>albedo</span><span class=p>;</span>          <span class=c1>// 环境光</span>
<span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>albedo</span> <span class=o>*</span> <span class=p>(</span><span class=n>NdotL</span> <span class=o>*</span> <span class=mf>0.5</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>);</span><span class=c1>// half lambert</span>

<span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>diffuse</span><span class=p>,</span> <span class=n>texColor</span><span class=p>.</span><span class=n>a</span> <span class=o>*</span> <span class=n>_AlphaBlend</span><span class=p>);</span>
</code></pre></div></section><footer class=article-footer><section class=article-tags><a href=/tags/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81/>Shader入门精要</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>相关文章</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E6%9B%B4%E5%8A%A0%E5%A4%8D%E6%9D%82%E7%9A%84%E5%85%89%E7%85%A7/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E6%9B%B4%E5%8A%A0%E5%A4%8D%E6%9D%82%E7%9A%84%E5%85%89%E7%85%A7/topimg.6c5c6801e5665142f1afc74f7eccabb9_hud5b4711730563b8f6fe841cfaa71f45d_221051_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-bFxoAeVmUULxr8dPfsyruQ=="></div><div class=article-details><h2 class=article-title>Shader入门精要-更加复杂的光照</h2></div></a></article><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/topimg.b1f07d907209b24d4812f315eb6ff2fa_hub743dc7ee0e867207b7b55e10230ffbf_426847_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-sfB9kHIJsk1IEvMV62/y+g=="></div><div class=article-details><h2 class=article-title>Shader入门精要-基础纹理</h2></div></a></article><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E7%AE%80%E5%8D%95%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E7%AE%80%E5%8D%95%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B/topimg.133a0281833f182f38ff49d986a235dc_hubb21fb6872520e85a0401e3049fab639_84088_250x150_fill_q75_h2_box_smart1.webp width=250 height=150 loading=lazy data-key data-hash="md5-EzoCgYM/GC84/0nZhqI13A=="></div><div class=article-details><h2 class=article-title>Shader入门精要-简单光照模型</h2></div></a></article><article class=has-image><a href=/p/pbr%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA/><div class=article-image><img src=/p/pbr%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA/topimg.d0c106093e9b0fa33a735ef4d6e47d88_hu85975aebbe83c38bfa94df6e1d3760eb_64270_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy data-key data-hash="md5-0MEGCT6bD6M6c1701uR9iA=="></div><div class=article-details><h2 class=article-title>PBR基础理论</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(b){let a=document.querySelector('.utterances iframe');a&&a.contentWindow.postMessage({type:'set-theme',theme:`github-${b}`},'https://utteranc.es')}addEventListener('message',a=>{if(a.origin!=='https://utteranc.es')return;setUtterancesTheme(document.body.dataset.scheme)}),window.addEventListener('onColorSchemeChange',a=>{setUtterancesTheme(a.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2021 YanTree</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script></body></html>