<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="æ¨¡æ‹Ÿåå°„ã€æŠ˜å°„æ•ˆæœ"><title>Shaderå…¥é—¨ç²¾è¦-é«˜çº§çº¹ç†</title><link rel=canonical href=https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Shaderå…¥é—¨ç²¾è¦-é«˜çº§çº¹ç†"><meta property="og:description" content="æ¨¡æ‹Ÿåå°„ã€æŠ˜å°„æ•ˆæœ"><meta property="og:url" content="https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/"><meta property="og:site_name" content="YanTree"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Shaderå…¥é—¨ç²¾è¦"><meta property="article:published_time" content="2021-06-04T20:00:31+08:00"><meta property="article:modified_time" content="2021-06-04T20:00:31+08:00"><meta property="og:image" content="https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/topimg.png"><meta name=twitter:title content="Shaderå…¥é—¨ç²¾è¦-é«˜çº§çº¹ç†"><meta name=twitter:description content="æ¨¡æ‹Ÿåå°„ã€æŠ˜å°„æ•ˆæœ"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/topimg.png"><link rel="shortcut icon" href=img/favicon.ico></head><body><script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.body.dataset.scheme='dark':document.body.dataset.scheme='light'})()</script><div class="container main-container flex on-phone--column extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hud8215445c04336af6f3d5658bab85db7_7222_300x0_resize_box_2.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>ğŸ¥</span></figure><h1 class=site-name><a href=https://yantree.github.io/>YanTree</a></h1><h2 class=site-description>å­éè¶ï¼Œäº¦éå‘¨</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://yantree.github.io/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/topimg_hufdc4047d1f13243dc00ee98ca40c3721_1787439_800x0_resize_box_2.png srcset="/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/topimg_hufdc4047d1f13243dc00ee98ca40c3721_1787439_800x0_resize_box_2.png 800w, /p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/topimg_hufdc4047d1f13243dc00ee98ca40c3721_1787439_1600x0_resize_box_2.png 1600w" width=800 height=449 loading=lazy alt="Featured image of post Shaderå…¥é—¨ç²¾è¦-é«˜çº§çº¹ç†"></a></div><div class=article-details><header class=article-category><a href=/categories/%E6%B8%B2%E6%9F%93/>æ¸²æŸ“</a></header><h2 class=article-title><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/>Shaderå…¥é—¨ç²¾è¦-é«˜çº§çº¹ç†</a></h2><h3 class=article-subtitle>æ¨¡æ‹Ÿåå°„ã€æŠ˜å°„æ•ˆæœ</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Jun 04, 2021</time></footer></div></header><section class=article-content><h1 id=æŠ€æœ¯ç¾æœ¯é«˜çº§çº¹ç†>æŠ€æœ¯ç¾æœ¯â€”â€”é«˜çº§çº¹ç†</h1><h2 id=ç«‹æ–¹ä½“çº¹ç†cubemap>ç«‹æ–¹ä½“çº¹ç†(Cubemap)</h2><p><strong>ç«‹æ–¹ä½“çº¹ç†ï¼ˆCubemapï¼‰</strong> æ˜¯ç¯å¢ƒæ˜ å°„ï¼ˆEnvironment Mappingï¼‰çš„ä¸€ç§å®ç°æ–¹æ³•ã€‚ç¯å¢ƒæ˜ å°„å¯ä»¥æ¨¡æ‹Ÿç‰©ä½“å‘¨å›´çš„ç¯å¢ƒï¼Œè€Œä½¿ç”¨äº†ç¯å¢ƒæ˜ å°„çš„ç‰©ä½“å¯ä»¥çœ‹èµ·æ¥åƒé•€äº†å±‚é‡‘å±ä¸€æ · <strong>åå°„å‡ºå‘¨å›´çš„ç¯å¢ƒ</strong>ã€‚</p><p>ä¼˜ç‚¹</p><ul><li>ç«‹æ–¹ä½“çº¹ç†çš„å®ç°ç®€å•å¿«æ·ï¼Œè€Œä¸”å¾—åˆ°çš„æ•ˆæœä¹Ÿæ¯”è¾ƒå¥½ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>å½“åœºæ™¯ä¸­å¼•å…¥äº†æ–°çš„ç‰©ä½“ã€å…‰æºï¼Œæˆ–è€…ç‰©ä½“å‘ç”Ÿç§»åŠ¨æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡æ–°ç”Ÿæˆç«‹æ–¹ä½“çº¹ç†ã€‚</li><li>ç«‹æ–¹ä½“çº¹ç†ä¹Ÿä»…å¯ä»¥åå°„ç¯å¢ƒï¼Œä½†ä¸èƒ½åå°„ä½¿ç”¨äº†è¯¥ç«‹æ–¹ä½“çº¹ç†çš„ç‰©ä½“æœ¬èº«ã€‚è¿™æ˜¯å› ä¸ºï¼Œç«‹æ–¹ä½“çº¹ç†ä¸èƒ½æ¨¡æ‹Ÿå¤šæ¬¡åå°„çš„ç»“æœã€‚</li></ul><p>ç»¼åˆè€ƒè™‘ä¸‹æ¥ï¼Œç«‹æ–¹ä½“çº¹ç†é€‚ç”¨äºå‡¸é¢ä½“ï¼Œè€Œä¸å¤ªé€‚ç”¨äºå‡¹é¢ä½“ ( å› ä¸ºå‡¹é¢ä½“ä¼šåå°„è‡ªèº« )ã€‚</p><h3 id=ç«‹æ–¹ä½“çº¹ç†ç”¨äºç¯å¢ƒæ˜ å°„>ç«‹æ–¹ä½“çº¹ç†â€”ç”¨äºç¯å¢ƒæ˜ å°„</h3><p>ç«‹æ–¹ä½“çº¹ç†æœ€å¸¸è§çš„ç”¨å¤„æ˜¯ç”¨äºç¯å¢ƒæ˜ å°„ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ <strong>æ¨¡æ‹Ÿå‡ºé‡‘å±è´¨æ„Ÿçš„æè´¨</strong>ã€‚</p><p>åˆ›å»ºç”¨äºç¯å¢ƒæ˜ å°„çš„ç«‹æ–¹ä½“çº¹ç†çš„ä¸‰ç§æ–¹æ³•ï¼š</p><ol><li>ç›´æ¥ç”±ä¸€äº›ç‰¹æ®Šå¸ƒå±€çš„çº¹ç†åˆ›å»ºï¼›</li><li>æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªCubemapèµ„æºï¼Œå†æŠŠ6å¼ å›¾èµ‹ç»™å®ƒï¼›</li><li>ç”±è„šæœ¬ç”Ÿæˆã€‚</li></ol><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼šæä¾›ä¸€å¼ å…·æœ‰ç‰¹æ®Šå¸ƒå±€çš„çº¹ç†ï¼Œä¾‹å¦‚ç±»ä¼¼ç«‹æ–¹ä½“å±•å¼€å›¾çš„äº¤å‰å¸ƒå±€ã€å…¨æ™¯å¸ƒå±€ç­‰ï¼ˆå°±ç±»ä¼¼äºäººç‰©è´´å›¾ï¼Œæ¢æˆäº†çƒå½¢ï¼‰ã€‚ç„¶ååªéœ€æŠŠè¯¥çº¹ç†çš„ <strong>Texture Type</strong> è®¾ç½®ä¸º <strong>Cubemap</strong> å³å¯ï¼ŒUnity ä¼šåšå¥½å‰©ä¸‹çš„äº‹æƒ…ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•ï¼šå…ˆåœ¨é¡¹ç›®èµ„æºä¸­åˆ›å»ºä¸€ä¸ª <strong>Cubemap</strong>ï¼Œç„¶åæŠŠå®ƒçš„ 6 å¼ çº¹ç†æ‹–æ‹½åˆ°å®ƒçš„é¢æ¿ä¸­ã€‚åœ¨ Unity 5 ä¸­ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•åˆ›å»ºç«‹æ–¹ä½“çº¹ç†ï¼Œè¿™æ˜¯å› ä¸ºç¬¬ä¸€ç§æ–¹æ³•å¯ä»¥å¯¹çº¹ç†æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œå³å¯ä»¥æ”¯æŒè¾¹ç¼˜ä¿®æ­£ã€å…‰æ»‘åå°„ï¼ˆglossy reflectionï¼‰å’Œ HDR ç­‰åŠŸèƒ½ã€‚</p><p>ç¬¬ä¸‰ç§æ–¹æ³•ï¼šä½¿ç”¨ <strong>Camera.RenderToCubemap</strong> å‡½æ•°æ¥å®ç°ï¼ŒCamera.RenderToCubemap å‡½æ•°å¯ä»¥æŠŠä»»æ„ä½ç½®è§‚å¯Ÿåˆ°çš„åœºæ™¯å›¾åƒå­˜å‚¨åˆ° 6 å¼ å›¾åƒä¸­ï¼Œä»è€Œåˆ›å»ºå‡ºè¯¥ä½ç½®ä¸Šå¯¹åº”çš„ç«‹æ–¹ä½“çº¹ç†ã€‚</p><ol><li><p>åˆ›å»ºä¸€ä¸ªç¼–è¾‘å™¨è„šæœ¬ï¼Œç”¨äºå°†æ‘„åƒæœºç…§å°„åˆ°çš„å›¾ç‰‡æ¸²æŸ“åˆ° Cubemap ä¸­ã€‚ç”±äºè¯¥ä»£ç éœ€è¦æ·»åŠ èœå•æ¡ç›®ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠå®ƒæ”¾åœ¨ Editor æ–‡ä»¶å¤¹ä¸‹æ‰èƒ½æ­£ç¡®æ‰§è¡Œã€‚åŸç†å¦‚ä¸‹:</p><p>åœ¨ renderFromPositionï¼ˆç”±ç”¨æˆ·æŒ‡å®šï¼‰ä½ç½®å¤„åŠ¨æ€åˆ›å»ºä¸€ä¸ªæ‘„åƒæœºï¼Œå¹¶è°ƒç”¨ Camera.RenderToCubemap å‡½æ•°æŠŠä»å½“å‰ä½ç½®è§‚å¯Ÿåˆ°çš„å›¾åƒæ¸²æŸ“åˆ°ç”¨æˆ·æŒ‡å®šçš„ç«‹æ–¹ä½“çº¹ç† cubemap ä¸­ï¼Œå®Œæˆåå†é”€æ¯ä¸´æ—¶æ‘„åƒæœºã€‚</p><div class=highlight><pre class=chroma><code class=language-c# data-lang=c#><span class=k>using</span> <span class=nn>UnityEngine</span><span class=p>;</span>
<span class=k>using</span> <span class=nn>UnityEditor</span><span class=p>;</span>
<span class=k>using</span> <span class=nn>System.Collections</span><span class=p>;</span>

<span class=k>public</span> <span class=k>class</span> <span class=nc>RenderCubemapWizard</span> <span class=p>:</span> <span class=n>ScriptableWizard</span> <span class=p>{</span>

	<span class=k>public</span> <span class=n>Transform</span> <span class=n>renderFromPosition</span><span class=p>;</span>
	<span class=k>public</span> <span class=n>Cubemap</span> <span class=n>cubemap</span><span class=p>;</span>

	<span class=k>void</span> <span class=n>OnWizardUpdate</span> <span class=p>()</span> <span class=p>{</span>
     <span class=n>helpString</span> <span class=p>=</span> <span class=s>&#34;é€‰æ‹©è¦æ¸²æŸ“çš„åæ ‡ä½ç½®å’Œè¦æ¸²æŸ“çš„cubemap&#34;</span><span class=p>;</span>
     <span class=n>isValid</span> <span class=p>=</span> <span class=p>(</span><span class=n>renderFromPosition</span> <span class=p>!=</span> <span class=k>null</span><span class=p>)</span> <span class=p>&amp;&amp;</span> <span class=p>(</span><span class=n>cubemap</span> <span class=p>!=</span> <span class=k>null</span><span class=p>);</span>
	<span class=p>}</span>

	<span class=k>void</span> <span class=n>OnWizardCreate</span> <span class=p>()</span> <span class=p>{</span>
     <span class=c1>// åˆ›å»ºç”¨äºæ¸²æŸ“çš„ä¸´æ—¶æ‘„åƒæœº
</span><span class=c1></span>     <span class=n>GameObject</span> <span class=n>go</span> <span class=p>=</span> <span class=k>new</span> <span class=n>GameObject</span><span class=p>(</span> <span class=s>&#34;CubemapCamera&#34;</span><span class=p>);</span>
     <span class=n>go</span><span class=p>.</span><span class=n>AddComponent</span><span class=p>&lt;</span><span class=n>Camera</span><span class=p>&gt;();</span>
     <span class=c1>// æŠŠå®ƒæ”¾åˆ°ç‰©ä½“åæ ‡ä¸Š
</span><span class=c1></span>     <span class=n>go</span><span class=p>.</span><span class=n>transform</span><span class=p>.</span><span class=n>position</span> <span class=p>=</span> <span class=n>renderFromPosition</span><span class=p>.</span><span class=n>position</span><span class=p>;</span>
     <span class=c1>// æ¸²æŸ“æˆcubemap
</span><span class=c1></span>     <span class=n>go</span><span class=p>.</span><span class=n>GetComponent</span><span class=p>&lt;</span><span class=n>Camera</span><span class=p>&gt;().</span><span class=n>RenderToCubemap</span><span class=p>(</span><span class=n>cubemap</span><span class=p>);</span>

     <span class=c1>// é”€æ¯ä¸´æ—¶ç›¸æœº
</span><span class=c1></span>     <span class=n>DestroyImmediate</span><span class=p>(</span> <span class=n>go</span> <span class=p>);</span>
	<span class=p>}</span>
<span class=na>
</span><span class=na>	[MenuItem(&#34;GameObject/Render into Cubemap&#34;)]</span>
	<span class=k>static</span> <span class=k>void</span> <span class=n>RenderCubemap</span> <span class=p>()</span> <span class=p>{</span>
     <span class=n>ScriptableWizard</span><span class=p>.</span><span class=n>DisplayWizard</span><span class=p>&lt;</span><span class=n>RenderCubemapWizard</span><span class=p>&gt;(</span>
         <span class=s>&#34;Render cubemap&#34;</span><span class=p>,</span> <span class=s>&#34;Render!&#34;</span><span class=p>);</span>
	<span class=p>}</span>
<span class=p>}</span>
</code></pre></div></li><li><p>æ–°å»ºä¸€ä¸ªç”¨äºå­˜å‚¨çš„ç«‹æ–¹ä½“çº¹ç†ï¼ˆåœ¨ Project è§†å›¾ä¸‹å•å‡»å³é”®ï¼Œé€‰æ‹© Create -> Legacy -> Cubemapæ¥åˆ›å»ºï¼‰ã€‚ä¸ºäº†è®©è„šæœ¬å¯ä»¥é¡ºåˆ©å°†å›¾åƒæ¸²æŸ“åˆ°è¯¥ç«‹æ–¹ä½“çº¹ç†ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®ƒçš„é¢æ¿ä¸­å‹¾é€‰ <strong>Readable</strong> é€‰é¡¹ã€‚</p></li><li><p>ä» Unity èœå•æ é€‰æ‹© GameObject -> Render into Cubemapï¼Œæ‰“å¼€æˆ‘ä»¬åœ¨è„šæœ¬ä¸­å®ç°çš„ç”¨äºæ¸²æŸ“ç«‹æ–¹ä½“çº¹ç†çš„çª—å£ï¼Œå¹¶æŠŠç¬¬ä¸€æ­¥åˆ›å»ºçš„ GameObject å’Œç¬¬äºŒæ­¥ä¸­çš„çº¹ç†åˆ†åˆ«æ‹–æ‹½åˆ°çª—å£ä¸­çš„ Render From Position å’Œ Cubemap é€‰é¡¹ã€‚</p></li><li><p>å•å‡»çª—å£çš„ Renderï¼æŒ‰é’®ï¼Œå°±å¯ä»¥æŠŠä»è¯¥ä½ç½®è§‚å¯Ÿåˆ°çš„ä¸–ç•Œç©ºé—´ä¸‹çš„ 6 å¼ å›¾åƒä¸­æ¸²æŸ“åˆ°çº¹ç†ä¸­ã€‚</p></li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸º <strong>Cubemap</strong> è®¾ç½®å¤§å°ï¼Œå³ä¸Šå›¾ä¸­çš„ <strong>Face size</strong> é€‰é¡¹ã€‚<strong>Face size</strong> å€¼è¶Šå¤§ï¼Œæ¸²æŸ“å‡ºæ¥çš„ç«‹æ–¹ä½“çº¹ç†åˆ†è¾¨ç‡è¶Šå¤§ï¼Œæ•ˆæœå¯èƒ½æ›´å¥½ï¼Œå•éœ€è¦å ç”¨çš„å†…å­˜ä¹Ÿè¶Šå¤§ï¼Œè¿™å¯ä»¥ç”±é¢æ¿æœ€ä¸‹æ–¹æ˜¾ç¤ºçš„å†…å­˜å¤§å°å¾—åˆ°ã€‚</p><h3 id=åå°„>åå°„</h3><p>æ¨¡æ‹Ÿåå°„æ•ˆæœå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡ <strong>å…¥å°„å…‰çº¿çš„æ–¹å‘</strong> å’Œ <strong>è¡¨é¢æ³•çº¿æ–¹å‘æ¥è®¡ç®—åå°„æ–¹å‘</strong>ï¼Œå†åˆ©ç”¨ <strong>åå°„æ–¹å‘å¯¹ç«‹æ–¹ä½“çº¹ç†é‡‡æ ·</strong> å³å¯ã€‚</p><p>åå°„ç”¨åˆ° Shader çš„æ˜¯åœ¨æ¼«åå°„æ¨¡å‹ä¸Šè¿›è¡Œä¿®æ”¹çš„ï¼š</p><ol><li>å¢æ·»ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«ç”¨äºæ§åˆ¶åå°„é¢œè‰²ã€åå°„ç¨‹åº¦å’Œæ•æ‰ç¯å¢ƒæ˜ å°„çº¹ç†</li><li>åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å“ªä¸ªä½¿ç”¨<strong>reflect</strong>å‡½æ•°æ¥è®¡ç®—è¯¥é¡¶ç‚¹çš„åå°„æ–¹å‘</li></ol><blockquote><p>reflect ( I, N ) æ ¹æ®å…¥å°„å…‰çº¿æ–¹å‘Iå’Œè¡¨é¢æ³•å‘é‡Nè®¡ç®—åå°„å‘é‡ï¼Œä»…å¯¹ä¸‰å…ƒå‘é‡æœ‰æ•ˆ</p></blockquote><ol start=3><li>åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ä½¿ç”¨ <strong>texCUBE</strong> å‡½æ•°å’Œé¡¶ç‚¹ç€è‰²å™¨ä¸­è·å¾—çš„åå°„æ–¹å‘å¯¹ç«‹æ–¹ä½“çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°åå°„é¢œè‰²</li><li>æœ€åä½¿ç”¨ lerp å¯¹åŸæœ‰æ¼«åå°„ä¸çº¹ç†åå°„é¢œè‰²è¿›è¡Œæ’å€¼</li></ol><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>Reflect</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_Color</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_ReflectColor</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Reflect</span> <span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_ReflectPower</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Reflect</span> <span class=n>Power</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.2</span>
        <span class=n>_CubeMap</span><span class=p>(</span><span class=err>&#34;</span><span class=n>CubeMap</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Cube</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>_Skybox</span><span class=err>&#34;</span> <span class=p>{}</span>
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Opaque</span><span class=err>&#34;</span> <span class=p>}</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>Tags</span> <span class=p>{</span><span class=err>&#34;</span><span class=n>LightMode</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>ForwardBase</span><span class=err>&#34;</span><span class=p>}</span>

            <span class=n>CGPROGRAM</span>

            <span class=err>#</span><span class=n>pragma</span> <span class=n>multi_compile_fwdbase</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>AutoLight</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=n>float4</span> <span class=n>_Color</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_ReflectColor</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_ReflectPower</span><span class=p>;</span>
            <span class=n>samplerCUBE</span> <span class=n>_CubeMap</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>pos</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldNormal</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldPos</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldRefl</span> <span class=o>:</span> <span class=n>TEXCOOR2</span><span class=p>;</span>
                <span class=n>SHADOW_COORDS</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span> <span class=o>=</span> <span class=n>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldPos</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldRefl</span> <span class=o>=</span> <span class=n>reflect</span><span class=p>(</span><span class=o>-</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>worldPos</span><span class=p>),</span> <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span> <span class=c1>// åå°„æ–¹å‘</span>

                <span class=n>TRANSFER_SHADOW</span><span class=p>(</span><span class=n>o</span><span class=p>);</span>
                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>worldNormal</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>worldLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceLightDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>
                <span class=n>half3</span> <span class=n>worldViewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>
                <span class=n>half3</span> <span class=n>halfDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>worldLightDir</span> <span class=o>+</span> <span class=n>worldViewDir</span><span class=p>);</span>

                <span class=k>half</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>worldLightDir</span><span class=p>));</span>
                <span class=n>half3</span> <span class=n>reflection</span> <span class=o>=</span> <span class=n>texCUBE</span><span class=p>(</span><span class=n>_CubeMap</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>worldRefl</span><span class=p>).</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_ReflectColor</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span> <span class=c1>// é‡‡æ · Cubemap è®¡ç®—åå°„</span>

                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span><span class=p>;</span>
                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>NdotL</span><span class=p>;</span>

                <span class=n>UNITY_LIGHT_ATTENUATION</span><span class=p>(</span><span class=n>atten</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>);</span>
                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>lerp</span><span class=p>(</span><span class=n>diffuse</span><span class=p>,</span> <span class=n>reflection</span><span class=p>,</span> <span class=n>_ReflectPower</span><span class=p>)</span> <span class=o>*</span> <span class=n>atten</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=n>Fallback</span> <span class=err>&#34;</span><span class=n>Diffuse</span><span class=err>&#34;</span>
<span class=p>}</span>
</code></pre></div><h3 id=æŠ˜å°„>æŠ˜å°„</h3><p>ç»™å®šå…¥å°„è§’æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>æ–¯æ¶…å°”å®šå¾‹ (Snellâ€™s law )</strong> æ¥è®¡ç®—åå°„è§’ã€‚å½“å…‰ä»ä»‹è´¨ 1 æ²¿ç€å’Œè¡¨é¢æ³•çº¿å¤¹è§’ä¸º Î¸1 çš„æ–¹å‘æ–œå°„å…¥ä»‹è´¨ 2 æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å…¬å¼è®¡ç®—æŠ˜å°„å…‰çº¿ä¸æ³•çº¿çš„å¤¹è§’Î¸2ï¼š</p><blockquote><p>Î·1 sinÎ¸1 = Î·2 sinÎ¸2</p></blockquote><p>å…¶ä¸­ Î·1 å’Œ Î·2 åˆ†åˆ«æ˜¯ä¸¤ä¸ªä»‹è´¨çš„ <strong>æŠ˜å°„ç‡ (index of refraction )</strong> ã€‚æŠ˜å°„ç‡æ˜¯ä¸€é¡¹é‡è¦çš„ç‰©ç†å¸¸é‡ï¼Œä¾‹å¦‚çœŸç©ºçš„æŠ˜å°„ç‡æ˜¯ 1ï¼Œè€Œç»ç’ƒçš„æŠ˜å°„ç‡ä¸€èˆ¬æ˜¯ 1.5ã€‚</p><p>æŠ˜å°„ç”¨åˆ° Shader ä¸­ä¸åå°„ç±»ä¼¼ï¼Œä¾æ—§ä½¿ç”¨ <strong>refract</strong> å‡½æ•°æ¥è®¡ç®—è¯¥é¡¶ç‚¹çš„æŠ˜å°„æ–¹å‘ï¼Œä½†ä¸åŒçš„æ˜¯é‡‡ç”¨äº†ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°å³ä¸ºå…¥å°„å…‰çº¿æ–¹å‘ï¼Œå®ƒå¿…é¡»æ˜¯å½’ä¸€åŒ–åçš„çŸ¢é‡ï¼›</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¡¨é¢æ³•çº¿ï¼Œæ³•çº¿æ–¹å‘åŒæ ·æ˜¯è¦å½’ä¸€åŒ–åçš„ï¼›</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å…¥å°„å…‰çº¿æ‰€åœ¨ä»‹è´¨çš„æŠ˜å°„ç‡å’ŒæŠ˜å°„å…‰çº¿æ‰€åœ¨ä»‹è´¨çš„æŠ˜å°„ç‡ä¹‹é—´çš„æ¯”å€¼ã€‚</li></ul><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>Refract</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_Color</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_RefractColor</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Refract</span> <span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_RefractPower</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Refract</span> <span class=n>Power</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mi>1</span>
        <span class=n>_RefractRatio</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Refract</span> <span class=n>Ratio</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>0.01</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.2</span>
        <span class=n>_Cubemap</span><span class=p>(</span><span class=err>&#34;</span><span class=n>CubeMap</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Cube</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>_Skybox</span><span class=err>&#34;</span> <span class=p>{</span> <span class=p>}</span>
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Opaque</span><span class=err>&#34;</span> <span class=p>}</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>Tags</span> <span class=p>{</span><span class=err>&#34;</span><span class=n>LightMode</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>ForwardBase</span><span class=err>&#34;</span><span class=p>}</span>

            <span class=n>CGPROGRAM</span>

            <span class=err>#</span><span class=n>pragma</span> <span class=n>multi_compile_fwdbase</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>AutoLight</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=n>float4</span> <span class=n>_Color</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_RefractColor</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_RefractPower</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_RefractRatio</span><span class=p>;</span>
            <span class=n>samplerCUBE</span> <span class=n>_Cubemap</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>pos</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldPos</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldNormal</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldRefra</span> <span class=o>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
                <span class=n>SHADOW_COORDS</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span> <span class=o>=</span> <span class=n>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldPos</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldRefra</span> <span class=o>=</span> <span class=n>refract</span><span class=p>(</span><span class=o>-</span><span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>worldPos</span><span class=p>)),</span> <span class=n>normalize</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>),</span> <span class=n>_RefractRatio</span><span class=p>);</span> <span class=c1>// è®¡ç®—æŠ˜å°„æ–¹å‘</span>

                <span class=n>TRANSFER_SHADOW</span><span class=p>(</span><span class=n>o</span><span class=p>);</span>
                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>worldNormal</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>worldLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceLightDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>
                <span class=n>half3</span> <span class=n>worldViewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>
                
                <span class=k>half</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>worldLightDir</span><span class=p>));</span>
                <span class=n>half3</span> <span class=n>refraction</span> <span class=o>=</span> <span class=n>texCUBE</span><span class=p>(</span><span class=n>_Cubemap</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>worldRefra</span><span class=p>).</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_RefractColor</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span> <span class=c1>// é‡‡æ · Cubemap è®¡ç®—æŠ˜å°„</span>

                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span><span class=p>;</span>
                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>NdotL</span><span class=p>;</span>

                <span class=n>UNITY_LIGHT_ATTENUATION</span><span class=p>(</span><span class=n>atten</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>);</span>
                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>lerp</span><span class=p>(</span><span class=n>diffuse</span><span class=p>,</span> <span class=n>refraction</span><span class=p>,</span> <span class=n>_RefractPower</span><span class=p>)</span> <span class=o>*</span> <span class=n>atten</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=n>Fallback</span> <span class=err>&#34;</span><span class=n>Reflective</span><span class=o>/</span><span class=n>VertexLit</span><span class=err>&#34;</span>
<span class=p>}</span>
</code></pre></div><h3 id=è²æ¶…å°”åå°„>è²æ¶…å°”åå°„</h3><p>ä½¿ç”¨ <strong>è²æ¶…å°”åå°„ (Fresnel reflection )</strong> æ¥æ ¹æ®è§†è§’æ–¹å‘æ§åˆ¶åå°„è¿‡ç¨‹ï¼Œè²æ¶…å°”åå°„æè¿°äº†ä¸€ç§å…‰å­¦ç°è±¡ï¼Œå³å½“å…‰çº¿ç…§å°„åˆ°ç‰©ä½“è¡¨é¢ä¸Šæ—¶ï¼Œä¸€éƒ¨åˆ†å‘ç”Ÿåå°„ï¼Œä¸€éƒ¨åˆ†è¿›å…¥ç‰©ä½“å†…éƒ¨ï¼Œå‘ç”ŸæŠ˜å°„æˆ–æ•£å°„ã€‚è¢«åå°„çš„å…‰å’Œå…¥å°„å…‰ä¹‹é—´å­˜åœ¨ä¸€å®šçš„æ¯”ç‡å…³ç³»ï¼Œè¿™ä¸ªæ¯”ç‡å…³ç³»å¯ä»¥é€šè¿‡è²æ¶…å°”ç­‰å¼è¿›è¡Œè®¡ç®—ã€‚</p><p>ä¸€ä¸ªç»å¸¸ä½¿ç”¨çš„ä¾‹å­æ˜¯ï¼Œå½“ä½ ç«™åœ¨æ¹–è¾¹ï¼Œç›´æ¥ä½å¤´çœ‹è„šè¾¹çš„æ°´é¢æ—¶ï¼Œä½ ä¼šå‘ç°æ°´å‡ ä¹æ˜¯é€æ˜çš„ï¼Œä½ å¯ä»¥ç›´æ¥çœ‹åˆ°æ°´åº•çš„å°é±¼å’ŒçŸ³å­ï¼›ä½†æ˜¯å½“ä½ æŠ¬å¤´çœ‹è¿œå¤„çš„æ°´é¢æ—¶ï¼Œä¼šå‘ç°å‡ ä¹çœ‹ä¸åˆ°æ°´ä¸‹çš„æƒ…æ™¯ï¼Œè€Œåªèƒ½çœ‹åˆ°æ°´é¢åå°„çš„ç¯å¢ƒã€‚è¿™å°±æ˜¯æ‰€è°“çš„è²æ¶…å°”æ•ˆæœã€‚</p><p>çœŸå®ä¸–ç•Œçš„è²æ¶…å°”ç­‰å¼æ˜¯éå¸¸å¤æ‚çš„ï¼Œä½†åœ¨å®æ—¶æ¸²æŸ“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ä¸€äº›è¿‘ä¼¼å…¬å¼æ¥è®¡ç®—ã€‚å…¶ä¸­ä¸€ä¸ªè‘—åçš„è®¡ç®—å…¬å¼å°±æ˜¯ <strong>Schlickè²æ¶…å°”</strong> è¿‘ä¼¼ç­‰å¼ï¼š</p><blockquote><p>FSchlick ( v , n ) = F0 + ( 1 - F0 ) ( 1 - v Â· n)5</p></blockquote><p>å…¶ä¸­ï¼ŒF0 æ˜¯ä¸€ä¸ªåå°„ç³»æ•°ï¼Œç”¨äºæ§åˆ¶è²æ¶…å°”åå°„çš„å¼ºåº¦ï¼Œv æ˜¯è§†è§’æ–¹å‘ï¼Œn æ˜¯è¡¨é¢æ³•çº¿ã€‚å¦ä¸€ä¸ªåº”ç”¨æ¯”è¾ƒå¹¿æ³›çš„ç­‰å¼æ˜¯ <strong>Empricialè²æ¶…å°”</strong> è¿‘ä¼¼ç­‰å¼ï¼š</p><blockquote><p>FEmpricial ( v , n ) = max ( 0 , min ( 1 , bias + scale * ( 1 - v Â· n ) power))</p></blockquote><p>å…¶ä¸­ biasã€scale å’Œ power æ˜¯æ§åˆ¶é¡¹ã€‚</p><p>ä¸‹é¢å°†ä½¿ç”¨ <strong>Schlickè²æ¶…å°”</strong> è¿‘ä¼¼ç­‰å¼æ¥æ¨¡æ‹Ÿè²æ¶…å°”åå°„ã€‚åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ï¼Œæˆ‘ä»¬å¥—ç”¨ Schlick è²æ¶…å°”å…¬å¼æ¥è®¡ç®—è²å°¼å°”æ¯”ç‡ï¼Œç„¶åç”¨è¯¥æ¯”ç‡æ’å€¼æ··åˆ <strong>æ¼«åå°„å…‰ç…§</strong> å’Œ <strong>åå°„å…‰ç…§</strong> ã€‚</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>Fresnel</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_Color</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_FresnelScale</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Fresnel</span> <span class=n>Scale</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span> <span class=o>=</span> <span class=mf>0.5</span>
        <span class=n>_CubeMap</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Cube</span> <span class=n>Map</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Cube</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>_Skybox</span><span class=err>&#34;</span>
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Opaque</span><span class=err>&#34;</span> <span class=p>}</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>Tags</span> <span class=p>{</span><span class=err>&#34;</span><span class=n>LightMode</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>ForwardBase</span><span class=err>&#34;</span><span class=p>}</span>

            <span class=n>CGPROGRAM</span>

            <span class=err>#</span><span class=n>pragma</span> <span class=n>multi_compile_fwdbase</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>AutoLight</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=n>float4</span> <span class=n>_Color</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_FresnelScale</span><span class=p>;</span>
            <span class=n>samplerCUBE</span> <span class=n>_CubeMap</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>pos</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldNormal</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldPos</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldRefl</span> <span class=o>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
                <span class=n>SHADOW_COORDS</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span> <span class=o>=</span> <span class=n>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldPos</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldRefl</span> <span class=o>=</span> <span class=n>reflect</span><span class=p>(</span><span class=o>-</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>worldPos</span><span class=p>),</span> <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span> <span class=c1>// è®¡ç®—åå°„æ–¹å‘</span>

                <span class=n>TRANSFER_SHADOW</span><span class=p>(</span><span class=n>o</span><span class=p>);</span>
                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>worldNormal</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>worldLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceLightDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>
                <span class=n>half3</span> <span class=n>worldViewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>

                <span class=k>half</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>worldLightDir</span><span class=p>));</span>
                <span class=n>half3</span> <span class=n>reflection</span> <span class=o>=</span> <span class=n>texCUBE</span><span class=p>(</span><span class=n>_CubeMap</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>worldRefl</span><span class=p>).</span><span class=n>rgb</span><span class=p>;</span> <span class=c1>// é‡‡æ · Cubemap</span>
                <span class=k>half</span> <span class=n>fresnel</span> <span class=o>=</span> <span class=n>_FresnelScale</span> <span class=o>+</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>_FresnelScale</span><span class=p>)</span> <span class=o>*</span> <span class=n>pow</span><span class=p>((</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldViewDir</span><span class=p>,</span> <span class=n>worldNormal</span><span class=p>)),</span> <span class=mf>5.0</span><span class=p>);</span> <span class=c1>// è®¡ç®— Fresnel æ•ˆæœ</span>
                
                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span><span class=p>;</span>
                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>NdotL</span><span class=p>;</span>

                <span class=n>UNITY_LIGHT_ATTENUATION</span><span class=p>(</span><span class=n>atten</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>);</span>
                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>lerp</span><span class=p>(</span><span class=n>diffuse</span><span class=p>,</span> <span class=n>reflection</span><span class=p>,</span> <span class=n>saturate</span><span class=p>(</span><span class=n>fresnel</span><span class=p>))</span> <span class=o>*</span> <span class=n>atten</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=err>&#34;</span><span class=n>Reflective</span><span class=o>/</span><span class=n>VertexLit</span><span class=err>&#34;</span>
<span class=p>}</span>
</code></pre></div><h2 id=æ¸²æŸ“çº¹ç†>æ¸²æŸ“çº¹ç†</h2><p>ä¸€ä¸ªæ‘„åƒæœºçš„æ¸²æŸ“ç»“æœä¼šè¾“å‡ºåˆ°é¢œè‰²ç¼“å†²ä¸­ï¼Œå¹¶æ˜¾ç¤ºåˆ°æˆ‘ä»¬çš„å±å¹•ä¸Šã€‚ç°ä»£çš„ GPU å…è®¸æˆ‘ä»¬æŠŠæ•´ä¸ªä¸‰ç»´åœºæ™¯æ¸²æŸ“åˆ°ä¸€ä¸ªä¸­é—´ç¼“å­˜ä¸­ï¼Œå³ <strong>æ¸²æŸ“ç›®æ ‡çº¹ç† (Render Target Textureï¼ŒRTT)</strong> ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„ <strong>å¸§ç¼“å†²æˆ–åå¤‡ç¼“å†² ( back buffer )</strong> ã€‚ä¸ä¹‹ç›¸å…³çš„æ˜¯ <strong>å¤šé‡æ¸²æŸ“ç›®æ ‡ ( Multiple Render Target ï¼ŒMRT )</strong> ï¼Œè¿™ç§æŠ€æœ¯æŒ‡çš„æ˜¯ GPU å…è®¸æˆ‘ä»¬æŠŠåœºæ™¯åŒæ—¶æ¸²æŸ“åˆ°å¤šä¸ªç›®æ ‡çº¹ç†ä¸­ï¼Œè€Œä¸å†éœ€è¦ä¸ºæ¯ä¸ªæ¸²æŸ“ç›®æ ‡çº¹ç†å•ç‹¬æ¸²æŸ“å®Œæ•´çš„åœºæ™¯ã€‚å»¶è¿Ÿæ¸²æŸ“å°±æ˜¯ä½¿ç”¨å¤šé‡æ¸²æŸ“ç›®æ ‡çš„ä¸€ä¸ªåº”ç”¨ã€‚</p><p>Unity ä¸ºæ¸²æŸ“ç›®æ ‡çº¹ç†å®šä¹‰äº†ä¸€ç§ä¸“é—¨çš„çº¹ç†ç±»å‹â€”â€” <strong>æ¸²æŸ“çº¹ç† ( Render Texture )</strong> ã€‚åœ¨ Unity ä¸­ä½¿ç”¨æ¸²æŸ“çº¹ç†é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>ä¸€ç§æ–¹å¼æ˜¯åœ¨ Project ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <strong>æ¸²æŸ“çº¹ç†</strong> ï¼Œç„¶åæŠŠæŸä¸ªæ‘„åƒæœºçš„ <strong>æ¸²æŸ“ç›®æ ‡</strong> è®¾ç½®æˆè¯¥ <strong>æ¸²æŸ“çº¹ç†</strong> ï¼Œè¿™æ ·ä¸€æ¥è¯¥æ‘„åƒæœºçš„æ¸²æŸ“ç»“æœå°±ä¼šå®æ—¶æ›´æ–°åˆ° <strong>æ¸²æŸ“çº¹ç†</strong> ä¸­ï¼Œè€Œä¸ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©çº¹ç†çš„åˆ†è¾¨ç‡ã€æ»¤æ³¢æ¨¡å¼ç­‰çº¹ç†å±æ€§ã€‚</li><li>å¦ä¸€ç§æ–¹å¼æ˜¯åœ¨å±å¹•åå¤„ç†æ—¶ä½¿ç”¨ <strong>GrabPass</strong> å‘½ä»¤æˆ– <strong>OnRenderImage</strong> å‡½æ•°æ¥è·å–å½“å‰å±å¹•å›¾åƒï¼ŒUnity ä¼šæŠŠè¿™ä¸ªå±å¹•å›¾åƒæ”¾åˆ°ä¸€å¼ å’Œå±å¹•åˆ†è¾¨ç‡ç­‰åŒçš„æ¸²æŸ“çº¹ç†ä¸­ï¼Œä¸‹é¢æˆ‘ä»¬å¯ä»¥åœ¨è‡ªå®šä¹‰çš„ Pass ä¸­æŠŠå®ƒä»¬å½“æˆæ™®é€šçº¹ç†æ¥å¤„ç†ï¼Œä»è€Œå®ç°å„ç§å±å¹•ç‰¹æ•ˆã€‚</li></ul><h3 id=é•œå­æ•ˆæœ>é•œå­æ•ˆæœ</h3><p>å…³é”®åœ¨äºæ–°å»ºä¸€ä¸ªæ‘„åƒæœºï¼Œä¸€ä¸ª Render Textureï¼Œå°†æ–°å»ºçš„ Render Texture å½“ä½œæ–°å»ºç›¸æœºçš„ <strong>Target Texture</strong> ï¼Œæ–°å»ºä¸€ä¸ª Shaderï¼Œshader é‡Œå£°æ˜ä¸€ä¸ª 2D çº¹ç†å±æ€§ï¼Œå°†æ–°å»ºçš„ Render Texture èµ‹å€¼ç»™å®ƒã€‚</p><ol><li>åˆ›å»ºä¸€ä¸ªå››è¾¹å½¢ï¼ˆQuadï¼‰ï¼Œè°ƒæ•´å®ƒçš„ä½ç½®å’Œå¤§å°ï¼Œç”¨äºå……å½“é•œå­ã€‚</li><li>ä¸ºäº†å¾—åˆ°ä»é•œå­å‡ºå‘è§‚å¯Ÿåˆ°çš„åœºæ™¯å›¾åƒï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ‘„åƒæœºï¼Œå¹¶è°ƒæ•´å®ƒçš„ä½ç½®ã€è£å‰ªå¹³é¢ã€è§†è§’ç­‰ï¼Œä½¿å¾—å®ƒæ˜¾ç¤ºçš„å›¾åƒæ˜¯æˆ‘ä»¬å¸Œæœ›çš„é•œå­çš„å›¾åƒã€‚</li><li>ç”±äºè¿™ä¸ªæ‘„åƒæœºä¸éœ€è¦ç›´æ¥æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œè€Œæ˜¯ç”¨äºæ¸²æŸ“çº¹ç†ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ª <strong>Texture</strong> å¹¶æ‹–æ‹½åˆ°è¯¥æ‘„åƒæœºçš„ <strong>Target Texture</strong> ä¸Šã€‚</li></ol><p>å…³äº Quad çš„ç€è‰²å™¨å®ç°ä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€è¦å£°æ˜ä¸€ä¸ªçº¹ç†å±æ€§ï¼Œç„¶åå°†è¯¥çº¹ç†è¿›è¡Œå·¦å³ç¿»è½¬åè¾“å‡ºã€‚</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>Mirror</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_MainTex</span> <span class=p>(</span><span class=err>&#34;</span><span class=n>Texture</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Opaque</span><span class=err>&#34;</span> <span class=p>}</span>
        <span class=n>LOD</span> <span class=mi>100</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>CGPROGRAM</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=k>sampler2D</span> <span class=n>_MainTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_MainTex_ST</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>texcoord</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>pos</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>uv</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>

                <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>x</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>x</span><span class=p>;</span> <span class=c1>// åè½¬ x è½´</span>
                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>fixed4</span> <span class=n>col</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span>
                <span class=k>return</span> <span class=n>col</span><span class=p>;</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=n>FallBack</span> <span class=n>Off</span>
<span class=p>}</span>
</code></pre></div><h3 id=ç»ç’ƒæ•ˆæœ>ç»ç’ƒæ•ˆæœ</h3><p>Unity ä¸­ï¼Œè¿˜å¯ä»¥åœ¨ Unity Shader ä¸­ä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„ Pass æ¥å®Œæˆè·å–å±å¹•å›¾åƒçš„ç›®çš„ï¼Œè¿™å°±æ˜¯ <strong>GrabPass</strong> ã€‚é€šå¸¸ä¼šä½¿ç”¨ <strong>GrabPass</strong> æ¥å®ç°è¯¸å¦‚ <code>ç»ç’ƒç­‰é€æ˜æè´¨çš„æ¨¡æ‹Ÿ</code> ï¼Œä¸ä½¿ç”¨ç®€å•çš„é€æ˜æ··åˆä¸åŒï¼Œä½¿ç”¨ <strong>GrabPass</strong> å¯ä»¥è®©æˆ‘ä»¬å¯¹ç‰©ä½“åé¢çš„å›¾åƒè¿›è¡Œæ›´å¤æ‚çš„å¤„ç†ï¼Œä¾‹å¦‚ä½¿ç”¨æ³•çº¿æ¥æ¨¡æ‹ŸæŠ˜å°„æ•ˆæœï¼Œè€Œä¸å†æ˜¯ç®€å•çš„å’ŒåŸå±å¹•é¢œè‰²æ··åˆã€‚</p><p>å½“æˆ‘ä»¬åœ¨ Shader ä¸­å®šä¹‰äº†ä¸€ä¸ª <strong>GrabPass</strong> åï¼ŒUnity ä¼šæŠŠå½“å‰å±å¹•çš„å›¾åƒç»˜åˆ¶åœ¨ä¸€å¼ çº¹ç†ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬åœ¨åç»­çš„ Pass ä¸­è®¿é—®å®ƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨ <strong>GrabPass</strong> çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–å°å¿ƒç‰©ä½“çš„æ¸²æŸ“é˜Ÿåˆ—è®¾ç½®ã€‚æ­£å¦‚ä¹‹å‰æ‰€è¯´ï¼Œ<strong>GrabPass</strong> é€šå¸¸ç”¨äºæ¸²æŸ“é€æ˜ç‰©ä½“ï¼Œå°½ç®¡ä»£ç é‡Œå¹¶ä¸åŒ…å«æ··åˆæŒ‡ä»¤ï¼Œä½†æˆ‘ä»¬å¾€å¾€ä»ç„¶éœ€è¦æŠŠç‰©ä½“çš„ <strong>æ¸²æŸ“é˜Ÿåˆ—</strong> è®¾ç½®æˆ <strong>é€æ˜é˜Ÿåˆ—</strong> ï¼ˆå³ <strong>â€œQueueâ€=â€œTransparentâ€</strong> ï¼‰ã€‚è¿™æ ·æ‰èƒ½ä¿è¯æ¸²æŸ“ç‰©ä½“æ—¶ï¼Œæ‰€æœ‰çš„ä¸é€æ˜ç‰©ä½“éƒ½å·²ç»è¢«ç»˜åˆ¶åœ¨å±å¹•ä¸Šï¼Œä»è€Œè·å¾—æ­£ç¡®çš„å±å¹•å›¾åƒã€‚</p><h4 id=grabpass-çš„ä¸¤ç§å½¢å¼>GrabPass çš„ä¸¤ç§å½¢å¼</h4><ul><li>ç›´æ¥ä½¿ç”¨ <strong>GrabPass{}</strong> ï¼Œç„¶ååœ¨åç»­çš„ Pass ä¸­ç›´æ¥ä½¿ç”¨ <strong>_GrabTexture</strong> æ¥è®¿é—®å±å¹•å›¾åƒã€‚ä½†æ˜¯å½“åœºæ™¯ä¸­æœ‰å¤šä¸ªç‰©ä½“éƒ½ä½¿ç”¨äº†è¿™æ ·çš„å½¢å¼æ¥æŠ“å–å±å¹•æ—¶ï¼Œè¿™ç§æ–¹æ³•çš„æ€§èƒ½æ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œå› ä¸ºå¯¹äºæ¯ä¸€ä¸ªä½¿ç”¨å®ƒçš„ç‰©ä½“ï¼ŒUnity éƒ½ä¼šä¸ºå®ƒå•ç‹¬è¿›è¡Œä¸€æ¬¡æ˜‚è´µçš„å±å¹•æŠ“å–æ“ä½œã€‚ä½†è¿™ç§æ–¹æ³•å¯ä»¥è®©æ¯ä¸ªç‰©ä½“å¾—åˆ°ä¸åŒçš„å±å¹•å›¾åƒï¼Œè¿™å–å†³äºå®ƒä»¬çš„æ¸²æŸ“é˜Ÿåˆ—åŠæ¸²æŸ“å®ƒä»¬æ—¶å½“å‰çš„å±å¹•ç¼“å†²ä¸­çš„é¢œè‰²ã€‚</li><li>ä½¿ç”¨ <strong>GrabPass{â€œTextureNameâ€}</strong> ï¼Œæ­£å¦‚æœ¬èŠ‚æ‰€å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åç»­çš„ Pass ä¸­ä½¿ç”¨ <strong>TextureName</strong> æ¥è®¿é—®å±å¹•å›¾åƒã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•åŒæ ·å¯ä»¥æŠ“å–å±å¹•ï¼Œä½† Unity åªä¼šåœ¨æ¯ä¸€å¸§ä¸ºç¬¬ä¸€ä¸ªä½¿ç”¨åä¸º <strong>TextureName</strong> çš„çº¹ç†çš„ç‰©ä½“æ‰§è¡Œä¸€æ¬¡å±å¹•æŠ“å–æ“ä½œï¼Œè€Œè¿™ä¸ªçº¹ç†åŒæ—¶ä¹Ÿå¯ä»¥åœ¨å…¶å®ƒ Pass ä¸­è¢«è®¿é—®ã€‚è¿™ç§æ–¹æ³•æ›´åŠ é«˜æ•ˆï¼Œå› ä¸ºä¸ç®¡åœºæ™¯ä¸­æœ‰å¤šå°‘ç‰©ä½“ä½¿ç”¨äº†è¯¥å‘½ä»¤ï¼Œæ¯ä¸€å¸§ä¸­ Unity éƒ½åªä¼šæ‰§è¡Œä¸€æ¬¡æŠ“å–æ“ä½œï¼Œè¿™ä¹Ÿæ„å‘³ç€æ‰€æœ‰ç‰©ä½“éƒ½ä¼šä½¿ç”¨åŒä¸€å¼ å±å¹•å›¾åƒã€‚ä¸è¿‡ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¿™å·²ç»è¶³å¤Ÿäº†ã€‚</li></ul><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ <strong>GrabPass</strong> æ¥æ¨¡æ‹Ÿä¸€ä¸ªç»ç’ƒæ•ˆæœã€‚</p><h4 id=æ€è·¯>æ€è·¯</h4><p>è¿™ç§æ•ˆæœå®ç°éå¸¸ç®€å•ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ä¸€å¼ æ³•çº¿çº¹ç†æ¥ä¿®æ”¹æ¨¡å‹çš„æ³•çº¿ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨åå°„çš„æ–¹æ³•ï¼Œé€šè¿‡ä¸€ä¸ª <strong>Cubemap</strong> æ¥æ¨¡æ‹Ÿç»ç’ƒåå°„ï¼Œè€Œåœ¨æ¨¡æ‹ŸæŠ˜å°„æ—¶ï¼Œåˆ™ä½¿ç”¨äº† <strong>GrabPass</strong> è·å–ç»ç’ƒåé¢çš„å±å¹•å›¾åƒï¼Œå¹¶ä½¿ç”¨åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿å¯¹å±å¹•çº¹ç†åæ ‡åç§»åï¼Œå†å¯¹å±å¹•å›¾åƒè¿›è¡Œé‡‡æ ·æ¥æ¨¡æ‹Ÿè¿‘ä¼¼çš„æŠ˜å°„æ•ˆæœã€‚</p><h4 id=å…·ä½“å®ç°>å…·ä½“å®ç°</h4><ol><li>æ­å»ºç¯å¢ƒï¼šå»ºç«‹ä¸€ä¸ªæˆ¿é—´ï¼Œç„¶åæ”¾ç½®äº†ä¸€ä¸ªç«‹æ–¹ä½“å’Œçƒä½“ï¼Œå…¶ä¸­çƒä½“ä½äºç«‹æ–¹ä½“å†…éƒ¨ï¼Œè¿™æ˜¯ä¸ºäº†æ¨¡æ‹Ÿç»ç’ƒå¯¹å†…éƒ¨ç‰©ä½“çš„æŠ˜å°„æ•ˆæœã€‚åˆ›å»ºä¸€ä¸ªç€è‰²å™¨ä»˜ç»™ç«‹æ–¹ä½“ã€‚</li><li>åœ¨ç€è‰²å™¨ä¸­ï¼Œæˆ‘ä»¬æŠŠ <strong>Queue</strong> è®¾ç½®æˆ <strong>Transparent</strong> å¯ä»¥ä¿è¯è¯¥ç‰©ä½“æ¸²æŸ“æ—¶ï¼Œå…¶å®ƒæ‰€æœ‰ä¸é€æ˜ç‰©ä½“éƒ½å·²ç»è¢«æ¸²æŸ“åˆ°å±å¹•ä¸Šäº†ï¼Œå¦åˆ™å°±å¯èƒ½æ— æ³•æ­£ç¡®å¾—åˆ°â€œé€è¿‡ç»ç’ƒçœ‹åˆ°çš„å›¾åƒâ€ã€‚</li><li>ç„¶åè®¾ç½® <strong>RenderType</strong> ä¸º <strong>Opaque</strong> åˆ™æ˜¯ä¸ºäº†åœ¨ä½¿ç”¨ <strong>ç€è‰²å™¨æ›¿æ¢ ( Shader Replacement )</strong> æ—¶ï¼Œè¯¥ç‰©ä½“å¯ä»¥åœ¨éœ€è¦æ—¶è¢«æ­£ç¡®æ¸²æŸ“ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨æˆ‘ä»¬éœ€è¦å¾—åˆ°æ‘„åƒæœºçš„æ·±åº¦å’Œæ³•çº¿çº¹ç†æ—¶ã€‚</li><li>é€šè¿‡å…³é”®è¯ <strong>CrabPass</strong> å®šä¹‰äº†ä¸€ä¸ªæŠ“å–å±å¹•å›¾åƒçš„ Passã€‚åœ¨è¿™ä¸ª Pass ä¸­æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²å†…éƒ¨çš„åç§°å†³å®šäº†æŠ“å–åˆ°çš„å±å¹•å›¾åƒå°†ä¼šè¢«å­˜å…¥å“ªä¸ªçº¹ç†ä¸­ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥å£°æ˜è¯¥å­—ç¬¦ä¸²ï¼Œä½†ç›´æ¥å£°æ˜çº¹ç†åç§°çš„æ–¹æ³•å¾€å¾€å¯ä»¥å¾—åˆ°æ›´é«˜çš„æ€§èƒ½ã€‚</li><li>å®šä¹‰äº† <strong>_RefractionTex</strong> å’Œ <strong>_RefractionTex_TexelSize</strong> å˜é‡ï¼Œè¿™å¯¹åº”äº†åœ¨ä½¿ç”¨ <strong>GrabPass</strong> æ—¶æŒ‡å®šçš„çº¹ç†åç§°ã€‚ <strong>_RefractionTex_TexelSize</strong> å¯ä»¥è®©æˆ‘ä»¬å¾—åˆ°è¯¥åƒç´ çš„çº¹ç†å¤§å°ï¼Œä¾‹å¦‚ä¸€ä¸ªå¤§å°ä¸º 256Ã—512 çš„çº¹ç†ï¼Œå®ƒçš„åƒç´ å¤§å°ä¸ºï¼ˆ1/256, 1/512ï¼‰ã€‚æˆ‘ä»¬éœ€è¦åœ¨å¯¹å±å¹•å›¾åƒçš„é‡‡æ ·åæ ‡è¿›è¡Œåç§»æ—¶ä½¿ç”¨è¯¥é‡ã€‚</li><li>åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­é€šè¿‡è°ƒç”¨å†…ç½®çš„ <strong>ComputeGrabScreenPos</strong> å‡½æ•°æ¥å¾—åˆ°å¯¹åº”è¢«æŠ“å–çš„å±å¹•å›¾åƒçš„é‡‡æ ·åæ ‡ã€‚</li><li>åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­æˆ‘ä»¬å¯¹æ³•çº¿çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿æ–¹å‘ã€‚æˆ‘ä»¬ä½¿ç”¨è¯¥å€¼å’Œ <strong>_Distortion</strong> å±æ€§ä»¥åŠ <strong>_RefractionTex_TexelSize</strong> æ¥å¯¹å±å¹•å›¾åƒçš„é‡‡æ ·æ‰€éœ€çš„åæ ‡è¿›è¡Œåç§»ï¼Œæ¨¡æ‹ŸæŠ˜å°„æ•ˆæœã€‚ <strong>_Distortion</strong> å€¼è¶Šå¤§ï¼Œåç§»é‡è¶Šå¤§ï¼Œç»ç’ƒèƒŒåçš„ç‰©ä½“çœ‹èµ·æ¥å˜å½¢ç¨‹åº¦è¶Šå¤§ã€‚</li><li>åœ¨å¯¹å±å¹•çº¹ç†è¿›è¡Œé‡‡æ ·æ—¶ä½¿ç”¨äº† <strong>é½æ¬¡é™¤æ³•</strong> è·å–è§†å£åæ ‡ä¸‹çš„åæ ‡ï¼š( i.scrPos.xy / i.scrPos.w )</li><li>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ <strong>_RefractAmount</strong> å±æ€§å¯¹åå°„å’ŒæŠ˜å°„é¢œè‰²è¿›è¡Œæ··åˆï¼Œä½œä¸ºæœ€ç»ˆçš„è¾“å‡ºé¢œè‰²ã€‚</li></ol><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>Glass</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_MainTex</span> <span class=p>(</span><span class=err>&#34;</span><span class=n>MainTex</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_BumpTex</span><span class=p>(</span><span class=err>&#34;</span><span class=n>BumpTex</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>bump</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_Cubemap</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Cube</span> <span class=n>Map</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Cube</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>_Skybox</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_Distortion</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Distortion</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mi>100</span><span class=p>))</span> <span class=o>=</span> <span class=mi>10</span>
        <span class=n>_RefractAmount</span><span class=p>(</span><span class=err>&#34;</span><span class=n>RefractAmount</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>))</span> <span class=o>=</span> <span class=mf>1.0</span>
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Opaque</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>Queue</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Transparent</span><span class=err>&#34;</span> <span class=p>}</span>

        <span class=n>GrabPass</span> 
        <span class=p>{</span>
            <span class=err>&#34;</span><span class=n>_RefractionTex</span><span class=err>&#34;</span>  <span class=c1>// GrabPassï¼šç”¨äºæŠ“å–å±å¹•å›¾åƒçš„ passï¼Œå†…éƒ¨å­—ç¬¦ä¸²å†³å®šè¾“å‡ºçº¹ç†åç§°</span>
        <span class=p>}</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>CGPROGRAM</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=k>sampler2D</span> <span class=n>_MainTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_MainTex_ST</span><span class=p>;</span>
            <span class=k>sampler2D</span> <span class=n>_BumpTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_BumpTex_ST</span><span class=p>;</span>
            <span class=n>samplerCUBE</span> <span class=n>_Cubemap</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_Distortion</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_RefractAmount</span><span class=p>;</span>

            <span class=k>sampler2D</span> <span class=n>_RefractionTex</span><span class=p>;</span>        <span class=c1>// è·å–å±å¹•å›¾åƒè¾“å‡ºçš„çº¹ç†</span>
            <span class=n>float4</span> <span class=n>_RefractionTex_TexelSize</span><span class=p>;</span> <span class=c1>// è·å–çº¹ç†çš„çº¹ç´ å¤§å°</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>texcoord</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>tangent</span> <span class=o>:</span> <span class=n>TANGENT</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>pos</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>uv</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>screenPos</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span> <span class=c1>// å±å¹•é‡‡æ ·åæ ‡</span>
                <span class=n>float4</span> <span class=n>TtoW0</span> <span class=o>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>TtoW1</span> <span class=o>:</span> <span class=n>TEXCOORD3</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>TtoW2</span> <span class=o>:</span> <span class=n>TEXCOORD4</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>pos</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>

                <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>xy</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span> <span class=c1>// ç¼©æ”¾å’Œå¹³ç§»</span>
                <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>zw</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_BumpTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_BumpTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span> <span class=c1>// ç¼©æ”¾å’Œå¹³ç§»</span>

                <span class=n>o</span><span class=p>.</span><span class=n>screenPos</span> <span class=o>=</span> <span class=n>ComputeGrabScreenPos</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>pos</span><span class=p>);</span> <span class=c1>// ComputeGrabScreenPos è·å–æŠ“å–å±å¹•çš„é‡‡æ ·åæ ‡</span>

                <span class=n>float3</span> <span class=n>worldPos</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldNormal</span> <span class=o>=</span> <span class=n>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span>
                <span class=n>float3</span> <span class=n>worldTangent</span> <span class=o>=</span> <span class=n>UnityObjectToWorldDir</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>.</span><span class=n>xyz</span><span class=p>);</span>
                <span class=n>float3</span> <span class=n>worldBinormal</span> <span class=o>=</span> <span class=n>cross</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>worldTangent</span><span class=p>)</span> <span class=o>*</span> <span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>.</span><span class=n>w</span><span class=p>;</span>

                <span class=n>o</span><span class=p>.</span><span class=n>TtoW0</span> <span class=o>=</span> <span class=n>float4</span><span class=p>(</span><span class=n>worldTangent</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>worldBinormal</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>worldNormal</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>worldPos</span><span class=p>.</span><span class=n>x</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>TtoW1</span> <span class=o>=</span> <span class=n>float4</span><span class=p>(</span><span class=n>worldTangent</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>worldBinormal</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>worldNormal</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>worldPos</span><span class=p>.</span><span class=n>y</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>TtoW2</span> <span class=o>=</span> <span class=n>float4</span><span class=p>(</span><span class=n>worldTangent</span><span class=p>.</span><span class=n>z</span><span class=p>,</span> <span class=n>worldBinormal</span><span class=p>.</span><span class=n>z</span><span class=p>,</span> <span class=n>worldNormal</span><span class=p>.</span><span class=n>z</span><span class=p>,</span> <span class=n>worldPos</span><span class=p>.</span><span class=n>z</span><span class=p>);</span>

                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>worldPos</span> <span class=o>=</span> <span class=n>float3</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>TtoW0</span><span class=p>.</span><span class=n>w</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>TtoW1</span><span class=p>.</span><span class=n>w</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>TtoW2</span><span class=p>.</span><span class=n>w</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>worldLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceLightDir</span><span class=p>(</span><span class=n>worldPos</span><span class=p>));</span>
                <span class=n>half3</span> <span class=n>worldViewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>worldPos</span><span class=p>));</span>

                <span class=n>half3</span> <span class=n>bump</span> <span class=o>=</span> <span class=n>UnpackNormal</span><span class=p>(</span><span class=n>tex2D</span><span class=p>(</span><span class=n>_BumpTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>zw</span><span class=p>));</span>
                <span class=n>half2</span> <span class=n>offset</span> <span class=o>=</span> <span class=n>bump</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_Distortion</span> <span class=o>*</span> <span class=n>_RefractionTex_TexelSize</span><span class=p>.</span><span class=n>xy</span><span class=p>;</span>
                <span class=n>i</span><span class=p>.</span><span class=n>screenPos</span><span class=p>.</span><span class=n>xy</span> <span class=o>=</span> <span class=n>offset</span> <span class=o>*</span> <span class=n>i</span><span class=p>.</span><span class=n>screenPos</span><span class=p>.</span><span class=n>z</span> <span class=o>+</span> <span class=n>i</span><span class=p>.</span><span class=n>screenPos</span><span class=p>.</span><span class=n>xy</span><span class=p>;</span>

                <span class=n>half3</span> <span class=n>refrCol</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_RefractionTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>screenPos</span><span class=p>.</span><span class=n>xy</span> <span class=o>/</span> <span class=n>i</span><span class=p>.</span><span class=n>screenPos</span><span class=p>.</span><span class=n>w</span><span class=p>).</span><span class=n>rgb</span><span class=p>;</span>

                <span class=n>bump</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>half3</span><span class=p>(</span><span class=n>dot</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>TtoW0</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>bump</span><span class=p>),</span> <span class=n>dot</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>TtoW1</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>bump</span><span class=p>),</span> <span class=n>dot</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>TtoW2</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>bump</span><span class=p>)));</span>

                <span class=n>half3</span> <span class=n>reflDir</span> <span class=o>=</span> <span class=n>reflect</span><span class=p>(</span><span class=o>-</span><span class=n>worldViewDir</span><span class=p>,</span> <span class=n>bump</span><span class=p>);</span>
                <span class=n>half4</span> <span class=n>texColor</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>xy</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>reflCol</span> <span class=o>=</span> <span class=n>texCUBE</span><span class=p>(</span><span class=n>_Cubemap</span><span class=p>,</span> <span class=n>reflDir</span><span class=p>).</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>texColor</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>

                <span class=n>half3</span> <span class=n>col</span> <span class=o>=</span> <span class=n>reflCol</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>_RefractAmount</span><span class=p>)</span> <span class=o>+</span> <span class=n>refrCol</span> <span class=o>*</span> <span class=n>_RefractAmount</span><span class=p>;</span>

                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>col</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=n>Fallback</span> <span class=err>&#34;</span><span class=n>Diffuse</span><span class=err>&#34;</span>
<span class=p>}</span>
</code></pre></div><h3 id=æ¸²æŸ“çº¹ç†-vs-grabpass>æ¸²æŸ“çº¹ç† VS GrabPass</h3><ul><li>GrabPass çš„å¥½å¤„åœ¨äºå®ç°ç®€å•ï¼Œæˆ‘ä»¬åªéœ€åœ¨ Shader ä¸­å†™å‡ è¡Œä»£ç å°±å¯ä»¥å®ç°æŠ“å–å±å¹•çš„é—®é¢˜ã€‚</li><li>ä»æ•ˆç‡ä¸Šæ¥è®²ï¼Œä½¿ç”¨æ¸²æŸ“çº¹ç†çš„æ•ˆç‡å¾€å¾€è¦å¥½äº GrabPass ï¼Œå°¤å…¶åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šã€‚ä½¿ç”¨æ¸²æŸ“çº¹ç†æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ¸²æŸ“çº¹ç†çš„å¤§å°ï¼Œå°½ç®¡è¿™ç§æ–¹æ³•éœ€è¦æŠŠéƒ¨åˆ†åœºæ™¯å†æ¬¡æ¸²æŸ“ä¸€éï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´æ‘„åƒæœºçš„æ¸²æŸ“å±‚æ¥å‡å°‘äºŒæ¬¡æ¸²æŸ“æ—¶çš„åœºæ™¯å¤§å°ï¼Œæˆ–ä½¿ç”¨å…¶å®ƒæ–¹æ³•æ¥æ§åˆ¶æ‘„åƒæœºæ˜¯å¦éœ€è¦å¼€å¯ã€‚</li></ul><p>GrabPass è·å–åˆ°çš„å›¾åƒåˆ†è¾¨ç‡å’Œæ˜¾ç¤ºå±å¹•æ˜¯ä¸€è‡´çš„ï¼Œè¿™æ„å‘³ç€åœ¨ä¸€äº›é«˜åˆ†è¾¨ç‡çš„è®¾å¤‡ä¸Šå¯èƒ½ä¼šé€ æˆä¸¥é‡çš„å¸¦å®½å½±å“ã€‚</p><p>åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼ŒGrabPass è™½ç„¶ä¸ä¼šé‡æ–°æ¸²æŸ“åœºæ™¯ï¼Œä½†å®ƒå¾€å¾€éœ€è¦ CPU ç›´æ¥è¯»å–åå¤‡ç¼“å†²ï¼ˆback bufferï¼‰ä¸­çš„æ•°æ®ï¼Œç ´åäº† CPU å’Œ GPU ä¹‹é—´çš„å¹¶è¡Œæ€§ï¼Œè¿™æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œç”šè‡³åœ¨ä¸€äº›ç§»åŠ¨è®¾å¤‡ä¸Šè¿™æ˜¯ä¸æ”¯æŒçš„ã€‚</p><h3 id=å‘½ä»¤ç¼“å­˜-command-buffers>å‘½ä»¤ç¼“å­˜ (Command Buffers)</h3><p>åœ¨ Unity5 ä¸­ï¼ŒUnity å¼•å…¥äº† <strong>å‘½ä»¤ç¼“å†²ï¼ˆCommand Buffersï¼‰</strong> æ¥å…è®¸æˆ‘ä»¬æ‰©å±• Unity çš„æ¸²æŸ“æµæ°´çº¿ã€‚ä½¿ç”¨å‘½ä»¤ç¼“å†²æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°ç±»ä¼¼æŠ“å±çš„æ•ˆæœï¼Œå®ƒå¯ä»¥åœ¨ä¸é€æ˜ç‰©ä½“æ¸²æŸ“åæŠŠå½“å‰çš„å›¾åƒå¤åˆ¶åˆ°ä¸€ä¸ªä¸´æ—¶çš„æ¸²æŸ“ç›®æ ‡çº¹ç†ä¸­ï¼Œç„¶ååœ¨é‚£é‡Œè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚æ¨¡ç³Šç­‰ï¼Œæœ€åæŠŠå›¾åƒä¼ é€’ç»™éœ€è¦ä½¿ç”¨å®ƒçš„ç‰©ä½“è¿›è¡Œå¤„ç†å’Œæ˜¾ç¤ºã€‚</p><p>æœ‰å…³å‘½ä»¤ç¼“å†²åŒºæ›´å¤šçŸ¥è¯†ï¼Œç§»æ­¥ï¼š<a class=link href=https://docs.unity.cn/cn/current/Manual/GraphicsCommandBuffers.html target=_blank rel=noopener>å›¾å½¢å‘½ä»¤ç¼“å†²åŒº - Unity æ‰‹å†Œ</a></p><h2 id=ç¨‹åºçº¹ç†>ç¨‹åºçº¹ç†</h2><p><strong>ç¨‹åºçº¹ç†ï¼ˆProcedural Textureï¼‰</strong> æŒ‡çš„æ˜¯é‚£äº›ç”±è®¡ç®—æœºç”Ÿæˆçš„å›¾åƒï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ä¸€äº›ç‰¹å®šçš„ç®—æ³•æ¥åˆ›å»ºä¸ªæ€§åŒ–å›¾æ¡ˆæˆ–éå¸¸çœŸå®çš„è‡ªç„¶å…ƒç´ ï¼Œä¾‹å¦‚æœ¨å¤´ã€çŸ³å­ç­‰ã€‚</p><p>ä½¿ç”¨ <strong>ç¨‹åºçº¹ç†</strong> çš„å¥½å¤„åœ¨äºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å„ç§å‚æ•°æ¥æ§åˆ¶çº¹ç†çš„å¤–è§‚ï¼Œè€Œè¿™äº›å±æ€§ä¸ä»…ä»…æ˜¯é‚£äº›é¢œè‰²å±æ€§ï¼Œç”šè‡³å¯ä»¥æ˜¯å®Œå…¨ä¸åŒç±»å‹çš„å›¾æ¡ˆå±æ€§ï¼Œè¿™æ˜¯æˆ‘ä»¬å¯ä»¥å¾—åˆ°æ›´åŠ ä¸°å¯Œçš„åŠ¨ç”»å’Œè§†è§‰æ•ˆæœã€‚</p><div class=highlight><pre class=chroma><code class=language-c# data-lang=c#><span class=k>using</span> <span class=nn>UnityEngine</span><span class=p>;</span>
<span class=k>using</span> <span class=nn>System.Collections</span><span class=p>;</span>
<span class=k>using</span> <span class=nn>System.Collections.Generic</span><span class=p>;</span>
<span class=na>
</span><span class=na>[ExecuteInEditMode]</span><span class=c1>//ç”¨äºç¼–è¾‘å™¨ä¸‹è¿è¡Œ
</span><span class=c1></span><span class=k>public</span> <span class=k>class</span> <span class=nc>ProceduralTextureGeneration</span> <span class=p>:</span> <span class=n>MonoBehaviour</span>
<span class=p>{</span>
    <span class=c1>// å£°æ˜æè´¨
</span><span class=c1></span>    <span class=k>public</span> <span class=n>Material</span> <span class=n>material</span> <span class=p>=</span> <span class=k>null</span><span class=p>;</span>

    <span class=cp>#region Material properties//æè´¨å±æ€§
</span><span class=cp></span>    <span class=c1>// çº¹ç†å¤§å°
</span><span class=c1></span><span class=na>    [SerializeField, SetProperty(&#34;textureWidth&#34;)]</span>
    <span class=c1>// å€¼é€šå¸¸æ˜¯2çš„æ•´æ•°å¹‚
</span><span class=c1></span>    <span class=k>private</span> <span class=kt>int</span> <span class=n>m_textureWidth</span> <span class=p>=</span> <span class=m>512</span><span class=p>;</span>
    <span class=k>public</span> <span class=kt>int</span> <span class=n>textureWidth</span>
    <span class=p>{</span>
        <span class=k>get</span>
        <span class=p>{</span>
            <span class=k>return</span> <span class=n>m_textureWidth</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=k>set</span>
        <span class=p>{</span>
            <span class=n>m_textureWidth</span> <span class=p>=</span> <span class=k>value</span><span class=p>;</span>
            <span class=m>_</span><span class=n>UpdateMaterial</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=c1>// çº¹ç†èƒŒæ™¯é¢œè‰²
</span><span class=c1></span><span class=na>    [SerializeField, SetProperty(&#34;backgroundColor&#34;)]</span>
    <span class=k>private</span> <span class=n>Color</span> <span class=n>m_backgroundColor</span> <span class=p>=</span> <span class=n>Color</span><span class=p>.</span><span class=n>white</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>Color</span> <span class=n>backgroundColor</span>
    <span class=p>{</span>
        <span class=k>get</span>
        <span class=p>{</span>
            <span class=k>return</span> <span class=n>m_backgroundColor</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=k>set</span>
        <span class=p>{</span>
            <span class=n>m_backgroundColor</span> <span class=p>=</span> <span class=k>value</span><span class=p>;</span>
            <span class=m>_</span><span class=n>UpdateMaterial</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=c1>// åœ†ç‚¹é¢œè‰²
</span><span class=c1></span><span class=na>    [SerializeField, SetProperty(&#34;circleColor&#34;)]</span>
    <span class=k>private</span> <span class=n>Color</span> <span class=n>m_circleColor</span> <span class=p>=</span> <span class=n>Color</span><span class=p>.</span><span class=n>yellow</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>Color</span> <span class=n>circleColor</span>
    <span class=p>{</span>
        <span class=k>get</span>
        <span class=p>{</span>
            <span class=k>return</span> <span class=n>m_circleColor</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=k>set</span>
        <span class=p>{</span>
            <span class=n>m_circleColor</span> <span class=p>=</span> <span class=k>value</span><span class=p>;</span>
            <span class=m>_</span><span class=n>UpdateMaterial</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=c1>// æ¨¡ç³Šå› å­
</span><span class=c1></span><span class=na>    [SerializeField, SetProperty(&#34;blurFactor&#34;)]</span>
    <span class=c1>// ç”¨æ¥ç£¨åˆåœ†å½¢è¾¹ç•Œ
</span><span class=c1></span>    <span class=k>private</span> <span class=kt>float</span> <span class=n>m_blurFactor</span> <span class=p>=</span> <span class=m>2.0f</span><span class=p>;</span>
    <span class=k>public</span> <span class=kt>float</span> <span class=n>blurFactor</span>
    <span class=p>{</span>
        <span class=k>get</span>
        <span class=p>{</span>
            <span class=k>return</span> <span class=n>m_blurFactor</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=k>set</span>
        <span class=p>{</span>
            <span class=n>m_blurFactor</span> <span class=p>=</span> <span class=k>value</span><span class=p>;</span>
            <span class=m>_</span><span class=n>UpdateMaterial</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=cp>#endregion
</span><span class=cp></span>
    <span class=c1>/// &lt;summary&gt;ç”Ÿæˆçš„çº¹ç†&lt;/summary&gt;
</span><span class=c1></span>    <span class=k>private</span> <span class=n>Texture2D</span> <span class=n>m_generatedTexture</span> <span class=p>=</span> <span class=k>null</span><span class=p>;</span>

    <span class=c1>// åˆå§‹åŒ–
</span><span class=c1></span>    <span class=k>void</span> <span class=n>Start</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=c1>// æ£€æµ‹æè´¨æ˜¯å¦ä¸ºç©º
</span><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>material</span> <span class=p>==</span> <span class=k>null</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=c1>// è·å–æ¸²æŸ“å™¨
</span><span class=c1></span>            <span class=n>Renderer</span> <span class=n>renderer</span> <span class=p>=</span> <span class=n>gameObject</span><span class=p>.</span><span class=n>GetComponent</span><span class=p>&lt;</span><span class=n>Renderer</span><span class=p>&gt;();</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>renderer</span> <span class=p>==</span> <span class=k>null</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>Debug</span><span class=p>.</span><span class=n>LogWarning</span><span class=p>(</span><span class=s>&#34;æ‰¾ä¸åˆ°æ¸²æŸ“å™¨ã€‚&#34;</span><span class=p>);</span>
                <span class=k>return</span><span class=p>;</span>
            <span class=p>}</span>
            <span class=c1>// è·å–æ¸²æŸ“å™¨çš„æè´¨
</span><span class=c1></span>            <span class=n>material</span> <span class=p>=</span> <span class=n>renderer</span><span class=p>.</span><span class=n>sharedMaterial</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=m>_</span><span class=n>UpdateMaterial</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=c1>/// &lt;summary&gt;
</span><span class=c1></span>    <span class=c1>/// ç”Ÿæˆçº¹ç†
</span><span class=c1></span>    <span class=c1>/// &lt;/summary&gt;
</span><span class=c1></span>    <span class=k>private</span> <span class=k>void</span> <span class=m>_</span><span class=n>UpdateMaterial</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=c1>// æè´¨ä¸ä¸ºç©º
</span><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>material</span> <span class=p>!=</span> <span class=k>null</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=c1>// è°ƒç”¨æ–¹æ³•ç”Ÿæˆç¨‹åºçº¹ç†
</span><span class=c1></span>            <span class=n>m_generatedTexture</span> <span class=p>=</span> <span class=m>_</span><span class=n>GenerateProceduralTexture</span><span class=p>();</span>
            <span class=c1>// å°†çº¹ç†èµ‹å€¼ç»™æè´¨
</span><span class=c1></span>            <span class=n>material</span><span class=p>.</span><span class=n>SetTexture</span><span class=p>(</span><span class=s>&#34;_MainTex&#34;</span><span class=p>,</span> <span class=n>m_generatedTexture</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=k>private</span> <span class=n>Color</span> <span class=m>_</span><span class=n>MixColor</span><span class=p>(</span><span class=n>Color</span> <span class=n>color0</span><span class=p>,</span> <span class=n>Color</span> <span class=n>color1</span><span class=p>,</span> <span class=kt>float</span> <span class=n>mixFactor</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>Color</span> <span class=n>mixColor</span> <span class=p>=</span> <span class=n>Color</span><span class=p>.</span><span class=n>white</span><span class=p>;</span>
        <span class=n>mixColor</span><span class=p>.</span><span class=n>r</span> <span class=p>=</span> <span class=n>Mathf</span><span class=p>.</span><span class=n>Lerp</span><span class=p>(</span><span class=n>color0</span><span class=p>.</span><span class=n>r</span><span class=p>,</span> <span class=n>color1</span><span class=p>.</span><span class=n>r</span><span class=p>,</span> <span class=n>mixFactor</span><span class=p>);</span>
        <span class=n>mixColor</span><span class=p>.</span><span class=n>g</span> <span class=p>=</span> <span class=n>Mathf</span><span class=p>.</span><span class=n>Lerp</span><span class=p>(</span><span class=n>color0</span><span class=p>.</span><span class=n>g</span><span class=p>,</span> <span class=n>color1</span><span class=p>.</span><span class=n>g</span><span class=p>,</span> <span class=n>mixFactor</span><span class=p>);</span>
        <span class=n>mixColor</span><span class=p>.</span><span class=n>b</span> <span class=p>=</span> <span class=n>Mathf</span><span class=p>.</span><span class=n>Lerp</span><span class=p>(</span><span class=n>color0</span><span class=p>.</span><span class=n>b</span><span class=p>,</span> <span class=n>color1</span><span class=p>.</span><span class=n>b</span><span class=p>,</span> <span class=n>mixFactor</span><span class=p>);</span>
        <span class=n>mixColor</span><span class=p>.</span><span class=n>a</span> <span class=p>=</span> <span class=n>Mathf</span><span class=p>.</span><span class=n>Lerp</span><span class=p>(</span><span class=n>color0</span><span class=p>.</span><span class=n>a</span><span class=p>,</span> <span class=n>color1</span><span class=p>.</span><span class=n>a</span><span class=p>,</span> <span class=n>mixFactor</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>mixColor</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=c1>/// &lt;summary&gt;
</span><span class=c1></span>    <span class=c1>/// ç”Ÿæˆç¨‹åºçº¹ç†
</span><span class=c1></span>    <span class=c1>/// &lt;/summary&gt;
</span><span class=c1></span>    <span class=c1>/// &lt;returns&gt;&lt;/returns&gt;
</span><span class=c1></span>    <span class=k>private</span> <span class=n>Texture2D</span> <span class=m>_</span><span class=n>GenerateProceduralTexture</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=n>Texture2D</span> <span class=n>proceduralTexture</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Texture2D</span><span class=p>(</span><span class=n>textureWidth</span><span class=p>,</span> <span class=n>textureWidth</span><span class=p>);</span>

        <span class=c1>// å®šä¹‰åœ†ä¸åœ†ä¹‹é—´çš„é—´è·
</span><span class=c1></span>        <span class=kt>float</span> <span class=n>circleInterval</span> <span class=p>=</span> <span class=n>textureWidth</span> <span class=p>/</span> <span class=m>4.0f</span><span class=p>;</span>
        <span class=c1>// å®šä¹‰åœ†çš„åŠå¾„
</span><span class=c1></span>        <span class=kt>float</span> <span class=n>radius</span> <span class=p>=</span> <span class=n>textureWidth</span> <span class=p>/</span> <span class=m>10.0f</span><span class=p>;</span>
        <span class=c1>// å®šä¹‰æ¨¡ç³Šç³»æ•°
</span><span class=c1></span>        <span class=kt>float</span> <span class=n>edgeBlur</span> <span class=p>=</span> <span class=m>1.0f</span> <span class=p>/</span> <span class=n>blurFactor</span><span class=p>;</span>

        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>w</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>w</span> <span class=p>&lt;</span> <span class=n>textureWidth</span><span class=p>;</span> <span class=n>w</span><span class=p>++)</span>
        <span class=p>{</span>
            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>h</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>h</span> <span class=p>&lt;</span> <span class=n>textureWidth</span><span class=p>;</span> <span class=n>h</span><span class=p>++)</span>
            <span class=p>{</span>
                <span class=c1>// ä½¿ç”¨èƒŒæ™¯é¢œè‰²è¿›è¡Œåˆå§‹åŒ–
</span><span class=c1></span>                <span class=n>Color</span> <span class=n>pixel</span> <span class=p>=</span> <span class=n>backgroundColor</span><span class=p>;</span>

                <span class=c1>// ä¾æ¬¡ç”»ä¹ä¸ªåœ†
</span><span class=c1></span>                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=m>3</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span>
                <span class=p>{</span>
                    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>j</span> <span class=p>&lt;</span> <span class=m>3</span><span class=p>;</span> <span class=n>j</span><span class=p>++)</span>
                    <span class=p>{</span>
                        <span class=c1>// å®šä¹‰åœ†çš„åœ†å¿ƒ
</span><span class=c1></span>                        <span class=n>Vector2</span> <span class=n>circleCenter</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Vector2</span><span class=p>(</span><span class=n>circleInterval</span> <span class=p>*</span> <span class=p>(</span><span class=n>i</span> <span class=p>+</span> <span class=m>1</span><span class=p>),</span> <span class=n>circleInterval</span> <span class=p>*</span> <span class=p>(</span><span class=n>j</span> <span class=p>+</span> <span class=m>1</span><span class=p>));</span>

                        <span class=c1>// è®¡ç®—å½“å‰åƒç´ ä¸åœ†å¿ƒçš„è·ç¦»
</span><span class=c1></span>                        <span class=kt>float</span> <span class=n>dist</span> <span class=p>=</span> <span class=n>Vector2</span><span class=p>.</span><span class=n>Distance</span><span class=p>(</span><span class=k>new</span> <span class=n>Vector2</span><span class=p>(</span><span class=n>w</span><span class=p>,</span> <span class=n>h</span><span class=p>),</span> <span class=n>circleCenter</span><span class=p>)</span> <span class=p>-</span> <span class=n>radius</span><span class=p>;</span>

                        <span class=c1>// æ¨¡ç³Šåœ†çš„è¾¹ç•Œ
</span><span class=c1></span>                        <span class=n>Color</span> <span class=n>color</span> <span class=p>=</span> <span class=m>_</span><span class=n>MixColor</span><span class=p>(</span><span class=n>circleColor</span><span class=p>,</span> <span class=k>new</span> <span class=n>Color</span><span class=p>(</span><span class=n>pixel</span><span class=p>.</span><span class=n>r</span><span class=p>,</span> <span class=n>pixel</span><span class=p>.</span><span class=n>g</span><span class=p>,</span> <span class=n>pixel</span><span class=p>.</span><span class=n>b</span><span class=p>,</span> <span class=m>0.0f</span><span class=p>),</span> <span class=n>Mathf</span><span class=p>.</span><span class=n>SmoothStep</span><span class=p>(</span><span class=m>0f</span><span class=p>,</span> <span class=m>1.0f</span><span class=p>,</span> <span class=n>dist</span> <span class=p>*</span> <span class=n>edgeBlur</span><span class=p>));</span>

                        <span class=c1>// ä¸ä¹‹å‰å¾—åˆ°çš„é¢œè‰²è¿›è¡Œæ··åˆ
</span><span class=c1></span>                        <span class=n>pixel</span> <span class=p>=</span> <span class=m>_</span><span class=n>MixColor</span><span class=p>(</span><span class=n>pixel</span><span class=p>,</span> <span class=n>color</span><span class=p>,</span> <span class=n>color</span><span class=p>.</span><span class=n>a</span><span class=p>);</span>
                    <span class=p>}</span>
                <span class=p>}</span>
                <span class=c1>// å†™å…¥åƒç´ 
</span><span class=c1></span>                <span class=n>proceduralTexture</span><span class=p>.</span><span class=n>SetPixel</span><span class=p>(</span><span class=n>w</span><span class=p>,</span> <span class=n>h</span><span class=p>,</span> <span class=n>pixel</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=c1>// å°†åƒç´ å€¼å†™å…¥çº¹ç†
</span><span class=c1></span>        <span class=n>proceduralTexture</span><span class=p>.</span><span class=n>Apply</span><span class=p>();</span>

        <span class=k>return</span> <span class=n>proceduralTexture</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h2 id=æ€»ç»“>æ€»ç»“</h2><p>å¸¸è§„åå°„</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
<span class=p>{</span>
    <span class=p>...</span>
    <span class=n>o</span><span class=p>.</span><span class=n>worldRefl</span> <span class=o>=</span> <span class=n>reflect</span><span class=p>(</span><span class=o>-</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>worldPos</span><span class=p>),</span> <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span> <span class=c1>// åå°„æ–¹å‘</span>

    <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
<span class=p>}</span>

<span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
<span class=p>{</span>
    <span class=p>...</span>
    <span class=n>half3</span> <span class=n>reflection</span> <span class=o>=</span> <span class=n>texCUBE</span><span class=p>(</span><span class=n>_CubeMap</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>worldRefl</span><span class=p>).</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_ReflectColor</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>

    <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span><span class=p>;</span>
    <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>NdotL</span><span class=p>;</span>

    <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>lerp</span><span class=p>(</span><span class=n>diffuse</span><span class=p>,</span> <span class=n>reflection</span><span class=p>,</span> <span class=n>_ReflectPower</span><span class=p>),</span> <span class=mf>1.0</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>å¸¸è§„æŠ˜å°„</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
<span class=p>{</span>
    <span class=p>...</span>
    <span class=n>o</span><span class=p>.</span><span class=n>worldRefra</span> <span class=o>=</span> <span class=n>refract</span><span class=p>(</span><span class=o>-</span><span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>worldPos</span><span class=p>)),</span> <span class=n>normalize</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>),</span> <span class=n>_RefractRatio</span><span class=p>);</span>

    <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
<span class=p>}</span>

<span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
<span class=p>{</span>
    <span class=p>...</span>
    <span class=n>half3</span> <span class=n>refraction</span> <span class=o>=</span> <span class=n>texCUBE</span><span class=p>(</span><span class=n>_Cubemap</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>worldRefra</span><span class=p>).</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_RefractColor</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>

    <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span><span class=p>;</span>
    <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>NdotL</span><span class=p>;</span>

    <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>lerp</span><span class=p>(</span><span class=n>diffuse</span><span class=p>,</span> <span class=n>refraction</span><span class=p>,</span> <span class=n>_RefractPower</span><span class=p>),</span> <span class=mf>1.0</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>è²æ¶…å°”åå°„</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
<span class=p>{</span>
    <span class=p>...</span>
    <span class=n>o</span><span class=p>.</span><span class=n>worldRefl</span> <span class=o>=</span> <span class=n>reflect</span><span class=p>(</span><span class=o>-</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>worldPos</span><span class=p>),</span> <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span>

    <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
<span class=p>}</span>

<span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
<span class=p>{</span>
    <span class=p>...</span>
    <span class=n>half3</span> <span class=n>reflection</span> <span class=o>=</span> <span class=n>texCUBE</span><span class=p>(</span><span class=n>_CubeMap</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>worldRefl</span><span class=p>).</span><span class=n>rgb</span><span class=p>;</span>
    <span class=k>half</span> <span class=n>fresnel</span> <span class=o>=</span> <span class=n>_FresnelScale</span> <span class=o>+</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>_FresnelScale</span><span class=p>)</span> <span class=o>*</span> <span class=n>pow</span><span class=p>((</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldViewDir</span><span class=p>,</span> <span class=n>worldNormal</span><span class=p>)),</span> <span class=mf>5.0</span><span class=p>);</span>
    
    <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span><span class=p>;</span>
    <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>NdotL</span><span class=p>;</span>

    <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>lerp</span><span class=p>(</span><span class=n>diffuse</span><span class=p>,</span> <span class=n>reflection</span><span class=p>,</span> <span class=n>saturate</span><span class=p>(</span><span class=n>fresnel</span><span class=p>)),</span> <span class=mf>1.0</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>é•œå­</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>v2f</span> <span class=n>vert</span><span class=p>(</span><span class=n>a2v</span> <span class=n>v</span><span class=p>)</span>
<span class=p>{</span>
    <span class=p>...</span>    
    <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>;</span>
    <span class=c1>// éœ€è¦é•œåƒå›¾åƒ</span>
    <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>x</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
    
    <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
<span class=p>}</span>

<span class=n>fixed4</span> <span class=n>frag</span><span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span><span class=o>:</span> <span class=n>SV_Target</span>
<span class=p>{</span>
    <span class=c1>// å¯¹çº¹ç†é‡‡æ ·è¾“å‡º</span>
    <span class=k>return</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>ç»ç’ƒ</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
<span class=p>{</span>
    <span class=p>...</span>
    <span class=n>o</span><span class=p>.</span><span class=n>screenPos</span> <span class=o>=</span> <span class=n>ComputeGrabScreenPos</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>pos</span><span class=p>);</span> <span class=c1>// ComputeGrabScreenPos è·å–æŠ“å–å±å¹•çš„é‡‡æ ·åæ ‡</span>
    <span class=p>...</span>
    <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
<span class=p>}</span>

<span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
<span class=p>{</span>
    <span class=p>...</span>
    <span class=n>half2</span> <span class=n>offset</span> <span class=o>=</span> <span class=n>bump</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_Distortion</span> <span class=o>*</span> <span class=n>_RefractionTex_TexelSize</span><span class=p>.</span><span class=n>xy</span><span class=p>;</span>
    <span class=n>i</span><span class=p>.</span><span class=n>screenPos</span><span class=p>.</span><span class=n>xy</span> <span class=o>=</span> <span class=n>offset</span> <span class=o>*</span> <span class=n>i</span><span class=p>.</span><span class=n>screenPos</span><span class=p>.</span><span class=n>z</span> <span class=o>+</span> <span class=n>i</span><span class=p>.</span><span class=n>screenPos</span><span class=p>.</span><span class=n>xy</span><span class=p>;</span>

    <span class=n>half3</span> <span class=n>refrCol</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_RefractionTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>screenPos</span><span class=p>.</span><span class=n>xy</span> <span class=o>/</span> <span class=n>i</span><span class=p>.</span><span class=n>screenPos</span><span class=p>.</span><span class=n>w</span><span class=p>).</span><span class=n>rgb</span><span class=p>;</span>

    <span class=n>bump</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>half3</span><span class=p>(</span><span class=n>dot</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>TtoW0</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>bump</span><span class=p>),</span> <span class=n>dot</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>TtoW1</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>bump</span><span class=p>),</span> <span class=n>dot</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>TtoW2</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>bump</span><span class=p>)));</span>

    <span class=n>half3</span> <span class=n>reflDir</span> <span class=o>=</span> <span class=n>reflect</span><span class=p>(</span><span class=o>-</span><span class=n>worldViewDir</span><span class=p>,</span> <span class=n>bump</span><span class=p>);</span>
    <span class=n>half4</span> <span class=n>texColor</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>xy</span><span class=p>);</span>
    <span class=n>half3</span> <span class=n>reflCol</span> <span class=o>=</span> <span class=n>texCUBE</span><span class=p>(</span><span class=n>_Cubemap</span><span class=p>,</span> <span class=n>reflDir</span><span class=p>).</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>texColor</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>

    <span class=n>half3</span> <span class=n>col</span> <span class=o>=</span> <span class=n>reflCol</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>_RefractAmount</span><span class=p>)</span> <span class=o>+</span> <span class=n>refrCol</span> <span class=o>*</span> <span class=n>_RefractAmount</span><span class=p>;</span>

    <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>col</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></section><footer class=article-footer><section class=article-tags><a href=/tags/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81/>Shaderå…¥é—¨ç²¾è¦</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E7%94%BB%E9%9D%A2%E5%8A%A8%E8%B5%B7%E6%9D%A5/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E7%94%BB%E9%9D%A2%E5%8A%A8%E8%B5%B7%E6%9D%A5/topimg.da92c8fea658637ee841a18e087c1f1f_huc02f10a1e3cad6ccefc74d8d773bec3e_154933_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-2pLI/qZYY37oQaGOCHwfHw=="></div><div class=article-details><h2 class=article-title>Shaderå…¥é—¨ç²¾è¦-ç”»é¢åŠ¨èµ·æ¥</h2></div></a></article><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E6%9B%B4%E5%8A%A0%E5%A4%8D%E6%9D%82%E7%9A%84%E5%85%89%E7%85%A7/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E6%9B%B4%E5%8A%A0%E5%A4%8D%E6%9D%82%E7%9A%84%E5%85%89%E7%85%A7/topimg.6c5c6801e5665142f1afc74f7eccabb9_hud5b4711730563b8f6fe841cfaa71f45d_221051_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-bFxoAeVmUULxr8dPfsyruQ=="></div><div class=article-details><h2 class=article-title>Shaderå…¥é—¨ç²¾è¦-æ›´åŠ å¤æ‚çš„å…‰ç…§</h2></div></a></article><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/topimg.d65ee7581cfef7096ee4aec08398a608_hucec924f8a8d5e17115b60defab86f43b_300097_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-1l7nWBz+9wlu5K7Ag5imCA=="></div><div class=article-details><h2 class=article-title>Shaderå…¥é—¨ç²¾è¦-é€æ˜æ•ˆæœ</h2></div></a></article><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/topimg.b1f07d907209b24d4812f315eb6ff2fa_hub743dc7ee0e867207b7b55e10230ffbf_426847_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-sfB9kHIJsk1IEvMV62/y+g=="></div><div class=article-details><h2 class=article-title>Shaderå…¥é—¨ç²¾è¦-åŸºç¡€çº¹ç†</h2></div></a></article><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E7%AE%80%E5%8D%95%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E7%AE%80%E5%8D%95%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B/topimg.133a0281833f182f38ff49d986a235dc_hubb21fb6872520e85a0401e3049fab639_84088_250x150_fill_q75_h2_box_smart1.webp width=250 height=150 loading=lazy data-key data-hash="md5-EzoCgYM/GC84/0nZhqI13A=="></div><div class=article-details><h2 class=article-title>Shaderå…¥é—¨ç²¾è¦-ç®€å•å…‰ç…§æ¨¡å‹</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=YanTree/HUGO_COMMENT issue-term=YanTree/HUGO_COMMENT crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(b){let a=document.querySelector('.utterances iframe');a&&a.contentWindow.postMessage({type:'set-theme',theme:`github-${b}`},'https://utteranc.es')}addEventListener('message',a=>{if(a.origin!=='https://utteranc.es')return;setUtterancesTheme(document.body.dataset.scheme)}),window.addEventListener('onColorSchemeChange',a=>{setUtterancesTheme(a.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2021 YanTree</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script></body></html>