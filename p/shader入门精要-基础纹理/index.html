<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="介绍几种基本的纹理使用方法"><title>Shader入门精要-基础纹理</title><link rel=canonical href=https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Shader入门精要-基础纹理"><meta property="og:description" content="介绍几种基本的纹理使用方法"><meta property="og:url" content="https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/"><meta property="og:site_name" content="YanTree"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Shader入门精要"><meta property="article:published_time" content="2021-05-31T16:00:26+08:00"><meta property="article:modified_time" content="2021-05-31T16:00:26+08:00"><meta property="og:image" content="https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/topimg.png"><meta name=twitter:title content="Shader入门精要-基础纹理"><meta name=twitter:description content="介绍几种基本的纹理使用方法"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yantree.github.io/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/topimg.png"><link rel="shortcut icon" href=img/favicon.ico></head><body><script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.body.dataset.scheme='dark':document.body.dataset.scheme='light'})()</script><div class="container main-container flex on-phone--column extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hud8215445c04336af6f3d5658bab85db7_7222_300x0_resize_box_2.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>🍥</span></figure><h1 class=site-name><a href=https://yantree.github.io/>YanTree</a></h1><h2 class=site-description>子非蝶，亦非周</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://yantree.github.io/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/topimg_hub743dc7ee0e867207b7b55e10230ffbf_426847_800x0_resize_box_2.png srcset="/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/topimg_hub743dc7ee0e867207b7b55e10230ffbf_426847_800x0_resize_box_2.png 800w, /p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/topimg_hub743dc7ee0e867207b7b55e10230ffbf_426847_1600x0_resize_box_2.png 1600w" width=800 height=451 loading=lazy alt="Featured image of post Shader入门精要-基础纹理"></a></div><div class=article-details><header class=article-category><a href=/categories/%E6%B8%B2%E6%9F%93/>渲染</a></header><h2 class=article-title><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/>Shader入门精要-基础纹理</a></h2><h3 class=article-subtitle>介绍几种基本的纹理使用方法</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>May 31, 2021</time></footer></div></header><section class=article-content><h1 id=技术美术基础纹理>技术美术——基础纹理</h1><h2 id=常规纹理>常规纹理</h2><p>纹理的一种使用方式就是作为常规纹理，可以理解为一张照片。在这里纹理的作用是代替 <strong>物体的漫反射系数</strong> ，这里我们会再之前的 Blinn-Phong 高光反射 shader 的基础上实现一个基础的纹理 shader。这里可以知道常规纹理会参与 <strong>环境光</strong> ，物体 <strong>漫反射</strong> 的计算。在基本光照模型中，由于没有相关材质贴图，所以在计算公式中</p><blockquote><p>C = (c * m) * max(0 , n * l )</p></blockquote><p><strong>m</strong> 的值取为 1，不会影响到漫反射光的计算。当 <strong>m</strong> 值存在时，也就是有常规纹理的时候，光照计算中的 <strong>m</strong> 就要从常规纹理图中读取，读取方法见下面 albedo 的计算方法。</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>MainTex0</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_MainTex</span> <span class=p>(</span><span class=err>&#34;</span><span class=n>Texture</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_Color</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_SpecularCol</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specular</span> <span class=n>Col</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_SpecularStrength</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specular</span> <span class=n>Strength</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>8.0</span><span class=p>,</span> <span class=mi>256</span><span class=p>))</span><span class=o>=</span><span class=mi>10</span>
        
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Opaque</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>LightMode</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>ForwardBase</span><span class=err>&#34;</span> <span class=p>}</span>
        <span class=n>LOD</span> <span class=mi>100</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>CGPROGRAM</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=k>sampler2D</span> <span class=n>_MainTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_MainTex_ST</span><span class=p>;</span>
            <span class=n>half4</span> <span class=n>_Color</span><span class=p>;</span>
            <span class=n>half4</span> <span class=n>_SpecularCol</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_SpecularStrength</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>texcoord</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>posWorld</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>uv</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldNormal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldPos</span> <span class=o>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>

            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>posWorld</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>     <span class=c1>// 顶点位置从模型空间转到裁剪空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span> <span class=o>=</span> <span class=n>UnityObjectToWorldDir</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span> <span class=c1>// 顶点法线从模型空间转到世界空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldPos</span> <span class=o>=</span> <span class=n>UnityObjectToWorldDir</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>    <span class=c1>// 顶点从模型空间转到世界空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span> <span class=c1>// 使用纹理属性的_ST对顶点纹理坐标进行变换</span>
                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>worldNormal</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span> <span class=c1>// 顶点法线方向</span>
                <span class=n>half3</span> <span class=n>worldLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>_WorldSpaceLightPos0</span><span class=p>.</span><span class=n>xyz</span><span class=p>);</span> <span class=c1>// 主光源放方向</span>
                <span class=n>half3</span> <span class=n>viewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>_WorldSpaceCameraPos</span><span class=p>.</span><span class=n>xyz</span> <span class=o>-</span> <span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>);</span> <span class=c1>// 视角方向</span>
                <span class=n>half3</span> <span class=n>halfDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>viewDir</span> <span class=o>+</span> <span class=n>worldLightDir</span><span class=p>);</span> <span class=c1>// 半角方向</span>

                <span class=n>half3</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>worldLightDir</span><span class=p>));</span> <span class=c1>// Lambert</span>
                <span class=n>half3</span> <span class=n>NdotV</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>halfDir</span><span class=p>));</span>       <span class=c1>// BlinnPhong</span>

                <span class=n>half3</span> <span class=n>albedo</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>).</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>    <span class=c1>// 漫反射系数，从纹理采样漫反射颜色作为其值</span>
                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span> <span class=o>*</span> <span class=n>albedo</span><span class=p>;</span>   <span class=c1>// 环境光</span>

                <span class=c1>// 漫反射光 = 入射光线强度 * 材质的漫反射系数 * 取值为正数(表面法线方向 · 光源方向)</span>
                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>albedo</span> <span class=o>*</span> <span class=n>pow</span><span class=p>(</span><span class=n>NdotL</span> <span class=o>*</span> <span class=mf>0.5</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>2.0</span><span class=p>);</span> <span class=c1>// half lambert</span>
                <span class=n>half3</span> <span class=n>specular</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_SpecularCol</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>pow</span><span class=p>(</span><span class=n>NdotV</span><span class=p>,</span> <span class=n>_SpecularStrength</span><span class=p>);</span> <span class=c1>// blinn phong</span>
             
                <span class=k>return</span> <span class=n>fixed4</span><span class=p>(</span><span class=n>diffuse</span> <span class=o>+</span> <span class=n>specular</span> <span class=o>+</span> <span class=n>ambient</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h2 id=凹凸映射>凹凸映射</h2><p>凹凸映射的作用就是使用一张纹理来修改模型表面的法线，提供更多的细节效果。主要有两种方法：</p><ol><li><p>高度映射</p><p>一张高度纹理来模拟表面位移，然后得到一个修改后的法线值。</p></li><li><p>法线映射</p><p>一张法线纹理来直接存储表面法线。</p></li></ol><p>通常我们将高度映射和法线映射当成一种技术，但是两者的本质是有所区别的。</p><h3 id=法线纹理>法线纹理</h3><p>法线纹理中存储的是表面的法线方向，由于发现分量的取值范围在 [-1, 1] 之间，而像素的分量范围在 [0, 1] ，因此两者的转换还需要做一个映射：</p><blockquote><p>pixel = (normal + 1) / 2</p></blockquote><p>反映射后就能得到原先的法线方向</p><blockquote><p>normal = pixel * 2 - 1</p></blockquote><h4 id=法线的坐标空间>法线的坐标空间</h4><ol><li><p>模型空间的法线纹理</p><p>模型顶点的法线定义在模型空间中，一种直接的想法就是将修改后的模型空间中的表面法线存储在一张纹理中，这种纹理被称之为 <strong>模型空间的法线纹理</strong>。</p></li><li><p>切线空间的法线纹理</p><p>实际应用中，我们常用模型顶点的 <strong>切线空间</strong> 存储法线。对于模型的每个顶点，都有属于自己的切线空间，模型的顶点就是切线空间的原点，顶点的法线作切线空间的 z 轴 (n)，顶点的切线方向作 x 轴 (t)，顶点的 y 轴可由 x、z 叉乘求得，也被称为 <strong>副切线</strong> 或 <strong>副法线</strong> (b)，这就是 <strong>切线空间的法线纹理</strong>。</p></li></ol><h4 id=计算方式>计算方式</h4><p>由于法线纹理中存储的是切线空间下的方向，因此我们通常有两种选择：</p><ol><li>在切线空间下进行光照计算，需要将光照方向、视角方向变换到切线空间下。</li><li>在世界空间下进行光照计算，需要把采样得到的法线方向变换到世界空间下，再和世界空间下的光照方向和视角方向进行计算。</li></ol><p>效率上考虑，第一种优于第二种，因为整个空间的变换过程在顶点着色器中完成。</p><p>通用性考虑，第二种优于第一种，因为有时需要在世界空间进行一次矩阵操作。</p><h5 id=切线空间计算>切线空间计算</h5><p>思路：1. 在顶点着色器里将模型空间下的光源方向、视角方向转到切线空间；2. 在片元着色器里直接对法线纹理进行采样，得到切线空间下的法线数值；3. 进行光照计算。</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>MainBumpT</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_MainTex</span> <span class=p>(</span><span class=err>&#34;</span><span class=n>MainTex</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_BumpTex</span><span class=p>(</span><span class=err>&#34;</span><span class=n>BumpTex</span><span class=err>&#34;</span><span class=p>,</span><span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_BumpStrength</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Bump</span> <span class=n>Strength</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Float</span><span class=p>)</span> <span class=o>=</span> <span class=mf>1.0</span>
        <span class=n>_Color</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Color</span> <span class=n>Tint</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_Specular</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specular</span> <span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_SpecularStrength</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specular</span> <span class=n>Strength</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>8.0</span><span class=p>,</span> <span class=mi>256</span><span class=p>))</span> <span class=o>=</span> <span class=mi>20</span>
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Opaque</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>LightModel</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>ForwardBase</span><span class=err>&#34;</span> <span class=p>}</span>
        <span class=n>LOD</span> <span class=mi>100</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>CGPROGRAM</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=c1>//#include &#34;UnityCG.cginc&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>


            <span class=k>sampler2D</span> <span class=n>_MainTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_MainTex_ST</span><span class=p>;</span>
            <span class=k>sampler2D</span> <span class=n>_BumpTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_BumpTex_ST</span><span class=p>;</span>
            <span class=k>half</span> <span class=n>_BumpStrength</span><span class=p>;</span>
            <span class=n>half4</span> <span class=n>_Color</span><span class=p>;</span>
            <span class=n>half4</span> <span class=n>_Specular</span><span class=p>;</span>
            <span class=k>half</span> <span class=n>_SpecularStrength</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>texcoord</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>tangent</span> <span class=o>:</span> <span class=n>TANGENT</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>uv</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>  <span class=c1>// flaot4 因为使用了两张纹理贴图，所以成 flaot4 了</span>
                <span class=n>float4</span> <span class=n>posWorld</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>lightDir</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>viewDir</span> <span class=o>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
            <span class=p>};</span>


            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>posWorld</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>      <span class=c1>// 顶点坐标从模型空间转到裁剪空间</span>

                <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>xy</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span> <span class=c1>// MainTex 的 Tiling 和 Offset</span>
                <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>zw</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_BumpTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_BumpTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span> <span class=c1>// BumpTex 的 Tiling 和 offset</span>

                <span class=n>float3</span> <span class=n>binnormal</span> <span class=o>=</span> <span class=n>cross</span><span class=p>(</span><span class=n>normalize</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>),</span> <span class=n>normalize</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>.</span><span class=n>xyz</span><span class=p>))</span> <span class=o>*</span> <span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>.</span><span class=n>w</span><span class=p>;</span> <span class=c1>// 得到模型空间下的副切线(.w 是取一个方向作为切线方向)</span>
                <span class=n>float3x3</span> <span class=n>rotation</span> <span class=o>=</span> <span class=n>float3x3</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>binnormal</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span>                      <span class=c1>// 一个切线空间 (顶点切线方向作为 x,叉乘值作为 y, 顶点法线作为 z)</span>

                <span class=n>o</span><span class=p>.</span><span class=n>lightDir</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>rotation</span><span class=p>,</span> <span class=n>ObjSpaceLightDir</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>));</span> <span class=c1>// 模型空间下的光照方向转到切线空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>viewDir</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>rotation</span><span class=p>,</span> <span class=n>ObjSpaceViewDir</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>));</span>   <span class=c1>// 模型空间下的视角方向转到切线空间</span>

                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>tangentLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>lightDir</span><span class=p>);</span> <span class=c1>// 归一化光照方向</span>
                <span class=n>half3</span> <span class=n>tangentViewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>viewDir</span><span class=p>);</span>   <span class=c1>// 归一化视角方向</span>
                <span class=n>half3</span> <span class=n>halfDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>tangentLightDir</span> <span class=o>+</span> <span class=n>tangentViewDir</span><span class=p>);</span> <span class=c1>// 归一化半角方向</span>

                <span class=n>half4</span> <span class=n>packNormal</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_BumpTex</span><span class=p>,</span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>zw</span><span class=p>);</span>    <span class=c1>// 对法线贴图进行采样</span>
                <span class=n>half3</span> <span class=n>tangentNormal</span><span class=p>;</span>
                <span class=n>tangentNormal</span><span class=o>=</span><span class=n>UnpackNormal</span><span class=p>(</span><span class=n>packNormal</span><span class=p>);</span>
                <span class=n>tangentNormal</span><span class=p>.</span><span class=n>xy</span><span class=o>*=</span><span class=n>_BumpStrength</span><span class=p>;</span>               <span class=c1>// 调整法线缩放，控制凹凸强度</span>
                <span class=n>tangentNormal</span><span class=p>.</span><span class=n>z</span> <span class=o>=</span> <span class=n>sqrt</span><span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>tangentNormal</span><span class=p>.</span><span class=n>xy</span><span class=p>,</span> <span class=n>tangentNormal</span><span class=p>.</span><span class=n>xy</span><span class=p>)));</span>

                <span class=n>half3</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>tangentNormal</span><span class=p>,</span> <span class=n>tangentLightDir</span><span class=p>));</span> <span class=c1>// lambert</span>
                <span class=n>half3</span> <span class=n>RdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>tangentNormal</span><span class=p>,</span> <span class=n>halfDir</span><span class=p>));</span>         <span class=c1>// blinn phong</span>

                <span class=n>half3</span> <span class=n>albedo</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span><span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>)</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>      <span class=c1>// 漫反射系数(从贴图中读取)</span>
                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span> <span class=o>*</span> <span class=n>albedo</span><span class=p>;</span> <span class=c1>// 环境光</span>
                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>albedo</span> <span class=o>*</span> <span class=n>pow</span><span class=p>(</span><span class=n>NdotL</span><span class=o>*</span><span class=mf>0.5</span> <span class=o>+</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>2.0</span><span class=p>);</span> <span class=c1>// half lambert</span>
                <span class=n>half3</span> <span class=n>specular</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Specular</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>pow</span><span class=p>(</span><span class=n>RdotL</span><span class=p>,</span> <span class=n>_SpecularStrength</span><span class=p>);</span>

                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>diffuse</span> <span class=o>+</span> <span class=n>specular</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>

</code></pre></div><h5 id=世界空间计算>世界空间计算</h5><p>思路：1. 在顶点着色器里将模型空间下的顶点位置、顶点法线、顶点切线、顶点副切线转到世界空间，并创建法线从切线空间转世界空间的 <strong>矩阵</strong>，用于后面采样法线纹理将法线从切线空间转到世界空间；2. 计算世界空间下的光照方向、视角方向，对法线纹理进行采样，并且将其从切线空间转到世界空间；3. 进行光照计算。</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>MainBumpW</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_MainTex</span> <span class=p>(</span><span class=err>&#34;</span><span class=n>MainTex</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_BumpTex</span><span class=p>(</span><span class=err>&#34;</span><span class=n>BumpTex</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_BumpScale</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Bump</span> <span class=n>Scale</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Float</span><span class=p>)</span> <span class=o>=</span> <span class=mf>1.0</span>
        <span class=n>_Color</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_Specular</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specular</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_SpecularPower</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specular</span> <span class=n>Power</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>8.0</span><span class=p>,</span> <span class=mi>256</span><span class=p>))</span> <span class=o>=</span> <span class=mi>20</span> 
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Opaque</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>LightMode</span><span class=err>&#34;</span><span class=o>=</span> <span class=err>&#34;</span><span class=n>ForwardBase</span><span class=err>&#34;</span><span class=p>}</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>CGPROGRAM</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=k>sampler2D</span> <span class=n>_MainTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_MainTex_ST</span><span class=p>;</span>
            <span class=k>sampler2D</span> <span class=n>_BumpTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_BumpTex_ST</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_Color</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_Specular</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_BumpScale</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_SpecularPower</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>tangent</span> <span class=o>:</span> <span class=n>TANGENT</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>texcoord</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>uv</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>posWorld</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>TtoW0</span><span class=o>:</span><span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>TtoW1</span><span class=o>:</span><span class=n>TEXCOORD2</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>TtoW2</span><span class=o>:</span><span class=n>TEXCOORD3</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>posWorld</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span> <span class=c1>// 顶点坐标从模型空间转到裁剪空间</span>

                <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>xy</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span>   <span class=c1>// _MainTex 缩放平移属性</span>
                <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>zw</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_BumpTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_BumpTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span>   <span class=c1>// _BumpTex 缩放平移属性</span>

                <span class=n>half3</span> <span class=n>worldPos</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span>     <span class=c1>// 顶点位置从模型空间转到世界空间</span>
                <span class=n>half3</span> <span class=n>worldNormal</span> <span class=o>=</span> <span class=n>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span>      <span class=c1>// 顶点法线从模型空间转到世界空间</span>
                <span class=n>half3</span> <span class=n>worldTangent</span> <span class=o>=</span> <span class=n>UnityObjectToWorldDir</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>.</span><span class=n>xyz</span><span class=p>);</span>   <span class=c1>// 顶点切线从模型空间转到世界空间</span>
                <span class=n>half3</span> <span class=n>worldBinormal</span> <span class=o>=</span> <span class=n>cross</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>worldTangent</span><span class=p>)</span> <span class=o>*</span> <span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>.</span><span class=n>w</span><span class=p>;</span> <span class=c1>// 计算世界空间下的副切线</span>

                <span class=n>o</span><span class=p>.</span><span class=n>TtoW0</span> <span class=o>=</span> <span class=n>float4</span><span class=p>(</span><span class=n>worldTangent</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>worldBinormal</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>worldNormal</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>worldPos</span><span class=p>.</span><span class=n>x</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>TtoW1</span> <span class=o>=</span> <span class=n>float4</span><span class=p>(</span><span class=n>worldTangent</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>worldBinormal</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>worldNormal</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>worldPos</span><span class=p>.</span><span class=n>y</span><span class=p>);</span>
                <span class=n>o</span><span class=p>.</span><span class=n>TtoW2</span> <span class=o>=</span> <span class=n>float4</span><span class=p>(</span><span class=n>worldTangent</span><span class=p>.</span><span class=n>z</span><span class=p>,</span> <span class=n>worldBinormal</span><span class=p>.</span><span class=n>z</span><span class=p>,</span> <span class=n>worldNormal</span><span class=p>.</span><span class=n>z</span><span class=p>,</span> <span class=n>worldPos</span><span class=p>.</span><span class=n>z</span><span class=p>);</span>

                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>worldPos</span> <span class=o>=</span> <span class=n>half3</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>TtoW0</span><span class=p>.</span><span class=n>w</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>TtoW1</span><span class=p>.</span><span class=n>w</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>TtoW2</span><span class=p>.</span><span class=n>w</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>lightDir</span> <span class=o>=</span> <span class=n>UnityWorldSpaceLightDir</span><span class=p>(</span><span class=n>worldPos</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>viewDir</span> <span class=o>=</span> <span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>worldPos</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>halfDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>lightDir</span> <span class=o>+</span> <span class=n>viewDir</span><span class=p>);</span>

                <span class=n>half3</span> <span class=n>bump</span> <span class=o>=</span> <span class=n>UnpackNormal</span><span class=p>(</span><span class=n>tex2D</span><span class=p>(</span><span class=n>_BumpTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>zw</span><span class=p>));</span> <span class=c1>// 从法线贴出中读取法线信息</span>
                <span class=n>bump</span><span class=p>.</span><span class=n>xy</span><span class=o>*=</span><span class=n>_BumpScale</span><span class=p>;</span>   <span class=c1>// 缩放法线贴图</span>
                <span class=n>bump</span><span class=p>.</span><span class=n>z</span> <span class=o>=</span> <span class=n>sqrt</span><span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>dot</span><span class=p>(</span><span class=n>bump</span><span class=p>.</span><span class=n>xy</span><span class=p>,</span> <span class=n>bump</span><span class=p>.</span><span class=n>xy</span><span class=p>));</span>
                <span class=n>bump</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>half3</span><span class=p>(</span><span class=n>dot</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>TtoW0</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>bump</span><span class=p>),</span> <span class=n>dot</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>TtoW1</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>bump</span><span class=p>),</span> <span class=n>dot</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>TtoW2</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>bump</span><span class=p>)));</span><span class=c1>// 切线空间转世界空间</span>

                <span class=k>half</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>bump</span><span class=p>,</span> <span class=n>lightDir</span><span class=p>));</span> <span class=c1>// lambert</span>
                <span class=k>half</span> <span class=n>NdotV</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>bump</span><span class=p>,</span> <span class=n>halfDir</span><span class=p>));</span>  <span class=c1>// blinn phong</span>

                <span class=n>half3</span> <span class=n>albedo</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>).</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>  <span class=c1>// 读取漫反射系数</span>
                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span> <span class=o>*</span> <span class=n>albedo</span><span class=p>;</span>  <span class=c1>// 环境光</span>

                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>albedo</span> <span class=o>*</span> <span class=n>pow</span><span class=p>(</span><span class=n>NdotL</span> <span class=o>*</span> <span class=mf>0.5</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>2.0</span><span class=p>);</span>
                <span class=n>half3</span> <span class=n>specular</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Specular</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>pow</span><span class=p>(</span><span class=n>NdotV</span><span class=p>,</span> <span class=n>_SpecularPower</span><span class=p>);</span>

                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>diffuse</span> <span class=o>+</span> <span class=n>specular</span> <span class=o>+</span> <span class=n>ambient</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>

</code></pre></div><h2 id=渐变纹理>渐变纹理</h2><p>如常规纹理一样，我们在渲染中使用纹理是为了定义一个物体的颜色。<strong>纹理其实可以用于存储任何表面属性</strong>，一种常见的作法就是使用纹理渐变来控制漫反射光照结果。其核心部分是纹理采样计算部分，使用了 <strong>Half Lambert</strong> 作为采样UV。</p><blockquote><p>注意将纹理的 Wrap mode 设为 Clamp</p></blockquote><p><figure style=flex-grow:177;flex-basis:426px><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/gradient.png data-size=1541x867><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/gradient.png srcset="/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/gradient_hu553dc67d125d0461a42a74d531399e0e_372717_480x0_resize_box_2.png 480w, /p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/gradient_hu553dc67d125d0461a42a74d531399e0e_372717_1024x0_resize_box_2.png 1024w" width=1541 height=867 loading=lazy alt=渐变纹理></a><figcaption>渐变纹理</figcaption></figure></p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>gradient</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_RampTex</span> <span class=p>(</span><span class=err>&#34;</span><span class=n>Ramp</span> <span class=n>Texture</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_Color</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Color</span> <span class=n>Tint</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_Specular</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specular</span> <span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_SpecularPower</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specular</span> <span class=n>Power</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>8.0</span><span class=p>,</span> <span class=mi>256</span><span class=p>))</span> <span class=o>=</span> <span class=mi>20</span>
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Opaque</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>LightModel</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>ForwardBase</span><span class=err>&#34;</span> <span class=p>}</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>CGPROGRAM</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=k>sampler2D</span> <span class=n>_RampTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_RampTex_ST</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_Color</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_Specular</span><span class=p>;</span>
            <span class=n>Float</span> <span class=n>_SpecularPower</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>texcoord</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>posWorld</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldNormal</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>worldPos</span> <span class=o>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
                <span class=n>float2</span> <span class=n>uv</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>posWorld</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span> <span class=c1>// 顶点坐标从模型空间转到世界空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldNormal</span> <span class=o>=</span> <span class=n>UnityObjectToWorldNormal</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span>    <span class=c1>// 法线从模型空间转到世界空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>worldPos</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>unity_ObjectToWorld</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>).</span><span class=n>xyz</span><span class=p>;</span>   <span class=c1>// 位置从模型空间转到世界空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>uv</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_RampTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_RampTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span> <span class=c1>// UV 的缩放和平移属性</span>
                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>worldNormal</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldNormal</span><span class=p>);</span> <span class=c1>// 归一化法线方向</span>
                <span class=n>half3</span> <span class=n>worldLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceLightDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span> <span class=c1>// 归一化主光源方向</span>
                <span class=n>half3</span> <span class=n>worldViewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>UnityWorldSpaceViewDir</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>worldPos</span><span class=p>));</span>   <span class=c1>// 归一化视角方向</span>
                <span class=n>half3</span> <span class=n>halfDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>worldLightDir</span> <span class=o>+</span> <span class=n>worldViewDir</span><span class=p>);</span>              <span class=c1>// 归一化半角方向</span>

                <span class=k>half</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>worldLightDir</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.5</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>);</span>   <span class=c1>// lambert</span>
                <span class=k>half</span> <span class=n>NdotV</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>worldNormal</span><span class=p>,</span> <span class=n>halfDir</span><span class=p>));</span>

                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span><span class=p>;</span>                         <span class=c1>// 环境光</span>
                <span class=n>half3</span> <span class=n>diffuseColor</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_RampTex</span><span class=p>,</span> <span class=n>half2</span><span class=p>(</span><span class=n>NdotL</span><span class=p>,</span> <span class=n>NdotL</span><span class=p>)).</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span> <span class=c1>// 反射颜色 = 使用渐变纹理来采样半兰伯特光照生成的纹理</span>
                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>diffuseColor</span><span class=p>;</span>
                <span class=n>half3</span> <span class=n>specular</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Specular</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>pow</span><span class=p>(</span><span class=n>NdotV</span><span class=p>,</span> <span class=n>_SpecularPower</span><span class=p>);</span>

                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>diffuse</span> <span class=o>+</span> <span class=n>specular</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
            <span class=n>FallBack</span> <span class=err>&#34;</span><span class=n>Specular</span><span class=err>&#34;</span>
<span class=p>}</span>

</code></pre></div><h2 id=遮罩纹理>遮罩纹理</h2><p>遮罩纹理可以让我们更加自由的控制模型表面的性质。遮罩纹理的使用一般是：通过采样得到遮罩纹理的纹素值，然后使用其中某个（或某几个）通道的值来与某种表面属性进行相乘，这样，当该通道的值为0时，可以保护表面不受该属性的影响。这里样例使用的高光的 <strong>mask</strong> ，并且是纹理的 <strong>r</strong> 通道。</p><p><figure style=flex-grow:177;flex-basis:425px><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/mask.png data-size=1537x867><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/mask.png srcset="/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/mask_hu6ab1f5e7d148a1d5886edf48c8120b93_314054_480x0_resize_box_2.png 480w, /p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/mask_hu6ab1f5e7d148a1d5886edf48c8120b93_314054_1024x0_resize_box_2.png 1024w" width=1537 height=867 loading=lazy alt="MainBump + MainBumpMask"></a><figcaption>MainBump + MainBumpMask</figcaption></figure></p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=n>Shader</span> <span class=err>&#34;</span><span class=n>Unlit</span><span class=o>/</span><span class=n>mask</span><span class=err>&#34;</span>
<span class=p>{</span>
    <span class=n>Properties</span>
    <span class=p>{</span>
        <span class=n>_MainTex</span> <span class=p>(</span><span class=err>&#34;</span><span class=n>MainTex</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_Color</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Color</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_BumpTex</span><span class=p>(</span><span class=err>&#34;</span><span class=n>BumpTex</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>whire</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_BumpScale</span><span class=p>(</span><span class=err>&#34;</span><span class=n>BumptScale</span><span class=err>&#34;</span><span class=p>,</span><span class=n>Float</span><span class=p>)</span> <span class=o>=</span> <span class=mf>1.0</span>
        <span class=n>_SpecularMask</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specular</span> <span class=n>Mask</span><span class=err>&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=n>D</span><span class=p>)</span> <span class=o>=</span> <span class=err>&#34;</span><span class=n>white</span><span class=err>&#34;</span> <span class=p>{}</span>
        <span class=n>_SpecularScale</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specular</span> <span class=n>Scale</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Float</span><span class=p>)</span> <span class=o>=</span> <span class=mf>1.0</span>
        <span class=n>_Specular</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specualr</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Color</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>_SpecularPower</span><span class=p>(</span><span class=err>&#34;</span><span class=n>Specular</span> <span class=n>Power</span><span class=err>&#34;</span><span class=p>,</span> <span class=n>Range</span><span class=p>(</span><span class=mf>8.0</span><span class=p>,</span> <span class=mi>256</span><span class=p>))</span> <span class=o>=</span> <span class=mi>20</span>
    <span class=p>}</span>
    <span class=n>SubShader</span>
    <span class=p>{</span>
        <span class=n>Tags</span> <span class=p>{</span> <span class=err>&#34;</span><span class=n>RenderType</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>Opaque</span><span class=err>&#34;</span> <span class=err>&#34;</span><span class=n>LightModel</span><span class=err>&#34;</span><span class=o>=</span><span class=err>&#34;</span><span class=n>ForwardBase</span><span class=err>&#34;</span> <span class=p>}</span>
        <span class=n>LOD</span> <span class=mi>100</span>

        <span class=n>Pass</span>
        <span class=p>{</span>
            <span class=n>CGPROGRAM</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>vertex</span> <span class=n>vert</span>
            <span class=err>#</span><span class=n>pragma</span> <span class=n>fragment</span> <span class=n>frag</span>

            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>UnityCG</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>
            <span class=err>#</span><span class=n>include</span> <span class=err>&#34;</span><span class=n>Lighting</span><span class=p>.</span><span class=n>cginc</span><span class=err>&#34;</span>

            <span class=k>sampler2D</span> <span class=n>_MainTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_MainTex_ST</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_Color</span><span class=p>;</span>
            <span class=k>sampler2D</span> <span class=n>_BumpTex</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_BumpTex_ST</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_BumpScale</span><span class=p>;</span>
            <span class=k>sampler2D</span> <span class=n>_SpecularMask</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_SpecularScale</span><span class=p>;</span>
            <span class=n>float4</span> <span class=n>_Specular</span><span class=p>;</span>
            <span class=k>float</span> <span class=n>_SpecularPower</span><span class=p>;</span>

            <span class=k>struct</span> <span class=n>appdata</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>vertex</span> <span class=o>:</span> <span class=n>POSITION</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>texcoord</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>normal</span> <span class=o>:</span> <span class=n>NORMAL</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>tangent</span> <span class=o>:</span> <span class=n>TANGENT</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=k>struct</span> <span class=n>v2f</span>
            <span class=p>{</span>
                <span class=n>float4</span> <span class=n>posWorld</span> <span class=o>:</span> <span class=n>SV_POSITION</span><span class=p>;</span>
                <span class=n>float4</span> <span class=n>uv</span> <span class=o>:</span> <span class=n>TEXCOORD0</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>lightDir</span> <span class=o>:</span> <span class=n>TEXCOORD1</span><span class=p>;</span>
                <span class=n>float3</span> <span class=n>viewDir</span> <span class=o>:</span> <span class=n>TEXCOORD2</span><span class=p>;</span>
            <span class=p>};</span>

            <span class=n>v2f</span> <span class=n>vert</span> <span class=p>(</span><span class=n>appdata</span> <span class=n>v</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>v2f</span> <span class=n>o</span><span class=p>;</span>
                <span class=n>o</span><span class=p>.</span><span class=n>posWorld</span> <span class=o>=</span> <span class=n>UnityObjectToClipPos</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>);</span>  <span class=c1>// 顶点坐标从模型空间转世界空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>xy</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_MainTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span> <span class=c1>// _MainTex 的缩放和平移</span>
                <span class=n>o</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>zw</span> <span class=o>=</span> <span class=n>v</span><span class=p>.</span><span class=n>texcoord</span><span class=p>.</span><span class=n>xy</span> <span class=o>*</span> <span class=n>_BumpTex_ST</span><span class=p>.</span><span class=n>xy</span> <span class=o>+</span> <span class=n>_BumpTex_ST</span><span class=p>.</span><span class=n>zw</span><span class=p>;</span> <span class=c1>// _BumpTex 的缩放和平移</span>

                <span class=n>float3</span> <span class=n>binormal</span> <span class=o>=</span> <span class=n>cross</span><span class=p>(</span><span class=n>normalize</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>),</span> <span class=n>normalize</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>))</span> <span class=o>*</span> <span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>.</span><span class=n>w</span><span class=p>;</span> <span class=c1>// 副切线</span>
                <span class=n>float3x3</span> <span class=n>rotation</span> <span class=o>=</span> <span class=n>float3x3</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>tangent</span><span class=p>.</span><span class=n>xyz</span><span class=p>,</span> <span class=n>binormal</span><span class=p>,</span> <span class=n>v</span><span class=p>.</span><span class=n>normal</span><span class=p>);</span>                  <span class=c1>// 变换矩阵</span>

                <span class=n>o</span><span class=p>.</span><span class=n>lightDir</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>rotation</span><span class=p>,</span> <span class=n>ObjSpaceLightDir</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>)).</span><span class=n>xyz</span><span class=p>;</span> <span class=c1>// 主光源方向从模型空间转到切线空间</span>
                <span class=n>o</span><span class=p>.</span><span class=n>viewDir</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>rotation</span><span class=p>,</span> <span class=n>ObjSpaceViewDir</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>vertex</span><span class=p>)).</span><span class=n>xyz</span><span class=p>;</span>   <span class=c1>// 视角方向从模型空间转到切线空间</span>
                <span class=k>return</span> <span class=n>o</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>fixed4</span> <span class=n>frag</span> <span class=p>(</span><span class=n>v2f</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>SV_Target</span>
            <span class=p>{</span>
                <span class=n>half3</span> <span class=n>tangentLightDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>lightDir</span><span class=p>);</span> <span class=c1>// 切线空间下主光源方向</span>
                <span class=n>half3</span> <span class=n>tangentViewDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>i</span><span class=p>.</span><span class=n>viewDir</span><span class=p>);</span>   <span class=c1>// 切线空间下的视角方向</span>
                <span class=n>half3</span> <span class=n>halfDir</span> <span class=o>=</span> <span class=n>normalize</span><span class=p>(</span><span class=n>tangentLightDir</span> <span class=o>+</span> <span class=n>tangentViewDir</span><span class=p>);</span> <span class=c1>// 半角方向</span>

                <span class=n>half3</span> <span class=n>tangentNormal</span> <span class=o>=</span> <span class=n>UnpackNormal</span><span class=p>(</span><span class=n>tex2D</span><span class=p>(</span><span class=n>_BumpTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>zw</span><span class=p>));</span> <span class=c1>// 从法线贴图读取法线信息</span>
                <span class=n>tangentNormal</span><span class=p>.</span><span class=n>xy</span> <span class=o>*=</span> <span class=n>_BumpScale</span><span class=p>;</span>                               <span class=c1>// 缩放法线</span>
                <span class=n>tangentNormal</span><span class=p>.</span><span class=n>z</span> <span class=o>=</span> <span class=n>sqrt</span><span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>tangentNormal</span><span class=p>.</span><span class=n>xy</span><span class=p>,</span> <span class=n>tangentNormal</span><span class=p>.</span><span class=n>xy</span><span class=p>)));</span> <span class=c1>// 计算法线的 z 值</span>

                <span class=k>half</span> <span class=n>NdotL</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>tangentNormal</span><span class=p>,</span> <span class=n>tangentLightDir</span><span class=p>));</span>   <span class=c1>// lambert</span>
                <span class=k>half</span> <span class=n>NdotV</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>dot</span><span class=p>(</span><span class=n>tangentNormal</span><span class=p>,</span> <span class=n>halfDir</span><span class=p>));</span>           <span class=c1>// blinn-phong</span>

                <span class=n>half3</span> <span class=n>albedo</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_MainTex</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>.</span><span class=n>xy</span><span class=p>).</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Color</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span>     <span class=c1>// 从材质贴图计算漫反射率</span>
                <span class=n>half3</span> <span class=n>ambient</span> <span class=o>=</span> <span class=n>UNITY_LIGHTMODEL_AMBIENT</span><span class=p>.</span><span class=n>xyz</span> <span class=o>*</span> <span class=n>albedo</span><span class=p>;</span>        <span class=c1>// 环境光</span>
                <span class=n>half3</span> <span class=n>diffuse</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>albedo</span> <span class=o>*</span> <span class=p>(</span><span class=n>NdotL</span> <span class=o>*</span> <span class=mf>0.5</span> <span class=o>+</span><span class=mf>0.5</span><span class=p>);</span>   <span class=c1>// 计算漫反射光</span>

                <span class=k>half</span> <span class=n>specularMask</span> <span class=o>=</span> <span class=n>tex2D</span><span class=p>(</span><span class=n>_SpecularMask</span><span class=p>,</span> <span class=n>i</span><span class=p>.</span><span class=n>uv</span><span class=p>).</span><span class=n>r</span> <span class=o>*</span> <span class=n>_Specular</span><span class=p>.</span><span class=n>rgb</span><span class=p>;</span> <span class=c1>// 从高光贴图中读取高光反射值</span>
                <span class=n>half3</span> <span class=n>specular</span> <span class=o>=</span> <span class=n>_LightColor0</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>_Specular</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>specularMask</span> <span class=o>*</span> <span class=n>pow</span><span class=p>(</span><span class=n>NdotV</span><span class=p>,</span> <span class=n>_SpecularPower</span><span class=p>);</span>

                <span class=k>return</span> <span class=n>half4</span><span class=p>(</span><span class=n>ambient</span> <span class=o>+</span> <span class=n>diffuse</span> <span class=o>+</span> <span class=n>specular</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>ENDCG</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>

</code></pre></div><p><strong>拓展</strong> ：Mask 的应用还有很大的空间，可以试着举例出来：UV 顶点动画。</p><h2 id=总结>总结</h2><table><thead><tr><th></th><th>漫反射系数</th><th>法线系数</th></tr></thead><tbody><tr><td>无纹理</td><td>1</td><td>模型法线</td></tr><tr><td>常规纹理</td><td>tex2D(_MainTex,i.uv).rgb * _Color.rgb</td><td>模型法线</td></tr><tr><td>法线纹理</td><td>tex2D(_MainTex,i.uv) * _Color.rgb</td><td>tex2D(_BumpTex,i.uv.zw)</td></tr><tr><td>渐变纹理</td><td>tex2D(_RampTex, <em>half2</em>(NdotL, NdotL)).rgb * _Color.rgb</td><td>模型法线</td></tr><tr><td>遮罩纹理</td><td>tex2D(_MainTex, i.uv.xy).rgb * _Color.rgb</td><td>(tex2D(_BumpTex, i.uv.zw)</td></tr></tbody></table></section><footer class=article-footer><section class=article-tags><a href=/tags/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81/>Shader入门精要</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E7%94%BB%E9%9D%A2%E5%8A%A8%E8%B5%B7%E6%9D%A5/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E7%94%BB%E9%9D%A2%E5%8A%A8%E8%B5%B7%E6%9D%A5/topimg.da92c8fea658637ee841a18e087c1f1f_huc02f10a1e3cad6ccefc74d8d773bec3e_154933_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-2pLI/qZYY37oQaGOCHwfHw=="></div><div class=article-details><h2 class=article-title>Shader入门精要-画面动起来</h2></div></a></article><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/topimg.67a55883ca0dddee7a38aee92b8bd0c8_hufdc4047d1f13243dc00ee98ca40c3721_1787439_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-Z6VYg8oN3e56OK7pK4vQyA=="></div><div class=article-details><h2 class=article-title>Shader入门精要-高级纹理</h2></div></a></article><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E6%9B%B4%E5%8A%A0%E5%A4%8D%E6%9D%82%E7%9A%84%E5%85%89%E7%85%A7/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E6%9B%B4%E5%8A%A0%E5%A4%8D%E6%9D%82%E7%9A%84%E5%85%89%E7%85%A7/topimg.6c5c6801e5665142f1afc74f7eccabb9_hud5b4711730563b8f6fe841cfaa71f45d_221051_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-bFxoAeVmUULxr8dPfsyruQ=="></div><div class=article-details><h2 class=article-title>Shader入门精要-更加复杂的光照</h2></div></a></article><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/topimg.d65ee7581cfef7096ee4aec08398a608_hucec924f8a8d5e17115b60defab86f43b_300097_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-1l7nWBz+9wlu5K7Ag5imCA=="></div><div class=article-details><h2 class=article-title>Shader入门精要-透明效果</h2></div></a></article><article class=has-image><a href=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E7%AE%80%E5%8D%95%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B/><div class=article-image><img src=/p/shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81-%E7%AE%80%E5%8D%95%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B/topimg.133a0281833f182f38ff49d986a235dc_hubb21fb6872520e85a0401e3049fab639_84088_250x150_fill_q75_h2_box_smart1.webp width=250 height=150 loading=lazy data-key data-hash="md5-EzoCgYM/GC84/0nZhqI13A=="></div><div class=article-details><h2 class=article-title>Shader入门精要-简单光照模型</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=YanTree/HUGO_COMMENT issue-term=YanTree/HUGO_COMMENT crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(b){let a=document.querySelector('.utterances iframe');a&&a.contentWindow.postMessage({type:'set-theme',theme:`github-${b}`},'https://utteranc.es')}addEventListener('message',a=>{if(a.origin!=='https://utteranc.es')return;setUtterancesTheme(document.body.dataset.scheme)}),window.addEventListener('onColorSchemeChange',a=>{setUtterancesTheme(a.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2021 YanTree</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script></body></html>