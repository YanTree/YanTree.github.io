<!DOCTYPE html>
<html lang="zh-cn"><head>
  <meta charset="UTF-8">
  <style type="text/css">
    :root .footer > #box[style="width:100%;height:100%;position:fixed;top:0"],
    :root .btn.btn-default.hotwords[target="_blank"],
    :root .error > #qqs,
    :root .content > a > .topline,
    :root .container > a.mid-wrapper,
    :root .container > .pic_container,
    :root .container > .ads
    { display: none !important; }</style>  
  <link crossorigin="anonymous" media="all"
        rel="stylesheet"
        href="https://yantree.github.io/style/css/frameworks.css" />
  <link crossorigin="anonymous" media="all"
        rel="stylesheet" href="https://yantree.github.io/style/css/github.css" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã€ŒGodotã€ARPG å®ä¾‹</title>
  <link rel="icon" type="image/x-icon" class="js-site-favicon" href="https://yantree.github.io/style/favicon.ico">
  <meta name="theme-color" content="#1e2327">
  

  <script crossorigin="anonymous"
  type="application/javascript" src="https://yantree.github.io/style/js/compat-bootstrap.js"></script>
  <script crossorigin="anonymous"
  type="application/javascript" src="https://yantree.github.io/style/js/environment-bootstrap.js"></script>
  <script crossorigin="anonymous"
  type="application/javascript" src="https://yantree.github.io/style/js/vendor.js"></script>  
  <script crossorigin="anonymous"
          type="application/javascript" src="https://yantree.github.io/style/js/frameworks.js"></script>

  <script crossorigin="anonymous" async="async"
          type="application/javascript" src="https://yantree.github.io/style/js/github-bootstrap.js"></script>
          

          
</head>
<body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper">
  <a href="#start-of-content" class="p-3 bg-blue text-white show-on-focus js-skip-to-content">Skip to content</a>
  <span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar">
    <span class="progress-pjax-loader-bar top-0 left-0" style="width: 0%;"></span>
  </span>

  
  <header class="Header js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role="banner">

    
    <div class="Header-item d-none d-lg-flex">
      <a class="Header-link" href="https://yantree.github.io/" aria-label="Homepage" data-ga-click="Header, go to dashboard, icon:logo">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true">
          <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
      </a>
    </div>

    
    <div class="Header-item d-lg-none">
      <button class="Header-link btn-link js-details-target" type="button" aria-label="Toggle navigation" aria-expanded="false">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 12 16" version="1.1" width="18" aria-hidden="true"><path fill-rule="evenodd" d="M11.41 9H.59C0 9 0 8.59 0 8c0-.59 0-1 .59-1H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1h.01zm0-4H.59C0 5 0 4.59 0 4c0-.59 0-1 .59-1H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1h.01zM.59 11H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1H.59C0 13 0 12.59 0 12c0-.59 0-1 .59-1z"></path></svg>
      </button>
    </div>

    
    <div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden">

      
      <div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role="combobox" aria-owns="jump-to-results" aria-label="Search or jump to" aria-haspopup="listbox" aria-expanded="false">
        <div class="position-relative">
        </div>
      </div>

            
      <nav class="d-flex flex-column flex-lg-row flex-self-stretch flex-lg-self-auto" aria-label="Global">
        <a class="js-selected-navigation-item Header-link  mr-0 mr-lg-3 py-2 py-lg-0 border-top border-lg-top-0 border-white-fade-15" data-hotkey="g p" data-ga-click="Header, click, Nav menu - item:home context:user" aria-label="Pull requests you created" data-selected-links="/pulls /pulls/assigned /pulls/mentioned /pulls" href="https://yantree.github.io/">
          Home
        </a>
        <a class="js-selected-navigation-item Header-link  mr-0 mr-lg-3 py-2 py-lg-0 border-top border-lg-top-0 border-white-fade-15" data-hotkey="g i" data-ga-click="Header, click, Nav menu - item:gallery context:user" aria-label="Issues you created" data-selected-links="/issues /issues/assigned /issues/mentioned /issues" href="https://yantree.github.io/other_pages/gallery/">
          Gallery
        </a>



        <a class="js-selected-navigation-item Header-link  mr-0 mr-lg-3 py-2 py-lg-0 border-top border-lg-top-0 border-white-fade-15" data-ga-click="Header, click, Nav menu - item:about" data-selected-links="/explore /trending /trending/developers /integrations /integrations/feature/code /integrations/feature/collaborate /integrations/feature/ship showcases showcases_search showcases_landing /explore" href="#">
          
        </a>
</nav>


</div>
<div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style="margin-right: auto;">
  <a class="Header-link" href="https://yantree.github.io/" aria-label="Homepage" data-ga-click="Header, go to dashboard, icon:logo">
    <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true">
      <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
    </svg>
  </a>
</div>



<div class="Header-item mr-0 mr-lg-3 flex-order-1 flex-lg-order-none">
  <a aria-label="Send me an email" href="mailto:yanshudream@outlook.com" class="Header-link notification-indicator position-relative tooltipped tooltipped-sw js-socket-channel js-notification-indicator" data-hotkey="g n" data-ga-click="Header, go to notifications, icon:read" data-channel="notification-changed:42629243">
    <span class="js-indicator-modifier mail-status "></span>
    <svg class="octicon octicon-mail" viewBox="0 0 16 16" version="1.1" width="32" height="32" aria-hidden="true"><path fill-rule="evenodd" d="M0 4v8c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H1c-.55 0-1 .45-1 1zm13 0L7 9 1 4h12zM1 5.5l4 3-4 3v-6zM2 12l3.5-3L7 10.5 8.5 9l3.5 3H2zm11-.5l-4-3 4-3v6z"></path></svg>
  </a>
</div>
</header>
</div>
<div id="js-flash-container">


    <template class="js-flash-template">
      <div class="flash flash-full  js-flash-template-container">
    <div class="container-xl px-2">
      <button class="flash-close js-flash-close" type="button" aria-label="Dismiss this message">
        <svg class="octicon octicon-x" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48L7.48 8z"></path></svg>
      </button>
      
        <div class="js-flash-template-message"></div>
  
    </div>
  </div>
    </template>
  </div><div id="content">
<div class="application-main " data-commit-hovercards-enabled="">
  <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode" class="">
    <main id="js-repo-pjax-container" data-pjax-container="">
      <div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4 ">
        <div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block">
          <div class="mb-3 d-flex">
            <h1 class="public css-truncate float-none flex-auto width-fit pl-0">
              <a class="avatar mr-1">
                <img
                  src="https://avatars3.githubusercontent.com/u/42629243?s=60&u=4c15c4c420106664f4020caa794ccfc78a762ece&v=4" width="26" height="26">
              </a>
              <span class="author"><a
                                     href="https://yantree.github.io/">YanTree</a></span>
              <span class="path-divider">/</span>
              <strong itemprop="name" class="css-truncate-target" style="max-width: 410px"><a
                                                                                             href="https://yantree.github.io/posts/develop/2020-05-05-godot3-2-1-action-rpg/">ã€ŒGodotã€ARPG å®ä¾‹</a></strong>

              <div class="d-block text-small text-gray">
                Created <time-ago datetime="2020-05-05" class="no-wrap"
                                  title="Created at 2020/05/05">
                  2020-05-05</time-ago>
                <span class="file-info-divider"></span>
                Modifyed <time-ago datetime="2020-05-05" class="no-wrap"
                                   title="Modified  at 2020/05/05">
                  2020-05-05</time-ago>
              </div>
            </h1>
          </div>
        </div>




      </div>
      <div class="container-lg clearfix new-discussion-timeline experiment-repo-nav  p-responsive">
        <div class="repository-content ">
          <div class="Box mt-3 position-relative">
            <div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center">
              <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                7165 Words
                
              </div>
            </div>

            <div id="readme" class="Box-body readme blob instapaper_body js-code-block-container">
              <article class="markdown-body entry-content p-3 p-md-6" itemprop="text"><h1 id="action-rpg-å®æˆ˜">Action RPG å®æˆ˜</h1>
<p>æ•´ä¸ªé¡¹ç›®æ•™ç¨‹ç”± <strong><a href="https://www.youtube.com/watch?v=mAbG8Oi-SvQ&amp;list=PL9FzW-m48fn2SlrW0KoLT4n5egNdX-W9a">æœ¬æ°æ˜</a></strong> å¸ˆå‚…åˆ¶ä½œï¼Œé¡¹ç›®çš„èµ„æºåœ¨æœ¬æ°æ˜å¸ˆå‚…çš„ <strong><a href="https://github.com/uheartbeast/youtube-tutorials/blob/master/Action%20RPG/Action%20RPG%20Resources.zip">Github</a></strong> è´¦å·é‡Œã€‚</p>
<!-- raw HTML omitted -->
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#action-rpg-%E5%AE%9E%E6%88%98">Action RPG å®æˆ˜</a>
<ul>
<li><a href="#1delta--smooth-move">1ï¼ŒDelta + Smooth move</a>
<ul>
<li><a href="#delta">Delta</a></li>
<li><a href="#smooth-move">Smooth move</a></li>
</ul>
</li>
<li><a href="#2collisions--move_and_slide">2ï¼ŒCollisions + move_and_slide</a>
<ul>
<li><a href="#collisions">collisions</a></li>
<li><a href="#move_and_slide">move_and_slide</a></li>
</ul>
</li>
<li><a href="#3scenes--ysort">3ï¼ŒScenes + ysort</a>
<ul>
<li><a href="#scenes">scenes</a></li>
<li><a href="#ysort">ysort</a></li>
</ul>
</li>
<li><a href="#4animationplayer">4ï¼ŒAnimationPlayer</a></li>
<li><a href="#5animationtree">5ï¼ŒAnimationTree</a></li>
<li><a href="#6background-grass--dirt-path-autotile">6ï¼ŒBackground Grass + Dirt Path Autotile</a>
<ul>
<li><a href="#background-grass">background grass</a></li>
<li><a href="#autotile">autotile</a></li>
</ul>
</li>
<li><a href="#7collision-with-autotiles">7ï¼ŒCollision with autotiles</a></li>
<li><a href="#8attack-animation--state-marhes">8ï¼ŒAttack Animation + State Marhes</a></li>
<li><a href="#9signals--instancing-scenes-in-code">9ï¼ŒSignals + Instancing Scenes in Code</a>
<ul>
<li><a href="#_process-%E5%92%8C--physics_process-%E7%9A%84%E6%AF%94%E8%BE%83"><code>_process</code> å’Œ <code>-physics_process</code> çš„æ¯”è¾ƒ</a>
<ul>
<li><a href="#%E7%9B%B8%E5%90%8C">ç›¸åŒ</a></li>
<li><a href="#%E4%B8%8D%E5%90%8C">ä¸åŒ</a></li>
</ul>
</li>
<li><a href="#animationsprite-%E5%92%8C-animationplayer"><code>AnimationSprite</code> å’Œ <code>AnimationPlayer</code></a></li>
<li><a href="#signals">Signals</a></li>
<li><a href="#instancing-scenes-in-code">Instancing Scenes in Code</a></li>
</ul>
</li>
<li><a href="#10melee-attacks-with-hurtboxes-and-hitboxes">10ï¼ŒMelee Attacks with Hurtboxes and Hitboxes</a>
<ul>
<li><a href="#%E6%80%9D%E8%B7%AF%EF%BC%9A">æ€è·¯ï¼š</a></li>
<li><a href="#%E6%96%B0%E9%97%AE%E9%A2%98">æ–°é—®é¢˜</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95">è§£å†³æ–¹æ³•</a></li>
<li><a href="#%E6%96%B0%E7%9A%84%E6%8E%A2%E8%AE%A8">æ–°çš„æ¢è®¨</a></li>
<li><a href="#%E8%A7%A3">è§£</a></li>
</ul>
</li>
<li><a href="#11roll-state">11ï¼ŒRoll State</a></li>
<li><a href="#12knockback--enemy-bat">12ï¼ŒKnockback + Enemy Bat</a></li>
<li><a href="#13enemy-stats--export-variables--setget">13ï¼ŒEnemy Stats + Export Variables + Setget</a></li>
<li><a href="#14enemy-death-effect--bug-fix">14ï¼ŒEnemy Death Effect + Bug Fix</a>
<ul>
<li><a href="#bug">Bug</a></li>
<li><a href="#death-effect">death effect</a></li>
</ul>
</li>
<li><a href="#15bat-ai-start">15ï¼ŒBat AI Start</a>
<ul>
<li><a href="#hit-animate">hit animate</a></li>
<li><a href="#ai-start">AI start</a>
<ul>
<li><a href="#%E5%88%9B%E5%BB%BA%E4%BE%A6%E5%AF%9F%E5%8C%BA%E5%9F%9F">åˆ›å»ºä¾¦å¯ŸåŒºåŸŸ</a></li>
<li><a href="#bat-%E7%9A%84%E4%B8%89%E4%B8%AA%E7%8A%B6%E6%80%81">bat çš„ä¸‰ä¸ªçŠ¶æ€</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#16player-status--enemy-attack">16ï¼ŒPlayer Status + Enemy Attack</a>
<ul>
<li><a href="#%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98">å‡ºç°çš„é—®é¢˜</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF">è§£å†³æ€è·¯</a></li>
</ul>
</li>
<li><a href="#17player-hearts-ui">17ï¼ŒPlayer Hearts UI</a>
<ul>
<li><a href="#control-node">Control Node</a></li>
<li><a href="#texturerect">TextureRect</a>
<ul>
<li><a href="#code">code</a></li>
</ul>
</li>
<li><a href="#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98">é‡åˆ°çš„é—®é¢˜</a></li>
</ul>
</li>
<li><a href="#18enemy-soft-collisions">18ï¼ŒEnemy Soft Collisions</a></li>
<li><a href="#19player-camera">19ï¼ŒPlayer Camera</a>
<ul>
<li><a href="#%E8%AE%A9-camera-%E7%A7%BB%E5%8A%A8%E6%9B%B4%E5%8A%A0%E5%B9%B3%E6%BB%91">è®© Camera ç§»åŠ¨æ›´åŠ å¹³æ»‘</a></li>
<li><a href="#%E5%B0%86%E6%98%BE%E7%A4%BA%E7%94%9F%E5%91%BD%E5%80%BC%E7%8A%B6%E6%80%81%E7%9A%84%E5%9B%BA%E5%AE%9A%E5%9C%A8-camera-%E7%9A%84%E5%B7%A6%E4%B8%8A%E8%A7%92">å°†æ˜¾ç¤ºç”Ÿå‘½å€¼çŠ¶æ€çš„â™¥å›ºå®šåœ¨ Camera çš„å·¦ä¸Šè§’</a></li>
<li><a href="#%E4%BF%AE%E5%A4%8D%E8%A7%92%E8%89%B2%E6%AD%BB%E4%BA%A1%E6%97%B6camera-%E5%9B%9E%E5%88%B0%E8%A7%92%E8%89%B2%E5%88%9D%E5%A7%8B%E4%BD%8D%E7%BD%AE%E7%9A%84-bug">ä¿®å¤è§’è‰²æ­»äº¡æ—¶ï¼ŒCamera å›åˆ°è§’è‰²åˆå§‹ä½ç½®çš„ BUG</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<h2 id="1delta--smooth-move">1ï¼ŒDelta + Smooth move</h2>
<h3 id="delta">Delta</h3>
<p><code>delta</code> å…¶å®æ˜¯ä¸€ä¸ªæ•°å€¼ï¼Œç­‰äºæ¸¸æˆä»ä¸Šä¸€å¸§åˆ°ä¸‹ä¸€å¸§çš„ ==æ—¶é—´å·®==ï¼ŒåŸºæœ¬æ˜¯å›ºå®šä¸å˜çš„ <code>1/60</code></p>
<h3 id="smooth-move">Smooth move</h3>
<p>æœ¬è´¨è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„ <code>delta</code> ã€‚å¼•æ“é»˜è®¤ä»¥ ==1pixel== ä¸ºå•ä½é€’å¢è¿›è¡Œç§»åŠ¨ï¼Œ<code>1 pixel * delta</code> å¤§å¹…ç¼©å°é€’å¢å•ä½ï¼Œä»¥æ­¤è®©è§’è‰²çš„ç§»åŠ¨æ›´å¹³æ»‘ã€‚</p>
<ul>
<li><strong>1 pixel</strong></li>
</ul>
<figure style="margin:1rem 0.5rem"><a href="../../../img/../../../img/godot/action-rpg/gotdot_piex_movetest.png" title="gotdot_piex_movetest.png"><img src="../../../img/../../../img/godot/action-rpg/gotdot_piex_movetest.png" alt="gotdot_piex_movetest.png" width=""></a></figure>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>

<span style="color:#66d9ef">var</span> velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO

<span style="color:#66d9ef">func</span> _physics_process(delta):
    <span style="color:#66d9ef">var</span> input_vector <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
    input_vector<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_right&#34;</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_left&#34;</span>)
    input_vector<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_down&#34;</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_up&#34;</span>)

    <span style="color:#66d9ef">if</span> input_vector <span style="color:#f92672">!=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO:
        velocity <span style="color:#f92672">=</span> input_vector
    <span style="color:#66d9ef">else</span>
        velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO

    velocity <span style="color:#f92672">=</span> move_and_collide(velocity)

</code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>1 pixel * delta</strong></li>
</ul>
<figure style="margin:1rem 0.5rem"><a href="../../../img/../../../img/godot/action-rpg/gotdot_smooth-move.png" title="gotdot_smooth-move.png"><img src="../../../img/../../../img/godot/action-rpg/gotdot_smooth-move.png" alt="gotdot_smooth-move.png" width=""></a></figure>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>

<span style="color:#66d9ef">const</span> ACCELERATION <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span>
<span style="color:#66d9ef">const</span> MAX_SPEED <span style="color:#f92672">=</span> <span style="color:#ae81ff">200</span>
<span style="color:#66d9ef">const</span> FRICTION <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span>

<span style="color:#66d9ef">var</span> velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO

<span style="color:#66d9ef">func</span> _physics_process(delta):
    <span style="color:#66d9ef">var</span> input_vector <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
    input_vector<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_right&#34;</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_left&#34;</span>)
    input_vector<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_down&#34;</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_up&#34;</span>)
    input_vector<span style="color:#f92672">=</span> input_vector<span style="color:#f92672">.</span>normalized() <span style="color:#75715e"># keep the same speed move 45 degree</span>

    <span style="color:#66d9ef">if</span> input_vector <span style="color:#f92672">!=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO:
        velocity <span style="color:#f92672">+=</span> input_vector <span style="color:#f92672">*</span> ACCELERATION <span style="color:#f92672">*</span> delta <span style="color:#75715e"># base delta&#39;s acceleration</span>
        velocity <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>clamped(MAX_SPEED <span style="color:#f92672">*</span> delta)  <span style="color:#75715e"># base delta&#39;s to restrict highest speed</span>
    <span style="color:#66d9ef">else</span>:
        velocity <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>move_toward(<span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO, FRICTION) <span style="color:#75715e"># smooth stop animation</span>

    move_and_collide(velocity)

</code></pre></td></tr></table>
</div>
</div><h2 id="2collisions--move_and_slide">2ï¼ŒCollisions + move_and_slide</h2>
<h3 id="collisions">collisions</h3>
<p>ç¢°æ’å™¨ <code>èŠ‚ç‚¹</code> ï¼Œgodot 2D é‡Œæœ‰ä¸¤ç±» <code>CollisionShape2D</code> + <code>CollisionPolygon2D</code></p>
<h3 id="move_and_slide">move_and_slide</h3>
<p>ä¸Šé¢å›¾ç‰‡é‡Œæœ€åä¸€è¡Œä»£ç ä½¿ç”¨çš„æ˜¯ <code>move_and_collide</code> ç§»åŠ¨å¹¶æ£€æµ‹æ˜¯å¦ç¢°æ’çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¹¶ä¸é€‚åˆç”¨æ¥ <code>æ§åˆ¶è§’è‰²</code> çš„ç§»åŠ¨ï¼Œç¢°æ’ä¹‹åä¼šç«‹åˆ»åœæ­¢å½“è§’è‰²ç§»åŠ¨è‡³è§’è½æ—¶ï¼Œè§’è‰²ä¼šä¸åœçš„ <code>sticky</code> ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ <code>move_and_slide</code> æ–¹æ³•ï¼Œå½“ç¢°æ’å‘ç”Ÿæ—¶ï¼ŒåŒæ—¶è®©è§’è‰²çš„ç§»åŠ¨æ›´åŠ  <code>slide</code> ã€‚</p>
<p>æ›¿æ¢åçš„ä»£ç ï¼š</p>
<figure style="margin:1rem 0.5rem"><a href="../../../img/../../../img/godot/action-rpg/collision_slide.png" title="collision_slide.png"><img src="../../../img/../../../img/godot/action-rpg/collision_slide.png" alt="collision_slide.png" width=""></a></figure>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>

<span style="color:#66d9ef">const</span> ACCELERATION <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>
<span style="color:#66d9ef">const</span> MAX_SPEED <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
<span style="color:#66d9ef">const</span> FRICTION <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>

<span style="color:#66d9ef">var</span> velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO

<span style="color:#66d9ef">func</span> _physics_process(delta):
    <span style="color:#66d9ef">var</span> input_vector <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
    input_vector<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_right&#34;</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_left&#34;</span>)
    input_vector<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_down&#34;</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_up&#34;</span>)
    input_vector<span style="color:#f92672">=</span> input_vector<span style="color:#f92672">.</span>normalized() <span style="color:#75715e"># keep the same speed move 45 degree</span>

    <span style="color:#66d9ef">if</span> input_vector <span style="color:#f92672">!=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO:
        velocity <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>move_toward(input_vector <span style="color:#f92672">*</span> MAX_SPEED, ACCELERATION <span style="color:#f92672">*</span> delta)
    <span style="color:#66d9ef">else</span>:
        velocity <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>move_toward(<span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO, FRICTION) <span style="color:#75715e"># smooth stop animation</span>

    velocity <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>move_toward(<span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO, FRICTION) <span style="color:#75715e"># smooth stop animation</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="3scenes--ysort">3ï¼ŒScenes + ysort</h2>
<h3 id="scenes">scenes</h3>
<p>godot çš„ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡ç†å¿µå°±æ˜¯åŸºäº <code>èŠ‚ç‚¹å¼</code> çš„è®¾è®¡ï¼Œä½ åˆ›å»ºçš„æ¯ä¸€ä¸ª <code>*.tscn</code> æ–‡ä»¶çš„æœ¬è´¨å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ä¼˜é›…ã€powerful çš„è®¾è®¡</p>
<h3 id="ysort">ysort</h3>
<p>ysort æ˜¯ä¸€ä¸ª 2D <code>èŠ‚ç‚¹</code> ï¼Œä½œç”¨å¦‚å…¶åï¼Œåœ¨å‚ç›´æ–¹å‘ä¸Šå¯¹èŠ‚ç‚¹é‡æ–°æ’åº</p>
<ul>
<li><strong>without ysort</strong></li>
</ul>
<figure style="margin:1rem 0.5rem"><a href="../../../img/../../../img/godot/action-rpg/without_ysort.png" title="without_ysort.png"><img src="../../../img/../../../img/godot/action-rpg/without_ysort.png" alt="without_ysort.png" width=""></a></figure>

<ul>
<li><strong>with ysort</strong></li>
</ul>
<figure style="margin:1rem 0.5rem"><a href="../../../img/../../../img/godot/action-rpg/with_ysort.png" title="with_ysort.png"><img src="../../../img/../../../img/godot/action-rpg/with_ysort.png" alt="with_ysort.png" width=""></a></figure>

<blockquote>
<p>â€‹    ğŸ·   ysort åŸºäºèŠ‚ç‚¹ ==ä¸–ç•Œåæ ‡==  Y çš„ æ–¹å‘ï¼Œåœ¨ä¹‹å‰å…ˆè°ƒæ•´å¥½å„ä¸ªèŠ‚ç‚¹çš„ <code>Sprite</code> å’Œ <code>CollisionShape2D</code> çš„ä¸­å¿ƒä½ç½®è‡³ä¸–ç•Œåæ ‡ã€‚</p>
</blockquote>
<hr>
<h2 id="4animationplayer">4ï¼ŒAnimationPlayer</h2>
<p><code>å®˜æ–¹ä»‹ç»ï¼š</code> Container and player of Animation resources</p>
<figure style="margin:1rem 0.5rem"><a href="../../../img/../../../img/godot/action-rpg/animationplayer.png" title="animationplayer.png"><img src="../../../img/../../../img/godot/action-rpg/animationplayer.png" alt="animationplayer.png" width=""></a></figure>

<p>ç”¨äºè®¾ç½®æ¸¸æˆè§’è‰²çš„å„ç§åŠ¨ç”»ï¼Œ è¯´å¾—æ˜ç™½ç‚¹å°±æ˜¯è§’è‰²çš„ <!-- raw HTML omitted -->â¬†<!-- raw HTML omitted -->  <!-- raw HTML omitted -->â¬‡<!-- raw HTML omitted -->  <!-- raw HTML omitted -->â¬…<!-- raw HTML omitted -->  <!-- raw HTML omitted -->â¡<!-- raw HTML omitted -->  ä»¥åŠ  <!-- raw HTML omitted -->jump<!-- raw HTML omitted --> <!-- raw HTML omitted -->attach<!-- raw HTML omitted --> ç­‰å„ç§è§’è‰²ä¼šç”¨åˆ°çš„åŠ¨ç”»ã€‚å½“ç„¶ä¸æ­¢ä¸»è§’ä¼šç”¨åˆ°è¿™ä¸ªèŠ‚ç‚¹ï¼Œ<code>æ€ªç‰©</code> ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥èŠ‚ç‚¹ä½¿å¾—æ€ªç‰©ä¹Ÿæ›´åŠ ç”ŸåŠ¨ã€‚</p>
<blockquote>
<p><code>AnimationPlayer</code> æ˜¯ä¸€ä¸ªåŠŸèƒ½éå¸¸å¼ºå¤§çš„èŠ‚ç‚¹ï¼Œå®ƒå¯ä»¥ç»™åŒå±‚çº§çš„æ‰€æœ‰å­èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§è®¾ç½®å…³é”®å¸§</p>
</blockquote>
<hr>
<h2 id="5animationtree">5ï¼ŒAnimationTree</h2>
<p><code>å®˜æ–¹ä»‹ç»</code>ï¼š&hellip;&hellip;å¥½åƒæ²¡æœ‰</p>
<p>è¿™æ˜¯ä¸€ä¸ªç”¨äºæ··åˆä¸Šé¢ <code>AnimationPlayer</code> é‡Œçš„å„ç§åŠ¨ç”»ï¼Œé€šè¿‡ä¸€äº›ä»£ç å°†åŠ¨ç”»ç»‘å®šåœ¨å¯¹åº”çš„ <!-- raw HTML omitted -->kbd<!-- raw HTML omitted --> çš„èŠ‚ç‚¹ã€‚è¿™ä¸ªèŠ‚ç‚¹å¤§å¤§å‡å°‘äº†ä»£ç å·¥ä½œé‡ï¼Œä»¥å‰ä¸ºäº†åˆ¤æ–­è§’è‰²å½“å‰çš„çŠ¶æ€ï¼Œéœ€è¦å¤§é‡çš„ <code>if if if if if ......</code> è¯­å¥ï¼Œæ²¡å®Œæ²¡äº†ï¼Œä½¿ç”¨ <code>AnimationTree</code> èŠ‚ç‚¹åˆ™ä¼šå‡å°‘å¤§é‡çš„ä»£ç ï¼Œåœ¨è¿™å°±ä¸ä¸¾ä¾‹äº†ã€‚</p>
<h2 id="6background-grass--dirt-path-autotile">6ï¼ŒBackground Grass + Dirt Path Autotile</h2>
<h3 id="background-grass">background grass</h3>
<p>åˆ¶ä½œ <code>background</code> å¯ä»¥ä½¿ç”¨   ==Sprite==  æˆ–è€…  ==TextureRect==  èŠ‚ç‚¹ï¼Œä½†æ˜¯ TextureRect èŠ‚ç‚¹æ˜¯ <code>Ctrl</code> ç±»èŠ‚ç‚¹ï¼Œä¸æ¨èä½¿ç”¨ã€‚å¦‚æœæƒ³æŠŠ background ä½œä¸ºä¸€å— <code>tile</code> æ¥ä½¿ç”¨çš„è¯ï¼Œéœ€è¦æŠŠ <code>import</code> ç›®å½•ä¸‹çš„ <code>Repeat</code> è®¾ç½®ä¸º ==enable== æœ€å <code>Reimport</code> ä¸€ä¸‹ã€‚</p>
<blockquote>
<p>ä½¿ç”¨ <code>Sprite</code> èŠ‚ç‚¹è¦ç”¨åˆ°çš„å±æ€§æœ‰ <code>Region</code> ï¼Œåœ¨ output æ é‡Œåˆ‡æ¢è‡³ <code>Texture Region</code> åœ¨è¿™é‡Œå°±å¯ä»¥è°ƒæ•´ background çš„å¤§å°äº†ã€‚å¦‚æœå‹¾é€‰äº† Offset é‡Œçš„ <code>Centered</code> å±æ€§ï¼Œå°±è¦è°ƒæ•´ä¸€ä¸‹ <code>Transform</code> é‡Œçš„ position ä½ç½®äº†</p>
</blockquote>
<hr>
<h3 id="autotile">autotile</h3>
<p>æ²¡æ•´æ˜ç™½ï¼Œéœ€è¦ç ”ç©¶ç ”ç©¶æ€ä¹ˆä½¿ç”¨çš„</p>
<h2 id="7collision-with-autotiles">7ï¼ŒCollision with autotiles</h2>
<p><code>TileMap</code> èŠ‚ç‚¹é‡Œå¦‚æœé€‰æ‹©ä½¿ç”¨ autotileï¼Œä¼šæœ‰ä¸€ä¸ª <code>Collision</code> é¢æ¿ï¼Œç”¨äºç»˜åˆ¶ç¢°æ’æ£€æµ‹èŒƒå›´</p>
<figure style="margin:1rem 0.5rem"><a href="../../../img/../../../img/godot/action-rpg/autotile_collision.png" title="autotile_collision.png"><img src="../../../img/../../../img/godot/action-rpg/autotile_collision.png" alt="autotile_collision.png" width=""></a></figure>

<h2 id="8attack-animation--state-marhes">8ï¼ŒAttack Animation + State Marhes</h2>
<p>ä¸»è¦æ˜¯åœ¨ <code>AnimationPlayer</code> èŠ‚ç‚¹é‡Œæ·»åŠ äº†å››ä¸ªä¸åŒæ–¹å‘çš„ <code>attack</code> åŠ¨ç”»ï¼Œä½¿ç”¨æšä¸¾ <code>enum</code> æŠ½è±¡è§’è‰²çš„ä¸‰ä¸ªçŠ¶æ€( MOVE, ROLL, ATTACK )ï¼Œç”¨ <code>gdscript</code> é‡Œçš„ <code>match</code> æ–¹æ³•æ¥ caseã€‚</p>
<p><strong>state marhes code</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#75715e"># æšä¸¾çš„ä¸‰ä¸ªçŠ¶æ€ï¼ˆé»˜è®¤ä»0å¼€å§‹åŒ¹é…ï¼‰</span>
<span style="color:#66d9ef">enum</span> {
    MOVE,   <span style="color:#75715e"># -&gt; ç”¨0æŒ‡ä»£ MOVE</span>
    ROLL,   <span style="color:#75715e"># -&gt; ç”¨1æŒ‡ä»£ ROLL</span>
    ATTACK  <span style="color:#75715e"># -&gt; ç”¨2æŒ‡ä»£ ATTACK</span>
}

<span style="color:#75715e"># è®¾ç½®åˆå§‹/é»˜è®¤çŠ¶æ€</span>
<span style="color:#66d9ef">var</span> state <span style="color:#f92672">=</span> MOVE

<span style="color:#75715e"># process æ–¹æ³•</span>
<span style="color:#66d9ef">func</span> _physics_process(delta):
    match state:
        MOVE:
            move_state(delta)

        ROLL:
            <span style="color:#66d9ef">pass</span>

        ATTACK:
            attack_state(delta)

<span style="color:#75715e"># MOVE çŠ¶æ€çš„å‡½æ•°</span>
<span style="color:#66d9ef">func</span> move_state(delta):
    <span style="color:#66d9ef">var</span> input_vector <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
    input_vector<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_right&#34;</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_left&#34;</span>)
    input_vector<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_down&#34;</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_up&#34;</span>)
    input_vector<span style="color:#f92672">=</span> input_vector<span style="color:#f92672">.</span>normalized()

    <span style="color:#66d9ef">if</span> input_vector <span style="color:#f92672">!=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO:
        animationTree<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#34;parameters/Idle/blend_position&#34;</span>, input_vector)
        animationTree<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#34;parameters/Run/blend_position&#34;</span>, input_vector)
        animationTree<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#34;parameters/Attack/blend_position&#34;</span>, input_vector)
        animationState<span style="color:#f92672">.</span>travel(<span style="color:#e6db74">&#34;Run&#34;</span>)
        velocity <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>move_toward(input_vector <span style="color:#f92672">*</span> MAX_SPEED, ACCELERATION <span style="color:#f92672">*</span> delta)
    <span style="color:#66d9ef">else</span>:
        animationState<span style="color:#f92672">.</span>travel(<span style="color:#e6db74">&#34;Idle&#34;</span>)
        velocity <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>move_toward(<span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO, FRICTION) <span style="color:#75715e"># smooth stop animation</span>

    velocity <span style="color:#f92672">=</span> move_and_slide(velocity)

    <span style="color:#75715e"># ä» MOVE çŠ¶æ€ä¸­åˆ‡æ¢è‡³ ATTACK çŠ¶æ€</span>
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;Attack&#34;</span>):
        state <span style="color:#f92672">=</span> ATTACK

<span style="color:#75715e"># ATTACK çŠ¶æ€çš„å‡½æ•°</span>
<span style="color:#66d9ef">func</span> attack_state(delta):
    velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO  <span style="color:#75715e"># é¿å… MOVE çŠ¶æ€çš„åŠ¨ç”»åœ¨ ATTACK åŠ¨ç”»æ®‹ç•™</span>
    animationState<span style="color:#f92672">.</span>travel(<span style="color:#e6db74">&#34;Attack&#34;</span>)

<span style="color:#75715e"># ä¸€ä¸ªè¸©å‘ç‚¹ï¼Œattack åŠ¨ç”»ç»“æŸåï¼Œåº”ç«‹å³è°ƒæ•´ stateï¼Œä¸ç„¶è§’è‰²å°±å†»ç»“åœ¨ attack åŠ¨ç”»çš„æœ€åä¸€å¸§ä¸Š</span>
<span style="color:#75715e"># è¯¥å‡½æ•°æ·»åŠ åœ¨ AnimationPlayer èŠ‚ç‚¹ attack åŠ¨ç”»æœ€åä¸€å¸§ä¸Š(add track â†’ call method...)</span>
<span style="color:#66d9ef">func</span> attack_animation_finished():
    state <span style="color:#f92672">=</span> MOVE
</code></pre></td></tr></table>
</div>
</div><h2 id="9signals--instancing-scenes-in-code">9ï¼ŒSignals + Instancing Scenes in Code</h2>
<h3 id="_process-å’Œ--physics_process-çš„æ¯”è¾ƒ"><code>_process</code> å’Œ <code>-physics_process</code> çš„æ¯”è¾ƒ</h3>
<h4 id="ç›¸åŒ">ç›¸åŒ</h4>
<p>Called during the processing step of the main loopã€‚</p>
<h4 id="ä¸åŒ">ä¸åŒ</h4>
<p><code>_process</code>  Processing happens at every frame and as fast as possibleï¼Œæ‰€ä»¥ <code>delta</code>  çš„å€¼ä¸æ’å®šã€‚</p>
<p><code>-physics_process</code>  Physics processing means that the frame rate is synced to the physicsï¼Œæ‰€ä»¥ <code>delta</code> å€¼åº”è¯¥æ˜¯æ’å®šçš„ã€‚</p>
<h3 id="animationsprite-å’Œ-animationplayer"><code>AnimationSprite</code> å’Œ <code>AnimationPlayer</code></h3>
<p><code>AnimationSprite</code> é€‚ç”¨äºåˆ¶ä½œç®€å•åŠ¨ç”»çš„èŠ‚ç‚¹ï¼Œä¸éœ€è¦ blend åŠ¨ç”»ï¼Œè¿™é‡Œåˆ›å»ºå°è‰æ¶ˆå¤±çš„åŠ¨ç”»å°±ç”¨çš„ AnimationSpriteã€‚</p>
<p><code>AnimationPlayer</code> é€‚ç”¨äºåˆ›å»ºå¤æ‚åŠ¨ç”»çš„èŠ‚ç‚¹ï¼Œéœ€è¦ blend åŠ¨ç”»ï¼Œè¿™é‡Œä¸ºäº†ä¾¿äºå®ç°è§’è‰²çš„ç§»åŠ¨ã€æ”»å‡»ã€ç¿»æ»šåŠ¨ç”»ä¹‹é—´çš„æ§åˆ¶å’Œåˆ‡æ¢ï¼Œå°±ä¸€èµ·ä½¿ç”¨äº† <code>AnimationPlayer</code> <code>AnimationTree</code> ä¸¤ä¸ªèŠ‚ç‚¹ã€‚</p>
<h3 id="signals">Signals</h3>
<figure style="margin:1rem 0.5rem"><a href="../../../img/../../../img/godot/action-rpg/signal.png" title="signal.png"><img src="../../../img/../../../img/godot/action-rpg/signal.png" alt="signal.png" width=""></a></figure>

<p>å¦‚å›¾ä¸€ä¸ª signal çš„å®ä¾‹ï¼Œå­èŠ‚ç‚¹ Animated Sprite å‘å‡ºä¸€ä¸ª signal ç»™ GrassEffect çˆ¶èŠ‚ç‚¹ã€‚signal çš„æ„æ€å°±ç›¸å½“äºä½ å‘Šè¯‰ä½ çš„æœ‹å‹ä»¬ä½ æ‹çˆ±äº†ï¼Œå¯¹è±¡æ˜¯è°è°è°ã€‚Source å°±æ˜¯ä½ ï¼Œä½ å‘å‡º signal â€”â€”ä½ æ‰¾å¯¹è±¡äº†ï¼Œå¯¹è±¡æ˜¯è°ï¼ŒTarget å°±æ˜¯ä½ çš„æœ‹å‹ä»¬ï¼Œæœ‹å‹ä»¬çŸ¥é“ä½ æ‹çˆ±äº†ï¼Œå¯¹è±¡æ˜¯è°ã€‚</p>
<h3 id="instancing-scenes-in-code">Instancing Scenes in Code</h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#75715e"># è¿™é‡Œæ˜¯ä¸ºäº†å®ä¾‹åŒ– GrassEffectã€‚å½“è§’è‰² Attack Grass æ—¶ï¼Œç»™ Grass æ·»åŠ ä¸€ä¸ªæ¶ˆå¤±çš„åŠ¨ç”»ã€‚</span>
<span style="color:#75715e"># å› ä¸º GrassEffect.tscn ä¸èƒ½åƒ Grass.tscn ç›´æ¥æ‹–æ‹½è¿›æ¸¸æˆè¿è¡Œçš„åœºæ™¯é‡Œï¼Œä¸ç„¶æ¸¸æˆè¿è¡Œçš„åœºæ™¯å°±ä¸€ç›´æ’­æ”¾ GrassEffect.tscn è‰æ¶ˆå¤±çš„æ•ˆæœï¼Œæ‰€ä»¥åªèƒ½åœ¨ä»£ç é‡Œè¿›è¡Œå®ä¾‹åŒ– GrassEffectã€‚</span>

<span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>

<span style="color:#66d9ef">func</span> _process(delta):
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;Attack&#34;</span>):
        <span style="color:#66d9ef">var</span> GrassEffect <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#34;res://Effects/GrassEffect.tscn&#34;</span>) <span style="color:#75715e"># è½½å…¥éœ€è¦å®ä¾‹åŒ–çš„ scene</span>
        <span style="color:#66d9ef">var</span> grassEffect <span style="color:#f92672">=</span> GrassEffect<span style="color:#f92672">.</span>instance() <span style="color:#75715e"># å®ä¾‹åŒ– sceneï¼Œæ­¤æ—¶æœªè½½å…¥æ¸¸æˆåœºæ™¯é‡Œ</span>
        <span style="color:#66d9ef">var</span> world <span style="color:#f92672">=</span> get_tree()<span style="color:#f92672">.</span>current_scene     <span style="color:#75715e"># è·å–å½“å‰ scene çš„æ ¹èŠ‚ç‚¹</span>
        world<span style="color:#f92672">.</span>add_child(grassEffect)             <span style="color:#75715e"># å½“å‰æ¸¸æˆåœºæ™¯é‡Œæ·»åŠ è¦å®ä¾‹åŒ–çš„ scene</span>

        <span style="color:#75715e"># ä»¥ä¸Š4è¡Œä»£ç å°±å®Œæˆäº† scene çš„å®ä¾‹åŒ–ï¼Œä½ åº”è¯¥å­¦åˆ°æ˜¯åœ¨ä»»ä½•å•ç‹¬çš„ *.tscn æ–‡ä»¶é‡Œï¼Œå®ä¾‹åŒ–ä»»ä½•åœ°æ–¹ scene</span>

        <span style="color:#75715e"># å°†è‰æ¶ˆå¤±åŠ¨ç”»çš„ä½ç½®æ”¾åœ¨æ¯ä¸€ä¸ªå®ä¾‹åŒ–åçš„ Grass.tscn ä½ç½®ä¸Šï¼Œglobal_position çš„å€¼å°±æ˜¯å½“å‰ scene çš„ä½ç½®</span>
        grassEffect<span style="color:#f92672">.</span>global_position <span style="color:#f92672">=</span> global_position
        queue_free()

</code></pre></td></tr></table>
</div>
</div><h2 id="10melee-attacks-with-hurtboxes-and-hitboxes">10ï¼ŒMelee Attacks with Hurtboxes and Hitboxes</h2>
<h3 id="æ€è·¯">æ€è·¯ï¼š</h3>
<ol>
<li>
<p>ä¸ºæ¯ä¸€ä¸ªéœ€è¦ç¢°æ’æ£€æµ‹çš„ scene æ·»åŠ ä¸€ä¸ªåŸºäº <code>CollisionShape2D</code> çš„ <code>Area2D</code> èŠ‚ç‚¹ï¼Œå› ä¸ºè¯¥èŠ‚ç‚¹å¯ä»¥å‘å‡ºè¢«ç¢°æ’çš„ <code>signal</code>ï¼Œä¹Ÿæœ‰å¾ˆå¤šå…¶ä»–æœ‰ç”¨çš„ signalsã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ <code>AnimationPlayer</code> ä¸ºç¢°æ’æ£€æµ‹çš„ <code>CollisionShape2D</code> èŠ‚ç‚¹è®¾ç½®å…³é”®å¸§ï¼Œæ§åˆ¶å…¶ <code>Disabled</code> å’Œ <code>Enable</code> ã€‚ä»¥è¾¾åˆ°ä½¿ç”¨ <code>Attack</code> æ—¶ï¼Œè¿›è¡Œç¢°æ’æ£€æµ‹ï¼Œç§»åŠ¨æ—¶ï¼Œå°± disableï¼Œä¸æ£€æµ‹ã€‚</p>
</li>
</ol>
<blockquote>
<p>è¡¥å……ï¼šä¸ºäº†æ›´æ–¹ä¾¿çš„æ§åˆ¶ Player çš„ Hitboxï¼Œå°† Position2D èŠ‚ç‚¹ä½œä¸ºå…¶çˆ¶èŠ‚ç‚¹ã€‚Positon2D å»ºç«‹äº†ä¸€ä¸ªç‹¬ç«‹çš„åæ ‡ç³»ç»Ÿï¼Œä»¥ Position2D èŠ‚ç‚¹çš„ä½ç½®ä½œä¸ºå­èŠ‚ç‚¹çš„ä¸–ç•ŒåŸç‚¹ã€‚</p>
</blockquote>
<hr>
<h3 id="æ–°é—®é¢˜">æ–°é—®é¢˜</h3>
<p>ç”±äº <code>Area2D</code> è¢«ç¢°æ’å°±ä¼šå‘å‡º signal ï¼Œæ‰§è¡Œå¯¹åº”æ–¹æ³•çš„ç‰¹æ®Šæ€§ã€‚å½“ä¸¤å—è‰åœ°ç´§æŒ¨åœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œä»–ä»¬å°±ä¼šä¸€èµ·æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼Œè‰åœ°ä¼šä¸€èµ·æ¶ˆå¤±ï¼Œè¿™å¯èƒ½ä¼šä½¿æ¸¸æˆå‡ºç°ä¸€äº› BUGã€‚è¯´å¾—æ›´å®¹æ˜“ç†è§£ä¸€ç‚¹å°±æ˜¯ï¼Œå¦‚æœæ˜¯åœ¨é£æœºå¤§æˆ˜ä¹‹ç±»çš„æ¸¸æˆé‡Œçš„è¯ï¼Œå‹å†›ç›¸äº’ç¢°æ’çš„è¯ï¼Œå°±ä¼šå‡ºç°æ”»å‡» å‹å†› çš„è¡Œä¸ºã€‚</p>
<h3 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h3>
<p>åœ¨ <code>é¡¹ç›®è®¾ç½®</code> é‡Œï¼Œè®¾ç½®å¯¹åº”çš„ <code>Layer Names</code> ï¼Œè¿™åˆæ˜¯ä¸€å¥—ç”¨äºç¢°æ’æ£€æµ‹çš„ç³»ç»Ÿï¼Œä½ å¯èƒ½ä¼šå¾ˆç–‘æƒ‘äº†ã€‚åœ¨æ¯ä¸€ä¸ªå¯ä»¥è®¾ç½® <code>Collision</code> å±æ€§çš„èŠ‚ç‚¹é‡Œï¼Œå¯ä»¥è®¾ç½®è¯¥èŠ‚ç‚¹çš„ <code>Layer</code> <code>Mask</code> ï¼Œå®ƒä»¬çš„å€¼å…¨æ¥æºä½ åœ¨é¡¹ç›®è®¾ç½®é‡Œé¢è®¾ç½®çš„å„ä¸ª Layers çš„åå­—ï¼ŒLayer çš„å€¼æ˜¯è¯¥èŠ‚ç‚¹è‡ªèº«æ‰€å¤„çš„ Layerï¼ŒMask çš„å€¼æ˜¯è¯¥èŠ‚ç‚¹å¯»æ‰¾çš„ Layerã€‚</p>
<h3 id="æ–°çš„æ¢è®¨">æ–°çš„æ¢è®¨</h3>
<p><code>Bush</code> <code>Grass</code> ä¸¤ä¸ª scene éƒ½ç”¨åˆ°äº†ç¢°æ’æ£€æµ‹ï¼Œä¸ºä»€ä¹ˆè§’è‰²å¯ä»¥ä» Grass ä¸Šç©¿è¿‡ï¼Œå´ä¸èƒ½ä» Bush ä¸Šç©¿è¿‡ï¼Ÿ</p>
<h3 id="è§£">è§£</h3>
<p>Bush èŠ‚ç‚¹çš„æ ¹èŠ‚ç‚¹æ˜¯ <code>StaticBody2D</code> èŠ‚ç‚¹ï¼Œè€Œ Grass èŠ‚ç‚¹çš„æ ¹èŠ‚ç‚¹æ˜¯ <code>Node2D</code> èŠ‚ç‚¹ã€‚ <code>StaticBody2D</code> èŠ‚ç‚¹æ˜¯è‡ªå¸¦æœ‰ Collision ç‰©ç†å±æ€§çš„ï¼Œè€Œ <code>Grass</code> èŠ‚ç‚¹æ˜¯æ²¡æœ‰çš„ã€‚è€Œä¸”åœ¨ä½¿ç”¨ StaticBody2D èŠ‚ç‚¹æ—¶ï¼Œæ·»åŠ ç¢°æ’æ£€æµ‹èŠ‚ç‚¹ (å¯ä»¥æ˜¯ <code>CollisionShape2D</code>) æ˜¯å¿…è¦çš„ã€‚æ‰€ä»¥å¦‚æœåœ¨æ–°å»ºçš„åœºæ™¯é‡Œç›´æ¥æ·»åŠ ç¢°æ’æ£€æµ‹èŠ‚ç‚¹çš„ï¼Œè§’è‰²éƒ½ä¼šä¸ä¹‹ç¢°æ’è€Œä¸æ˜¯ç©¿è¿‡ã€‚</p>
<h2 id="11roll-state">11ï¼ŒRoll State</h2>
<ol>
<li>å’Œä¹‹å‰æ·»åŠ  <code>Idle</code> <code>Attack</code> <code>Run</code> åŠ¨ç”»ä¸€æ ·ï¼Œåˆ†åˆ«æ·»åŠ å››ä¸ªæ–¹å‘ä¸Šçš„ <code>Roll</code> åŠ¨ç”»ã€‚</li>
<li>åœ¨ <code>AnimationTree</code> æ–°å»ºä¸€ä¸ª <code>Add BlendSpace2D</code> èŠ‚ç‚¹ï¼Œæ·»åŠ  transitionï¼Œç¼–è¾‘è¿™ä¸ªèŠ‚ç‚¹ã€‚</li>
<li>æ·»åŠ ä»£ç æ§åˆ¶è§’è‰²ã€‚</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span></span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>

<span style="color:#66d9ef">const</span> ACCELERATION <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>
<span style="color:#66d9ef">const</span> MAX_SPEED <span style="color:#f92672">=</span> <span style="color:#ae81ff">90</span>
<span style="color:#66d9ef">const</span> FRICTION <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>
<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#66d9ef">const</span> ROLL_SPEED <span style="color:#f92672">=</span> <span style="color:#ae81ff">120</span>
</span>
<span style="color:#66d9ef">enum</span> {
    MOVE,
    ROLL,
    ATTACK
}

<span style="color:#66d9ef">var</span> state <span style="color:#f92672">=</span> MOVE
<span style="color:#66d9ef">var</span> velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#66d9ef">var</span> roll_vector <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>DOWN
</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> animationPlayer <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimationPlayer</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> animationTree <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>AnimationTree
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> animationState <span style="color:#f92672">=</span> animationTree<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;parameters/playback&#34;</span>)

<span style="color:#66d9ef">func</span> _ready():
    animationTree<span style="color:#f92672">.</span>active <span style="color:#f92672">=</span> true

<span style="color:#66d9ef">func</span> _physics_process(delta):
    match state:
        MOVE:
            move_state(delta)

<span style="display:block;width:100%;background-color:#3c3d38">        ROLL:
</span><span style="display:block;width:100%;background-color:#3c3d38">            roll_state(delta)
</span>
        ATTACK:
            attack_state(delta)

<span style="color:#66d9ef">func</span> move_state(delta):
    <span style="color:#66d9ef">var</span> input_vector <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
    input_vector<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_right&#34;</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_left&#34;</span>)
    input_vector<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_down&#34;</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>get_action_strength(<span style="color:#e6db74">&#34;ui_up&#34;</span>)
    input_vector<span style="color:#f92672">=</span> input_vector<span style="color:#f92672">.</span>normalized() <span style="color:#75715e"># keep the same speed move 45 degree</span>

    <span style="color:#66d9ef">if</span> input_vector <span style="color:#f92672">!=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO:
<span style="display:block;width:100%;background-color:#3c3d38">        roll_vector <span style="color:#f92672">=</span> input_vector
</span>        animationTree<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#34;parameters/Idle/blend_position&#34;</span>, input_vector)
        animationTree<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#34;parameters/Run/blend_position&#34;</span>, input_vector)
        animationTree<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#34;parameters/Attack/blend_position&#34;</span>, input_vector)
        animationTree<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#34;parameters/Roll/blend_position&#34;</span>, input_vector)
        animationState<span style="color:#f92672">.</span>travel(<span style="color:#e6db74">&#34;Run&#34;</span>)
        velocity <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>move_toward(input_vector <span style="color:#f92672">*</span> MAX_SPEED, ACCELERATION <span style="color:#f92672">*</span> delta)
    <span style="color:#66d9ef">else</span>:
        animationState<span style="color:#f92672">.</span>travel(<span style="color:#e6db74">&#34;Idle&#34;</span>)
        velocity <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>move_toward(<span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO, FRICTION) <span style="color:#75715e"># smooth stop animation</span>

<span style="display:block;width:100%;background-color:#3c3d38">    move()
</span>
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;roll&#34;</span>):
        state <span style="color:#f92672">=</span> ROLL

    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;Attack&#34;</span>):
        state <span style="color:#f92672">=</span> ATTACK

<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#66d9ef">func</span> move():
</span><span style="display:block;width:100%;background-color:#3c3d38">    velocity <span style="color:#f92672">=</span> move_and_slide(velocity)
</span>
<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#66d9ef">func</span> roll_state(delta):
</span><span style="display:block;width:100%;background-color:#3c3d38">    velocity <span style="color:#f92672">=</span> roll_vector <span style="color:#f92672">*</span> ROLL_SPEED
</span><span style="display:block;width:100%;background-color:#3c3d38">    animationState<span style="color:#f92672">.</span>travel(<span style="color:#e6db74">&#34;Roll&#34;</span>)
</span><span style="display:block;width:100%;background-color:#3c3d38">    move()
</span>
<span style="color:#66d9ef">func</span> attack_state(delta):
    velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
    animationState<span style="color:#f92672">.</span>travel(<span style="color:#e6db74">&#34;Attack&#34;</span>)

<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#66d9ef">func</span> roll_animation_finished():
</span><span style="display:block;width:100%;background-color:#3c3d38">    velocity <span style="color:#f92672">=</span> velocity <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.8</span>
</span><span style="display:block;width:100%;background-color:#3c3d38">    state <span style="color:#f92672">=</span> MOVE
</span>
<span style="color:#66d9ef">func</span> attack_animation_finished():
    state <span style="color:#f92672">=</span> MOVE

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Roll è¿˜æ˜¯ç¨å¾®ä¸åŒäº Attack åŠ¨ç”»çš„ï¼Œroll å’Œ move ç±»ä¼¼ï¼Œéœ€è¦ä¸€ä¸ª Vector2 å‘é‡å­˜å‚¨å‘é‡åæ ‡</p>
</blockquote>
<hr>
<h2 id="12knockback--enemy-bat">12ï¼ŒKnockback + Enemy Bat</h2>
<p>ä¸»è¦æ˜¯ä¸º <code>Bat</code> æ·»åŠ ä¸€ä¸ªå‡»é€€æ•ˆæœï¼Œè§’è‰²æœé‚£ä¸ªæ–¹å‘å‰è¿›ï¼Œbat å°±å¾€å“ªä¸ªæ–¹å‘åé€€ã€‚å›°æƒ‘çš„åœ°æ–¹å¯èƒ½å°±æ˜¯ Bat èŠ‚ç‚¹å’Œ bat å­èŠ‚ç‚¹ Hurtbox collision å±æ€§çš„ Layerï¼ŒMask çš„è®¾ç½®ï¼Œä»¥åŠ Player å­èŠ‚ç‚¹ Hitbox collison å±æ€§çš„ Layerï¼ŒMask çš„è®¾ç½®äº†ã€‚</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="center">Layer</th>
<th align="center">Mask</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Bat</td>
<td align="center">Enemy</td>
<td align="center">World</td>
</tr>
<tr>
<td align="left">Bat  -&gt;  Hurtbox</td>
<td align="center">EnemyHurtbox</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">Player</td>
<td align="center">Player</td>
<td align="center">World</td>
</tr>
<tr>
<td align="left">Player  -&gt;  Hitbox</td>
<td align="center"></td>
<td align="center">EnemyHurtbox</td>
</tr>
</tbody>
</table>
<p><strong>Bat.gd</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>

<span style="color:#66d9ef">var</span> knockback <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO

<span style="color:#66d9ef">func</span> _physics_process(delta):
    knockback <span style="color:#f92672">=</span> knockback<span style="color:#f92672">.</span>move_toward(<span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO, <span style="color:#ae81ff">200</span> <span style="color:#f92672">*</span> delta)
    knockback <span style="color:#f92672">=</span> move_and_slide(knockback)

<span style="color:#66d9ef">func</span> _on_Hurtbox_area_entered(area):
    <span style="color:#75715e"># area è¿™é‡ŒæŒ‡çš„æ˜¯ Player èŠ‚ç‚¹ä¸‹çš„ Hitboxï¼Œæ‰€ä»¥è¿˜è¦å† Hitbox.gd æ·»åŠ  knockback_vector å˜é‡</span>
    knockback <span style="color:#f92672">=</span> area<span style="color:#f92672">.</span>knockback_vector <span style="color:#f92672">*</span> <span style="color:#ae81ff">140</span>

</code></pre></td></tr></table>
</div>
</div><p><strong>Hitbox.gd</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Area2D</span>

<span style="color:#66d9ef">var</span> knockback_vector <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO

<span style="color:#75715e"># é™¤æ­¤ä¹‹å¤–è¿˜è¦å† Player.gd å®Œæˆ knockback_vector çš„åˆå§‹åŒ–è®¾ç½®ï¼ŒåŠèµ‹å€¼</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Player.gd</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#75715e"># å°†SwordHitbox è½½å…¥ swordHitbox å˜é‡ä¸­</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> swordHitbox <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>HitboxPivot<span style="color:#f92672">/</span>SwordHitbox

<span style="color:#66d9ef">func</span> _ready():
    <span style="color:#f92672">...</span>
    <span style="color:#75715e"># è®¾ç½®ä¸€å¼€å§‹ Bat knockback çš„åˆå§‹å€¼ï¼Œç©å®¶ä¸€å¼€å§‹çš„æœå‘</span>
    swordHitbox<span style="color:#f92672">.</span>knockback_vector <span style="color:#f92672">=</span> roll_vector

<span style="color:#66d9ef">func</span> move_state(delta):
    <span style="color:#f92672">...</span>
    <span style="color:#66d9ef">if</span> input_vector <span style="color:#f92672">!=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO:
        roll_vector <span style="color:#f92672">=</span> input_vector
        <span style="color:#75715e"># å®Œæˆ knockback_vector çš„èµ‹å€¼</span>
        swordHitbox<span style="color:#f92672">.</span>knockback_vector <span style="color:#f92672">=</span> input_vector
        <span style="color:#f92672">...</span>
    <span style="color:#f92672">...</span>

<span style="color:#f92672">...</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="13enemy-stats--export-variables--setget">13ï¼ŒEnemy Stats + Export Variables + Setget</h2>
<p><strong>è®¾ç½® stats</strong></p>
<p>ä½¿ç”¨ Node èŠ‚ç‚¹ï¼Œç»‘å®š gdscript è„šæœ¬ï¼ŒNode èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ²¡æœ‰ä¸–ç•Œåæ ‡çš„ç‰¹æ®ŠèŠ‚ç‚¹ã€‚Enemy Stats è®¾ç½® Enemy ç”Ÿå‘½å€¼ä¸€ç±»çš„å‚æ•°ï¼Œè¿™ç±»èŠ‚ç‚¹æœ¬èº«æ˜¯ä¸éœ€è¦ä»€ä¹ˆ Sprite ï¼ŒArea2D èŠ‚ç‚¹ï¼Œå¾ˆé€‚åˆç”¨äºå­˜å‚¨å„ç±»æ•°å€¼å‚æ•°ã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node</span>

<span style="color:#66d9ef">export</span> (<span style="color:#a6e22e">int</span>) <span style="color:#66d9ef">var</span> max_health <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> health <span style="color:#f92672">=</span> max_health <span style="color:#66d9ef">setget</span> set_health

<span style="color:#66d9ef">signal</span> no_health

<span style="color:#66d9ef">func</span> set_health(value):
    health <span style="color:#f92672">=</span> value
    <span style="color:#66d9ef">if</span> health <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
        emit_signal(<span style="color:#e6db74">&#34;no_health&#34;</span>)

</code></pre></td></tr></table>
</div>
</div><p>**Export **</p>
<p>ä¸Šé¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>Export</code> å‚æ•°ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨æ£€è§†é¢æ¿é‡Œè°ƒæ•´å‚æ•°æ•°å€¼ã€‚ä½¿ç”¨ Export è¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œåœ¨å®ä¾‹åŒ–èŠ‚ç‚¹åï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºåŒä¸€ä¸ªå‚æ•°è®¾ç½®ä¸åŒçš„å€¼ã€‚ä¾‹å¦‚ï¼šåŒæ ·æ˜¯ max_healthï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ£€è§†é¢æ¿é‡Œå°† Bat çš„æœ€å¤§å€¼è®¾ç½®ä¸º 3ï¼ŒGrass çš„æœ€å¤§å€¼è®¾ç½®ä¸º 1ï¼ŒçœŸçš„éå¸¸æ–¹ä¾¿ã€‚åœ¨å®ä¾‹åŒ–åï¼Œä¸ºäº†ç¡®ä¿æˆ‘ä»¬è®¾ç½®çš„ max_health æœ€å¤§å€¼ä¸ºæ£€è§†é‡Œçš„å€¼ï¼Œå†™ <code>var health = max_health</code> æ˜¯ä¸è¡Œçš„ï¼Œå®ƒè¯»å–çš„æ˜¯ stats è„šæœ¬é‡Œ max_health çš„å€¼ï¼Œæˆ‘ä»¬éœ€è¦è¿™æ ·å†™ <code>onready var health = max_health</code> è¿™æ · max_health è¯»å–çš„æ˜¯æˆ‘ä»¬åœ¨æ£€è§†é¢æ¿é‡Œè®¾ç½®çš„å€¼ã€‚</p>
<p><strong>Setget</strong></p>
<p>è¿™é‡Œåªæ˜¯ç”¨äº† set æ–¹æ³•ï¼Œæ²¡æœ‰ä½¿ç”¨ get æ–¹æ³•ã€‚ä¸Šé¢ setget çš„æ„æ€æ˜¯ï¼Œæ¯ä¸€æ¬¡ health å€¼çš„æ”¹åŠ¨ï¼Œéƒ½è¦è°ƒç”¨ set_health æ–¹æ³•ã€‚è¿™æ ·åšå°±ä¸ç”¨åœ¨æ¯ä¸€å¸§é‡Œæ£€æŸ¥ health å€¼æ˜¯å¦ä¸º 0ã€‚</p>
<p><strong>ç»§æ‰¿ç‰¹å®šscript</strong></p>
<p>åœ¨ <code>extend</code> åé¢åŠ ä¸Šè¦ç»§æ‰¿çš„ gdscript é“¾æ¥</p>
<h2 id="14enemy-death-effect--bug-fix">14ï¼ŒEnemy Death Effect + Bug Fix</h2>
<h3 id="bug">Bug</h3>
<p>è§’è‰²ä¸€å¼€å§‹çš„ä½ç½®è®¾ç½®å’Œ roll çš„åˆå§‹æ–¹å‘ä¹‹é—´è¿™ä¸¤è€…æœ‰ä¸€ä¸ª bugï¼Œä¹‹é—´åœ¨åœ¨æ£€è§†é¢æ¿é‡Œè®¾ç½®æ‰€æœ‰åŠ¨ä½œçš„åˆå§‹å€¼</p>
<table>
<thead>
<tr>
<th></th>
<th align="center">x</th>
<th align="center">y</th>
</tr>
</thead>
<tbody>
<tr>
<td>Attack</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr>
<td>Idle</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr>
<td>Roll</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr>
<td>Run</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>ç»“æœ</p>
<figure style="margin:1rem 0.5rem"><a href="../../../img/../../../img/godot/action-rpg/default_position.png" title="default_position.png"><img src="../../../img/../../../img/godot/action-rpg/default_position.png" alt="default_position.png" width=""></a></figure>

<p>é™¤æ­¤ä¹‹å¤–è¿˜è¦è®¾ç½® <code>var roll_vector = Vector2.DOWN</code> ï¼Œè¿™æ ·å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜</p>
<h3 id="death-effect">death effect</h3>
<p>æ”¹é€  <code>Effect.gd</code> è„šæœ¬æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘éƒ½æ˜¯é‡‡ç”¨åŒä¸€ç§æ–¹å¼æ¥å®ç° Grass æ¶ˆå¤±ï¼ŒBat æ¶ˆå¤±çš„æ•ˆæœâ€”â€”æŠŠ  PNG æ–‡ä»¶æ‹†åˆ†æˆå„ä¸ªå°å—ç”¨ä½œ Frameï¼Œéœ€è¦ä½¿ç”¨æ—¶ï¼Œç›´æ¥æ’­æ”¾æ¶ˆå¤±åŠ¨ç”»ã€‚æ‰€ä»¥ <code>Effect.gd</code> æ–‡ä»¶å…·æœ‰ä¸€å®šçš„æ³›ç”¨æ€§ã€‚</p>
<p><strong>Code</strong></p>
<p><strong>before</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> animatedSprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>

<span style="color:#66d9ef">func</span> _ready():
    animatedSprite<span style="color:#f92672">.</span>frame <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    animatedSprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;Animate&#34;</span>)

<span style="color:#66d9ef">func</span> _on_AnimatedSprite_animation_finished():
    queue_free()

</code></pre></td></tr></table>
</div>
</div><p><strong>after</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">AnimatedSprite</span>
</span>
<span style="color:#66d9ef">func</span> _ready():
<span style="display:block;width:100%;background-color:#3c3d38">    connect(<span style="color:#e6db74">&#34;animation_finished&#34;</span>, self, <span style="color:#e6db74">&#34;_on_animation_finished&#34;</span>)
</span>    frame <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    play(<span style="color:#e6db74">&#34;Animate&#34;</span>)

<span style="color:#66d9ef">func</span> _on_animation_finished():
    queue_free()

</code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œæœ‰åº”è¯¥å­¦ä¼šå¦‚ä½•åœ¨ä»£ç é‡Œé“¾æ¥ <code>signal</code> ï¼Œé€šè¿‡ <code>connect</code> æ–¹æ³•æ¥å®ç°ã€‚éœ€è¦æ‰‹åŠ¨é“¾æ¥ signal çš„æƒ…å†µç›®å‰åªæœ‰åœ¨æ³›ç”¨æ€§è„šæœ¬é‡Œéœ€è¦ç”¨åˆ°ã€‚</p>
<p><strong>Bat.gd</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>

<span style="color:#66d9ef">const</span> EnemyDeathEffect <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://Effects/EnemyDeathEffect.tscn&#34;</span>)

<span style="color:#66d9ef">var</span> knockback <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> stats <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Stats

<span style="color:#66d9ef">func</span> _physics_process(delta):
    knockback <span style="color:#f92672">=</span> knockback<span style="color:#f92672">.</span>move_toward(<span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO, <span style="color:#ae81ff">200</span> <span style="color:#f92672">*</span> delta)
    knockback <span style="color:#f92672">=</span> move_and_slide(knockback)

<span style="color:#66d9ef">func</span> _on_Hurtbox_area_entered(area):
    stats<span style="color:#f92672">.</span>health <span style="color:#f92672">-=</span> area<span style="color:#f92672">.</span>damage
    knockback <span style="color:#f92672">=</span> area<span style="color:#f92672">.</span>knockback_vector <span style="color:#f92672">*</span> <span style="color:#ae81ff">130</span>

<span style="color:#66d9ef">func</span> _on_Stats_no_health():
    queue_free()
    <span style="color:#66d9ef">var</span> enemyDeathEffect <span style="color:#f92672">=</span> EnemyDeathEffect<span style="color:#f92672">.</span>instance()
    get_parent()<span style="color:#f92672">.</span>add_child(enemyDeathEffect)
    enemyDeathEffect<span style="color:#f92672">.</span>global_position <span style="color:#f92672">=</span> global_position

</code></pre></td></tr></table>
</div>
</div><h2 id="15bat-ai-start">15ï¼ŒBat AI Start</h2>
<h3 id="hit-animate">hit animate</h3>
<p>åˆ›å»ºä¸€ä¸ª HitEffect.tscn æ–‡ä»¶ï¼Œè¿˜æ˜¯ä½¿ç”¨ <code>AnimatedSprite</code> èŠ‚ç‚¹ï¼Œå› ä¸ºåªæ˜¯æ’­æ”¾ä¸€ä¸ªç®€å•çš„åŠ¨ç”»æ•ˆæœã€‚ç»™å®ƒç»‘å®šæ˜¨å¤©å†™çš„ Effect.gd è„šæœ¬ã€‚æ¥ç€ä¸º Hurtbox æ·»åŠ ä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºå®ä¾‹åŒ– HitEffect.tscnã€‚ä¸ºä»€ä¹ˆè¦å•ç‹¬åˆ›å»º Hurtbox.tscnï¼Ÿè¿™é‡Œå°±æ˜¯ä¸€ä¸ªåŸå› äº†ï¼ŒEffect.gd è„šæœ¬é»˜è®¤æ’­æ”¾åœºæ™¯çš„åŠ¨ç”»ï¼Œå®ƒå¹¶ä¸å†³å®šæ’­è¿˜æ˜¯ä¸æ’­ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªæƒ³å°† hit animate ç”¨äº player æ”»å‡» batï¼Œä¸æƒ³åœ¨ attack grass æ—¶ä¹Ÿæ’­æ”¾è¯¥åŠ¨ç”»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Hurtbox.gd é‡Œåˆ›å»ºä¸€ä¸ªå¯ä»¥ export çš„ bool å˜é‡æ¥å†³å®šæ˜¯å¦æ’­æ”¾ hit animateã€‚export çš„ä¼˜ç‚¹ä¸Šé¢å·²ç»è°ˆè¿‡äº†ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p>
<h3 id="ai-start">AI start</h3>
<p>è¿™é‡Œçš„ AI å¹¶ä¸é‚£ä¹ˆ AIï¼Œbat çš„åˆ›å»ºå…¶å®æ˜¯å’Œåˆ›å»º player ä¸€æ ·å¤æ‚çš„ï¼Œå› ä¸º bat ä¹Ÿä¼š IDLEï¼ŒCHASEï¼ŒWANDER æœ‰ä¸‰ç§çŠ¶æ€ï¼Œåªè¦æ˜¯ä¼šè¿åŠ¨çš„å¯¹è±¡ï¼Œå…¶å®ç°éƒ½æ˜¯è¾ƒä¸ºå¤æ‚çš„ã€‚</p>
<p>è¿™é‡Œç®€å•çš„æ€è·¯å°±æ˜¯ï¼Œä¸º bat æ·»åŠ ä¸€ä¸ªä¾¦å¯ŸåŒºåŸŸï¼Œå½“ player è¿›å…¥ä¾¦å¯ŸåŒºåŸŸæ—¶ï¼Œbat å°±ä¼šè¿½èµ¶ playerï¼›å½“ player ç¦»å¼€ä¾¦å¯ŸåŒºåŸŸæ—¶ï¼Œbat å°±åœæ­¢è¿åŠ¨ã€‚ä¸ç†è§£çš„è¯ï¼Œæƒ³æƒ³å´©å3rdé‡Œï¼Œåœ¨æ‰§è¡Œåˆºæ€ä»»åŠ¡æ—¶ï¼Œå¯¹è±¡ä¼šæœ‰ä¸€ä¸ªçº¢è‰²çº¿æ¡†çš„ä¸‰è§’é”¥åŒºåŸŸï¼Œè¿›å…¥ä¸‰è§’é”¥å°±ä¼šè¢«å¯¹è±¡å‘ç°ï¼Œä»»åŠ¡å¤±è´¥ã€‚è¯´èµ·æ¥ç®€å•ï¼Œå®ç°èµ·æ¥è¾ƒä¸ºå¤æ‚ã€‚</p>
<h4 id="åˆ›å»ºä¾¦å¯ŸåŒºåŸŸ">åˆ›å»ºä¾¦å¯ŸåŒºåŸŸ</h4>
<p>å½“ç„¶æ˜¯ä½¿ç”¨ <code>Area2D</code> èŠ‚ç‚¹å•¦ï¼å†ç»™å®ƒæ·»åŠ ä¸€ä¸ª <code>CollisionShape2D</code> å­èŠ‚ç‚¹ï¼Œç”¨ä»€ä¹ˆå½¢çŠ¶çš„ç¢°æ’åŒºåŸŸï¼ŒæŒ‰ä½ è‡ªå·±çš„å–œå¥½æ¥ï¼Œè¿™é‡Œç”±äºæ˜¯ bat æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªåœ†å½¢çš„ç¢°æ’å½¢çŠ¶ã€‚ç„¶åå°† Area2D collision å±æ€§çš„ Mask å€¼è®¾ä¸º Playerã€‚</p>
<p><strong>Code</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Area2D</span>

<span style="color:#75715e"># é»˜è®¤çš„æ˜¯æ²¡æœ‰å‘ç° player</span>
<span style="color:#66d9ef">var</span> player <span style="color:#f92672">=</span> null

<span style="color:#75715e"># åˆ¤æ–­æ˜¯å¦ä¾¦å¯Ÿåˆ° player</span>
<span style="color:#66d9ef">func</span> can_see_player():
    <span style="color:#66d9ef">return</span> player <span style="color:#f92672">!=</span> null

<span style="color:#75715e"># å½“ player è¿›å…¥ä¾¦å¯ŸåŒºåŸŸï¼Œå°† player å¯¹è±¡èµ‹å€¼ç»™ player å˜é‡</span>
<span style="color:#66d9ef">func</span> _on_PlayerDetectionZone_body_entered(body):
    player <span style="color:#f92672">=</span> body

<span style="color:#75715e"># å½“ player ç¦»å¼€ä¾¦å¯ŸåŒºåŸŸï¼Œå°±æ˜¯æ²¡å‘ç° player</span>
<span style="color:#66d9ef">func</span> _on_PlayerDetectionZone_body_exited(body):
    player <span style="color:#f92672">=</span> null

<span style="color:#75715e"># è¿™é‡Œä¸ºä»€ä¹ˆä½¿ç”¨ _body_entered() _body_exited() signal å› ä¸ºè¿™ä¸¤ä¸ª signal å¯ä»¥æ£€æŸ¥ä¸åŒç±»å‹èŠ‚ç‚¹çš„ç¢°æ’ï¼›_area_entered() _area_exited() åªèƒ½æ£€æŸ¥ Area2D èŠ‚ç‚¹çš„ç¢°æ’</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="bat-çš„ä¸‰ä¸ªçŠ¶æ€">bat çš„ä¸‰ä¸ªçŠ¶æ€</h4>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>

<span style="color:#75715e"># å®ä¾‹åŒ–ä¾¦å¯ŸåŒºåŸŸ</span>
<span style="color:#66d9ef">const</span> EnemyDeathEffect <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://Effects/EnemyDeathEffect.tscn&#34;</span>)

<span style="color:#75715e"># åŒ Player ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›æ•°å€¼</span>
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> ACCELERATION <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> MAX_SPEED <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> FRICTION <span style="color:#f92672">=</span> <span style="color:#ae81ff">200</span>

<span style="color:#75715e"># å®šä¹‰ Bat ç§çŠ¶æ€</span>
<span style="color:#66d9ef">enum</span>{
    IDLE,
    WANDER,
    CHASE
}

<span style="color:#75715e"># bat åˆå§‹ä½ç½®ä¸º0</span>
<span style="color:#66d9ef">var</span> velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
<span style="color:#66d9ef">var</span> knockback <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO

<span style="color:#75715e"># åˆå§‹çŠ¶æ€ä¸º IDLE</span>
<span style="color:#66d9ef">var</span> state <span style="color:#f92672">=</span> IDLE

<span style="color:#75715e"># å¾—åˆ° bat åŠ¨ç”»èŠ‚ç‚¹</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> stats <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Stats
<span style="color:#75715e"># å¾—åˆ°ä¾¦å¯ŸåŒºåŸŸèŠ‚ç‚¹</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> playerDetectionZone <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>PlayerDetectionZone

<span style="color:#66d9ef">func</span> _physics_process(delta):
    <span style="color:#f92672">......</span>

    <span style="color:#75715e"># åˆ†ä¸‰ç§çŠ¶æ€</span>
    match state:
        IDLE:
            velocity <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>move_toward(<span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO, FRICTION <span style="color:#f92672">*</span> delta)
            seek_player()
        WANDER:
            <span style="color:#66d9ef">pass</span>

        CHASE:
            <span style="color:#66d9ef">var</span> player <span style="color:#f92672">=</span> playerDetectionZone<span style="color:#f92672">.</span>player
            <span style="color:#66d9ef">if</span> player <span style="color:#f92672">!=</span> null:
                <span style="color:#66d9ef">var</span> direction <span style="color:#f92672">=</span> (player<span style="color:#f92672">.</span>global_position <span style="color:#f92672">-</span> global_position)<span style="color:#f92672">.</span>normalized()
                velocity <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>move_toward(direction <span style="color:#f92672">*</span> MAX_SPEED, ACCELERATION <span style="color:#f92672">*</span> delta)
                <span style="color:#75715e"># è®© bat æ­£é¢å§‹ç»ˆæœå‘ Player</span>
                sprite<span style="color:#f92672">.</span>flip_h <span style="color:#f92672">=</span> velocity<span style="color:#f92672">.</span>x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>
            <span style="color:#66d9ef">else</span>:
                <span style="color:#75715e"># Player ç¦»å¼€ä¾¦å¯ŸåŒºåŸŸæ—¶ï¼Œåˆ‡æ¢ bat çŠ¶æ€</span>
                state <span style="color:#f92672">=</span> IDLE

    velocity <span style="color:#f92672">=</span> move_and_slide(velocity)

<span style="color:#75715e"># æŸ¥æ‰¾ Playerï¼Œåˆ†æƒ…å†µè¿”å›å€¼</span>
<span style="color:#66d9ef">func</span> seek_player():
    <span style="color:#66d9ef">if</span> playerDetectionZone<span style="color:#f92672">.</span>can_see_player():
        state <span style="color:#f92672">=</span> CHASE

    <span style="color:#f92672">......</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="16player-status--enemy-attack">16ï¼ŒPlayer Status + Enemy Attack</h2>
<p>ç»™ Player æ·»åŠ è¢«æ”»å‡»çŠ¶æ€ï¼ŒåŒ…æ‹¬è¢«æ”»å‡»çš„ç‰¹æ®Šæ•ˆæœä»¥åŠè¢«æ”»å‡»ä¸€å®šæ¬¡æ•°å Player ä¾¿ä¼šæ­»äº¡ã€‚ç®€å•çš„ç»™ Player.tscn æ·»åŠ  Hurtbox.tscnï¼Œè®¾ç½®ç¢°æ’ shapeï¼Œ Bat.tscn æ·»åŠ  Hitbox.tscnï¼Œè®¾ç½®ç¢°æ’ shape  å°±èƒ½å®ç°è¿™ä¸ªåŠŸèƒ½äº†ã€‚â° <strong>è®°å¾—è®¾ç½®å®ƒä»¬ä¸¤çš„çš„ Collision å±æ€§å€¼</strong></p>
<h3 id="å‡ºç°çš„é—®é¢˜">å‡ºç°çš„é—®é¢˜</h3>
<p>ç”±äºæ˜¯é€šè¿‡ç¢°æ’ shape ç”¨äºæ£€æµ‹ Bat æ˜¯å¦æ”»å‡»äº† Playerï¼Œå½“å‡ºç° Player ä¸åŠ¨æ—¶ï¼ŒBat çš„ç¢°æ’ shape æ¯” Player å°ï¼Œå¯èƒ½ Bat çš„ç¢°æ’ shape å°±ä¸€ç›´åœ¨ Player çš„ç¢°æ’ shape å†…ï¼Œç»“æœå°±æ˜¯ Bat ä¸€ç›´åœ¨æ”»å‡» Player å´å¹¶æ²¡æœ‰é€ æˆä¼¤å®³ã€‚</p>
<h3 id="è§£å†³æ€è·¯">è§£å†³æ€è·¯</h3>
<p>æ·»åŠ æ—¶é—´è®¡æ•°å™¨ï¼Œç”¨åˆ°äº† <code>Timer</code> èŠ‚ç‚¹ã€‚è¿™æ ·å…¶å®è¿˜ä¸å¤Ÿï¼Œåœ¨ Godot å¼•æ“é‡Œï¼Œä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¾ç½® hurtbox çš„ monitorable å±æ€§ã€‚</p>
<p><strong>code</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Area2D</span>

<span style="color:#66d9ef">const</span> HitEffect <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://Effects/HitEffect.tscn&#34;</span>)

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> timer <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Timer</span>

<span style="color:#66d9ef">var</span> invincible <span style="color:#f92672">=</span> false <span style="color:#66d9ef">setget</span> set_invincible

<span style="color:#66d9ef">signal</span> invincility_started
<span style="color:#66d9ef">signal</span> invincility_ended

<span style="color:#66d9ef">func</span> set_invincible(value):
    invincible <span style="color:#f92672">=</span> value
    <span style="color:#66d9ef">if</span> invincible <span style="color:#f92672">==</span> true:
        emit_signal(<span style="color:#e6db74">&#34;invincility_started&#34;</span>)
    <span style="color:#66d9ef">else</span>:
        emit_signal(<span style="color:#e6db74">&#34;invincility_ended&#34;</span>)

<span style="color:#66d9ef">func</span> start_invincility(duration):
    self<span style="color:#f92672">.</span>invincible <span style="color:#f92672">=</span> true  <span style="color:#75715e"># å› ä¸ºä½¿ç”¨äº† setgetï¼Œæ‰€ä»¥è¦åŠ  self å‰ç¼€</span>
    timer<span style="color:#f92672">.</span>start(duration)

<span style="color:#66d9ef">func</span> creat_hit_effect():
    <span style="color:#66d9ef">var</span> hitEffect <span style="color:#f92672">=</span> HitEffect<span style="color:#f92672">.</span>instance()
    <span style="color:#66d9ef">var</span> main <span style="color:#f92672">=</span> get_tree()<span style="color:#f92672">.</span>current_scene
    main<span style="color:#f92672">.</span>add_child(hitEffect)
    hitEffect<span style="color:#f92672">.</span>global_position <span style="color:#f92672">=</span> global_position

<span style="color:#66d9ef">func</span> _on_Timer_timeout():
    self<span style="color:#f92672">.</span>invincible <span style="color:#f92672">=</span> false <span style="color:#75715e"># å› ä¸ºä½¿ç”¨äº† setgetï¼Œæ‰€ä»¥è¦åŠ  self å‰ç¼€</span>

<span style="color:#66d9ef">func</span> _on_Hurtbox_invincility_ended():
    monitorable <span style="color:#f92672">=</span> true

<span style="color:#66d9ef">func</span> _on_Hurtbox_invincility_started():
    set_deferred(<span style="color:#e6db74">&#34;monitorable&#34;</span>, false)
<span style="color:#75715e"># set_deffered(), monitorable, if true, other monitoring areas can detect this area. å»¶è¿Ÿè®¾ç½®ï¼Œé¿å… detect å¾—è¿‡å¿«å¯¼è‡´äº†å‰ä¸€æ¬¡ detect è¿˜æ²¡ç»“æŸï¼Œä¸‹ä¸€æ¬¡ detect åˆæ¥äº†ï¼Œä¿è¯ä¸€æ¬¡ detect ç»“æŸåæ‰ä¸‹ä¸€æ¬¡ detectã€‚</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="17player-hearts-ui">17ï¼ŒPlayer Hearts UI</h2>
<h3 id="control-node">Control Node</h3>
<p>è¿™é‡Œä¼šç”¨åˆ° control ç±»èŠ‚ç‚¹ï¼Œ<code>Control</code> å’Œ <code>Label</code> èŠ‚ç‚¹ï¼Œå…ˆç”¨æœ€ç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥ç”¨ text æ–‡æœ¬è¡¨ç¤ºè§’è‰²ç”Ÿå‘½å€¼ã€‚</p>
<p><strong>code</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Control</span>

<span style="color:#66d9ef">var</span> hearts <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> <span style="color:#66d9ef">setget</span> set_hearts
<span style="color:#66d9ef">var</span> max_hearts <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> <span style="color:#66d9ef">setget</span> set_max_hearts

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> label <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Label</span>

<span style="color:#66d9ef">func</span> set_hearts(value):
    hearts <span style="color:#f92672">=</span> clamp(value, <span style="color:#ae81ff">0</span>, max_hearts)
    <span style="color:#66d9ef">if</span> label <span style="color:#f92672">!=</span> null:        <span style="color:#75715e"># åˆ·æ–° Label èŠ‚ç‚¹é‡Œè§’è‰²ç”Ÿå‘½å€¼æ•°å€¼</span>
        label<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HP = &#34;</span> <span style="color:#f92672">+</span> str(hearts)

<span style="color:#66d9ef">func</span> set_max_hearts(value):
    max_hearts <span style="color:#f92672">=</span> max(value, <span style="color:#ae81ff">1</span>)

<span style="color:#66d9ef">func</span> _ready():
    self<span style="color:#f92672">.</span>max_hearts <span style="color:#f92672">=</span> PlayerStats<span style="color:#f92672">.</span>max_health
    self<span style="color:#f92672">.</span>hearts <span style="color:#f92672">=</span> PlayerStats<span style="color:#f92672">.</span>health
    PlayerStats<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;health_changed&#34;</span>, self, <span style="color:#e6db74">&#34;set_hearts&#34;</span>)

</code></pre></td></tr></table>
</div>
</div><h3 id="texturerect">TextureRect</h3>
<p>ä½¿ç”¨ TextureRect èŠ‚ç‚¹ä»¥ä½¿ç”¨ texture ä½œä¸ºç”Ÿå‘½å€¼ï¼ˆå¯¹å°±æ˜¯ç”¨å›¾å½¢è¡¨ç¤ºç”Ÿå‘½å€¼ï¼‰ã€‚éœ€è¦ä¸¤ä¸ª TextureRect èŠ‚ç‚¹ã€‚ä¸€ä¸ªä¸º HeartUIEmpty ä¸€ä¸ªæ˜¯ HeartUIFullã€‚</p>
<blockquote>
<p>è®°å¾—å‹¾é€‰ Stretch Mode å±æ€§å€¼ä¸‹çš„ Tile</p>
</blockquote>
<h4 id="code">code</h4>
<p><strong>HeartUI.gd</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node</span>

<span style="color:#66d9ef">export</span> (<span style="color:#a6e22e">int</span>) <span style="color:#66d9ef">var</span> max_health <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">setget</span> set_max_health
<span style="color:#66d9ef">var</span> health <span style="color:#f92672">=</span> max_health <span style="color:#66d9ef">setget</span> set_health

<span style="color:#66d9ef">signal</span> no_health
<span style="color:#66d9ef">signal</span> health_changed(value)
<span style="color:#66d9ef">signal</span> max_health_changed(value)

<span style="color:#66d9ef">func</span> set_max_health(value):
    max_health <span style="color:#f92672">=</span> value
    self<span style="color:#f92672">.</span>health <span style="color:#f92672">=</span> min(health, max_health)
    emit_signal(<span style="color:#e6db74">&#34;max_health_changed&#34;</span>, max_health)

<span style="color:#66d9ef">func</span> set_health(value):
    health <span style="color:#f92672">=</span> value
    emit_signal(<span style="color:#e6db74">&#34;health_changed&#34;</span>, health)
    <span style="color:#66d9ef">if</span> health <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
        emit_signal(<span style="color:#e6db74">&#34;no_health&#34;</span>)

<span style="color:#66d9ef">func</span> _ready():
    self<span style="color:#f92672">.</span>health <span style="color:#f92672">=</span> max_health

</code></pre></td></tr></table>
</div>
</div><p><strong>Stats.gd</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node</span>

<span style="color:#66d9ef">export</span> (<span style="color:#a6e22e">int</span>) <span style="color:#66d9ef">var</span> max_health <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">setget</span> set_max_health
<span style="color:#66d9ef">var</span> health <span style="color:#f92672">=</span> max_health <span style="color:#66d9ef">setget</span> set_health

<span style="color:#66d9ef">signal</span> no_health
<span style="color:#66d9ef">signal</span> health_changed(value)
<span style="color:#66d9ef">signal</span> max_health_changed(value)

<span style="color:#66d9ef">func</span> set_max_health(value):
    max_health <span style="color:#f92672">=</span> value
    self<span style="color:#f92672">.</span>health <span style="color:#f92672">=</span> min(health, max_health)
    emit_signal(<span style="color:#e6db74">&#34;max_health_changed&#34;</span>, max_health)

<span style="color:#66d9ef">func</span> set_health(value):
    health <span style="color:#f92672">=</span> value
    emit_signal(<span style="color:#e6db74">&#34;health_changed&#34;</span>, health)
    <span style="color:#66d9ef">if</span> health <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
        emit_signal(<span style="color:#e6db74">&#34;no_health&#34;</span>)

<span style="color:#66d9ef">func</span> _ready():
    self<span style="color:#f92672">.</span>health <span style="color:#f92672">=</span> max_health

</code></pre></td></tr></table>
</div>
</div><h3 id="é‡åˆ°çš„é—®é¢˜">é‡åˆ°çš„é—®é¢˜</h3>
<p>HeartUIFull.rect.x çš„å€¼ä¸èƒ½è®¾ç½®ä¸º0ï¼Œåœ¨æ¸¸æˆé‡Œé¢ï¼Œä½†è§’è‰²æ­»äº¡æ—¶ï¼Œè¿˜ä¼šå‰©ä¸‹ä¸€æ ¼ç”Ÿå‘½å€¼ã€‚è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œå‹¾é€‰ Texture å±æ€§ä¸‹çš„ Expand å±æ€§å€¼å°±è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚</p>
<h2 id="18enemy-soft-collisions">18ï¼ŒEnemy Soft Collisions</h2>
<p>æ€»ç»“ä¸€ä¸‹å‰é¢æ‰€æœ‰å†…å®¹ï¼Œå‘ç°é—®é¢˜ã€‚</p>
<figure style="margin:1rem 0.5rem"><a href="../../../img/../../../img/godot/action-rpg/guess_how_many_bats.png" title="guess_how_many_bats.png"><img src="../../../img/../../../img/godot/action-rpg/guess_how_many_bats.png" alt="guess_how_many_bats.png" width=""></a></figure>

<p>ä½ çŒœçŒœä¸Šé¢æœ‰å‡ åªè™è ï¼Ÿå…¶å®æœ‰ä¸‰åªï¼Œè¿™é‡Œæˆ‘ä»¬è¦è§£å†³çš„å°±æ˜¯è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ª SoftCollision.tscn å¹¶ä¸”è®¾ç½®å®ƒçš„ collision å±æ€§çš„ Layer å’Œ Mask å€¼éƒ½ä¸º SoftCollisionã€‚æœ€åç»™ Bat.tscn æ·»åŠ è¿™ä¸ªèŠ‚ç‚¹ã€‚</p>
<p><strong>code</strong></p>
<p><strong>SoftCollision.gd</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Area2D</span>

<span style="color:#66d9ef">func</span> is_colliding():
    <span style="color:#66d9ef">var</span> areas <span style="color:#f92672">=</span> get_overlapping_areas()
    <span style="color:#66d9ef">return</span> areas<span style="color:#f92672">.</span>size() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>

<span style="color:#66d9ef">func</span> get_push_vector():
    <span style="color:#66d9ef">var</span> areas <span style="color:#f92672">=</span> get_overlapping_areas()
    <span style="color:#66d9ef">var</span> push_vector <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
    <span style="color:#66d9ef">if</span> is_colliding():
        <span style="color:#66d9ef">var</span> area <span style="color:#f92672">=</span> areas[<span style="color:#ae81ff">0</span>]
        push_vector <span style="color:#f92672">=</span> area<span style="color:#f92672">.</span>global_position<span style="color:#f92672">.</span>direction_to(global_position)
        push_vector <span style="color:#f92672">=</span> push_vector<span style="color:#f92672">.</span>normalized()
    <span style="color:#66d9ef">return</span> push_vector

</code></pre></td></tr></table>
</div>
</div><p><strong>Bat.gd</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#f92672">......</span>

<span style="color:#66d9ef">func</span> _physics_process(delta):
    <span style="color:#f92672">......</span>

    <span style="color:#66d9ef">if</span> softCollison<span style="color:#f92672">.</span>is_colliding():
        velocity <span style="color:#f92672">+=</span> softCollison<span style="color:#f92672">.</span>get_push_vector() <span style="color:#f92672">*</span> delta <span style="color:#f92672">*</span> <span style="color:#ae81ff">400</span>
    velocity <span style="color:#f92672">=</span> move_and_slide(velocity)

<span style="color:#f92672">......</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>åœ¨æœ‰å¾ˆå¤šï¼ˆ&gt;=20ï¼‰ä¸ª chase å¯¹è±¡æ—¶ï¼Œä¸æ¨èä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šæ¶ˆè€—å¤§é‡èµ„æº</p>
</blockquote>
<h2 id="19player-camera">19ï¼ŒPlayer Camera</h2>
<p>æ·»åŠ ä¸€ä¸ªä»¥è§’è‰²ä¸ºä¸­å¿ƒçš„ Cameraï¼Œåœ¨ Godot é‡Œé¢éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨è§’è‰²èŠ‚ç‚¹ä¸‹æ·»åŠ  <code>Camera</code> å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŠŠå±æ€§é¢æ¿é‡Œçš„ Current å±æ€§å‹¾ä¸Šï¼Œå°±å®ç°äº†ä¸€ä¸ªæœ€ç®€å• Player Camera äº†ã€‚</p>
<h3 id="è®©-camera-ç§»åŠ¨æ›´åŠ å¹³æ»‘">è®© Camera ç§»åŠ¨æ›´åŠ å¹³æ»‘</h3>
<p>é»˜è®¤çš„ Camera ç§»åŠ¨çœ‹èµ·æ¥ç‰¹åˆ«ç”Ÿç¡¬ã€‚åœ¨æ£€è§†é¢æ¿é‡Œå¼€å¯ <code>Smoothing</code> å±æ€§ï¼Œè¿˜å¯ä»¥æ”¹å˜ <code>Process Mode</code> çš„å€¼.</p>
<h3 id="å°†æ˜¾ç¤ºç”Ÿå‘½å€¼çŠ¶æ€çš„å›ºå®šåœ¨-camera-çš„å·¦ä¸Šè§’">å°†æ˜¾ç¤ºç”Ÿå‘½å€¼çŠ¶æ€çš„â™¥å›ºå®šåœ¨ Camera çš„å·¦ä¸Šè§’</h3>
<p>è¿™ç§ç®€å•æ–¹å¼æ·»åŠ çš„ Cameraï¼Œ UI éƒ¨åˆ†å¹¶ä¸ä¼šå›ºå®šåœ¨ Camera å·¦ä¸Šè§’ï¼Œéšç€è§’è‰²çš„ç§»åŠ¨ï¼ŒUI è„±ç¦»è§†çº¿ã€‚ä¸ºèŠ‚ç‚¹ <code>HearthUI</code> æ·»åŠ ä¸€ä¸ª <code>CanvasLayer</code> çˆ¶èŠ‚ç‚¹ï¼Œè§£å†³ï¼</p>
<h3 id="ä¿®å¤è§’è‰²æ­»äº¡æ—¶camera-å›åˆ°è§’è‰²åˆå§‹ä½ç½®çš„-bug">ä¿®å¤è§’è‰²æ­»äº¡æ—¶ï¼ŒCamera å›åˆ°è§’è‰²åˆå§‹ä½ç½®çš„ BUG</h3>
<p>ä½¿ç”¨è¿™ç§æ–¹å¼æ·»åŠ çš„ Camera å°±ä¼šæœ‰è¿™ç§é—®é¢˜ï¼Œè§’è‰²æ­»äº¡æ—¶ï¼ŒCamera ä¸æ˜¯åœ¨è§’è‰²æ­»äº¡çš„åœ°ç‚¹ï¼Œè€Œæ˜¯å›åˆ°äº†è§’è‰²ä¸€å¼€å§‹çš„ä½ç½®ã€‚è§£å†³ï¼šå°† <code>Camera</code> èŠ‚ç‚¹ä» <code>Player</code> èŠ‚ç‚¹é‡Œç§»å‡ºæ¥è‡³ Root ç›®å½•ï¼Œåœ¨ <code>Player</code> èŠ‚ç‚¹ä¸‹æ·»åŠ ä¸€ä¸ª <code>RemoteTransfor2D</code> å­èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶å±æ€§è®¾ç½®é‡Œçš„ Remote Path è®¾ç½®ä¸º <code>Camera</code> èŠ‚ç‚¹ï¼Œå®Œç¾è§£å†³ï¼</p>
</article>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<div class="utterances"></div>
<script src="https://utteranc.es/client.js"
        repo="YanTree/HUGO_COMMENT"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


    </div><div class="footer container-xl width-full p-responsive" role="contentinfo">
    <div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
      <ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
        <li class="mr-3 mr-lg-0">Â© 2020 YanTree.</li>
          <li class="mr-3 mr-lg-0"><a href="https://github.com/YanTree/.emacs.d">.emacs.d</a></li>
          <li class="mr-3 mr-lg-0"><a href="#"></a></li>
          <li class="mr-3 mr-lg-0"><a href="http://commonmark.org/help/">Markdown</a></li>
          <li class="mr-3 mr-lg-0"><a href="#"></a></li>
          <li><a href="https://yantree.github.io/other_pages/software/">Software</a></li>
  
      </ul>
  
      <a aria-label="Homepage" title="YanTree&#39;s BLOG" class="footer-octicon d-none d-lg-block mx-lg-4" href="https://yantree.github.io/">
        <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
  </a>
     <ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
          <li class="mr-3 mr-lg-0"><a href="https://github.com/kasusa/kasusa.github.io">Kasusa</a></li>
          <li class="mr-3 mr-lg-0"><a href="#"></a></li>
        <li class="mr-3 mr-lg-0"><a href="https://yantree.github.io/other_pages/resume/">Resume</a></li>
        <li class="mr-3 mr-lg-0"><a href="#"></a></li>
          <li class="mr-3 mr-lg-0"><a href="https://yantree.github.io/other_pages/about/">About</a></li>
          <li><a href="#"></a></li>
      </ul>
    </div>
    <div class="d-flex flex-justify-center pb-6">
      <span class="f6 text-gray-light"></span>
    </div>
  </div></body>
</html>
